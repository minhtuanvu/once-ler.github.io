<!DOCTYPE html>
<html>
<head>
  <title>nyuResearchBO.h</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "C:\\cygwin64\\home\\htao\\harmony-middleware-doc\\\\middleware\\selectica\\integration\\nyuResearchBO.h";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#nyuresearchbo.h">nyuResearchBO.h</a>
      </div>

      <div class="heading h4">
        <a href="#syncing-document-review-from-research-navigator-to-selectica">Syncing Document Review from Research Navigator to Selectica</a>
      </div>

      <div class="heading h2">
        <a href="#nyuresearchbolesstgreater">nyuResearchBO&amp;lt;T&amp;gt;</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="nyuresearchbo.h">
  <h1>
    <a href="#nyuresearchbo.h" name="nyuresearchbo.h" class="pilcrow"></a>
nyuResearchBO.h
  </h1>
</div>
<div class="pilwrap" id="syncing-document-review-from-research-navigator-to-selectica">
  <h4>
    <a href="#syncing-document-review-from-research-navigator-to-selectica" name="syncing-document-review-from-research-navigator-to-selectica" class="pilcrow"></a>
Syncing Document Review from Research Navigator to Selectica
  </h4>
</div>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-3" id="line-3" data-line="3"></a>  <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"selectica.h"</span></span>
<a class="line-num" href="#line-4" id="line-4" data-line="4"></a>  <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"middleware.h"</span></span>
<a class="line-num" href="#line-5" id="line-5" data-line="5"></a>  
<a class="line-num" href="#line-6" id="line-6" data-line="6"></a>  <span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> json11;
<a class="line-num" href="#line-7" id="line-7" data-line="7"></a>  
<a class="line-num" href="#line-8" id="line-8" data-line="8"></a>  <span class="hljs-keyword">namespace</span> selectica {
<a class="line-num" href="#line-9" id="line-9" data-line="9"></a>  
<a class="line-num" href="#line-10" id="line-10" data-line="10"></a>    <span class="hljs-keyword">typedef</span> <span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; CONTEXT;
<a class="line-num" href="#line-11" id="line-11" data-line="11"></a>    <span class="hljs-keyword">typedef</span> durian::generator&lt;durian::XmlElement::Body&gt; XMLBODY;
<a class="line-num" href="#line-12" id="line-12" data-line="12"></a>    <span class="hljs-keyword">typedef</span> PlustacheTypes::CollectionType COLLECTION;
<a class="line-num" href="#line-13" id="line-13" data-line="13"></a>    <span class="hljs-keyword">typedef</span> PlustacheTypes::ObjectType MAP;
<a class="line-num" href="#line-14" id="line-14" data-line="14"></a>  
<a class="line-num" href="#line-15" id="line-15" data-line="15"></a>    <span class="hljs-keyword">namespace</span> integration {
<a class="line-num" href="#line-16" id="line-16" data-line="16"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="nyuresearchbolesstgreater">
  <h2>
    <a href="#nyuresearchbolesstgreater" name="nyuresearchbolesstgreater" class="pilcrow"></a>
nyuResearchBO&lt;T&gt;
  </h2>
</div>
<p><strong>The middleware class that must be implemented</strong></p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-24" id="line-24" data-line="24"></a>      <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<a class="line-num" href="#line-25" id="line-25" data-line="25"></a>      <span class="hljs-keyword">class</span> nyuResearchBO : <span class="hljs-keyword">public</span> middleware::handler&lt;selectica::client&lt;T&gt;&gt; {
<a class="line-num" href="#line-26" id="line-26" data-line="26"></a>        <span class="hljs-keyword">typedef</span> selectica::client&lt;T&gt;* CLIENT;
<a class="line-num" href="#line-27" id="line-27" data-line="27"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p><strong>integration:rnumber:selectica:documentreview:update</strong> is the only action type this middleware will act on!</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-28" id="line-28" data-line="28"></a>        <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> ACTION_TYPE = <span class="hljs-string">"integration:rnumber:selectica:documentreview:update"</span>;
<a class="line-num" href="#line-29" id="line-29" data-line="29"></a>        <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> ACTION_TYPE_2 = <span class="hljs-string">"integration:rnumber:selectica:documentreview:update:periodic"</span>;
<a class="line-num" href="#line-30" id="line-30" data-line="30"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>###public</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-31" id="line-31" data-line="31"></a>      <span class="hljs-keyword">public</span>:
<a class="line-num" href="#line-32" id="line-32" data-line="32"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<div class="dox">
<div class="summary">
<p>####sync()
<strong>The sync function that must be overridden</strong></p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">selectica::client</span>
<span>client specific to this middleware
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">json11::Json</span>
<span>json document
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>selectica::client same client passed in
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-38" id="line-38" data-line="38"></a>        selectica::client&lt;T&gt;&amp; sync(selectica::client&lt;T&gt;&amp; selecticaClient, Json j) override {
<a class="line-num" href="#line-39" id="line-39" data-line="39"></a>  
<a class="line-num" href="#line-40" id="line-40" data-line="40"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p><strong>If you're not interested in this action, return immediately!</strong></p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-41" id="line-41" data-line="41"></a>          <span class="hljs-keyword">if</span> (j[<span class="hljs-string">"action"</span>].is_null() || (j[<span class="hljs-string">"action"</span>].string_value() != ACTION_TYPE &amp;&amp; j[<span class="hljs-string">"action"</span>].string_value() != ACTION_TYPE_2)) {
<a class="line-num" href="#line-42" id="line-42" data-line="42"></a>            <span class="hljs-keyword">return</span> selecticaClient;
<a class="line-num" href="#line-43" id="line-43" data-line="43"></a>          }
<a class="line-num" href="#line-44" id="line-44" data-line="44"></a>  
<a class="line-num" href="#line-45" id="line-45" data-line="45"></a>          <span class="hljs-built_in">string</span> <span class="hljs-number">_u</span>id = !j[<span class="hljs-string">"_uid"</span>].is_null() ? j[<span class="hljs-string">"_uid"</span>].string_value() : (!j[<span class="hljs-string">"id"</span>].is_null() ? j[<span class="hljs-string">"id"</span>].string_value() : <span class="hljs-string">"N/A"</span>);
<a class="line-num" href="#line-46" id="line-46" data-line="46"></a>          <span class="hljs-keyword">auto</span> context = selecticaClient.getContext();
<a class="line-num" href="#line-47" id="line-47" data-line="47"></a>  
<a class="line-num" href="#line-48" id="line-48" data-line="48"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>What is the status of this document? only interested in Negotiation</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-49" id="line-49" data-line="49"></a>          <span class="hljs-keyword">if</span> (j[<span class="hljs-string">"status"</span>].is_null() || j[<span class="hljs-string">"status"</span>].string_value() != <span class="hljs-string">"Negotiation"</span>) {
<a class="line-num" href="#line-50" id="line-50" data-line="50"></a>            <span class="hljs-built_in">string</span> status = !j[<span class="hljs-string">"status"</span>].is_null() ? j[<span class="hljs-string">"status"</span>].string_value() : <span class="hljs-string">"N/A"</span>;;
<a class="line-num" href="#line-51" id="line-51" data-line="51"></a>            context-&gt;add(<span class="hljs-string">"sync"</span>, <span class="hljs-string">"Skipping study =&gt; "</span> + <span class="hljs-number">_u</span>id + <span class="hljs-string">" status =&gt; "</span> + status);
<a class="line-num" href="#line-52" id="line-52" data-line="52"></a>            durian::addToLog(MODULE, context, <span class="hljs-string">"sync"</span>);
<a class="line-num" href="#line-53" id="line-53" data-line="53"></a>            <span class="hljs-keyword">return</span> selecticaClient;
<a class="line-num" href="#line-54" id="line-54" data-line="54"></a>          }
<a class="line-num" href="#line-55" id="line-55" data-line="55"></a>          
<a class="line-num" href="#line-56" id="line-56" data-line="56"></a>          <span class="hljs-keyword">using</span> nyuResearchBOType = selectica::integration::nyuResearchBO&lt;T&gt;;
<a class="line-num" href="#line-57" id="line-57" data-line="57"></a>  
<a class="line-num" href="#line-58" id="line-58" data-line="58"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>There is 1 task you need to accomplish in order to sync</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-59" id="line-59" data-line="59"></a>          <span class="hljs-keyword">auto</span> <span class="hljs-number">_u</span>psertDocumentReview = createAction&lt;CLIENT&gt;(nyuResearchBOType::upsertDocumentReviewAction, j);
<a class="line-num" href="#line-60" id="line-60" data-line="60"></a>  
<a class="line-num" href="#line-61" id="line-61" data-line="61"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>Compose your tasks</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-62" id="line-62" data-line="62"></a>          <span class="hljs-keyword">auto</span> finalClient = flow(<span class="hljs-number">_u</span>psertDocumentReview)(&amp;selecticaClient);
<a class="line-num" href="#line-63" id="line-63" data-line="63"></a>  
<a class="line-num" href="#line-64" id="line-64" data-line="64"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>Don't forget to clearContext for the next middleware!</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-65" id="line-65" data-line="65"></a>          finalClient-&gt;clearContext();
<a class="line-num" href="#line-66" id="line-66" data-line="66"></a>  
<a class="line-num" href="#line-67" id="line-67" data-line="67"></a>          <span class="hljs-keyword">return</span> *finalClient;
<a class="line-num" href="#line-68" id="line-68" data-line="68"></a>        }
<a class="line-num" href="#line-69" id="line-69" data-line="69"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>###private</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-70" id="line-70" data-line="70"></a>      <span class="hljs-keyword">private</span>:
<a class="line-num" href="#line-71" id="line-71" data-line="71"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>####Side Effects
<strong>(CLIENT, Json) =&gt; CLIENT</strong></p>
<div class="dox">
<div class="summary">
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">CLIENT</span>
<span>click::client
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">Json</span>
<span>json11::Json
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-78" id="line-78" data-line="78"></a>              
<a class="line-num" href="#line-79" id="line-79" data-line="79"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<div class="dox">
<div class="summary">
<p><strong>Top level functions that uses helper functions to create SOAP bodies and sends those bodies to web services</strong></p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-82" id="line-82" data-line="82"></a>       
<a class="line-num" href="#line-83" id="line-83" data-line="83"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>#####upsertDocumentReviewAction()
<strong>upsertDocumentReviewAction(ctx, param) =&gt; ctx</strong></p>
<p><strong>Add Agreement to Selectica if not exist and update Click status with Selectica status action</strong></p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-87" id="line-87" data-line="87"></a>        <span class="hljs-function"><span class="hljs-keyword">static</span> CLIENT <span class="hljs-title">upsertDocumentReviewAction</span><span class="hljs-params">(CLIENT selecticaClient, Json j)</span> </span>{
<a class="line-num" href="#line-88" id="line-88" data-line="88"></a>          
<a class="line-num" href="#line-89" id="line-89" data-line="89"></a>          <span class="hljs-built_in">string</span> data = j.dump();
<a class="line-num" href="#line-90" id="line-90" data-line="90"></a>          <span class="hljs-keyword">auto</span> mapping = selecticaClient-&gt;getContext()-&gt;get(<span class="hljs-string">"CreateBOMap"</span>);
<a class="line-num" href="#line-91" id="line-91" data-line="91"></a>  
<a class="line-num" href="#line-92" id="line-92" data-line="92"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>Create all workflow actions</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-93" id="line-93" data-line="93"></a>          <span class="hljs-keyword">auto</span> <span class="hljs-number">_</span>construct = createAction&lt;CONTEXT&gt;(selectica::integration::actions::constructSearchQuery, j);
<a class="line-num" href="#line-94" id="line-94" data-line="94"></a>          <span class="hljs-keyword">auto</span> <span class="hljs-number">_</span>check = createAction&lt;CONTEXT&gt;(selectica::integration::actions::agreementExist, selecticaClient);
<a class="line-num" href="#line-95" id="line-95" data-line="95"></a>          <span class="hljs-keyword">auto</span> <span class="hljs-number">_</span><span class="hljs-built_in">map</span> = createAction&lt;CONTEXT&gt;(selectica::integration::actions::findValueByMongoMap, data, mapping);
<a class="line-num" href="#line-96" id="line-96" data-line="96"></a>          <span class="hljs-keyword">auto</span> <span class="hljs-number">_</span>patchCreate = createAction&lt;CONTEXT&gt;(selectica::integration::actions::patchBugForCreate);
<a class="line-num" href="#line-97" id="line-97" data-line="97"></a>          <span class="hljs-keyword">auto</span> <span class="hljs-number">_</span>merge = createAction&lt;CONTEXT&gt;(selectica::integration::actions::addFoundValueToPropertyCollection, mapping);
<a class="line-num" href="#line-98" id="line-98" data-line="98"></a>          <span class="hljs-keyword">auto</span> <span class="hljs-number">_</span>create = createAction&lt;CONTEXT&gt;(selectica::integration::actions::createBOMessage, selecticaClient);
<a class="line-num" href="#line-99" id="line-99" data-line="99"></a>          <span class="hljs-keyword">auto</span> <span class="hljs-number">_</span>patchUpdate = createAction&lt;CONTEXT&gt;(selectica::integration::actions::patchBugForUpdate);
<a class="line-num" href="#line-100" id="line-100" data-line="100"></a>          <span class="hljs-keyword">auto</span> <span class="hljs-number">_u</span>pdate = createAction&lt;CONTEXT&gt;(selectica::integration::actions::updateBOMessage, selecticaClient);
<a class="line-num" href="#line-101" id="line-101" data-line="101"></a>          <span class="hljs-keyword">auto</span> <span class="hljs-number">_</span>constructClickStatusBody = createAction&lt;CONTEXT&gt;(selectica::integration::actions::constructClickStatusBody, <span class="hljs-string">"Update"</span>);
<a class="line-num" href="#line-102" id="line-102" data-line="102"></a>          <span class="hljs-keyword">auto</span> <span class="hljs-number">_</span>sendToStore = createAction&lt;CONTEXT&gt;(selectica::integration::actions::sendToStore, selecticaClient-&gt;clickNumber, <span class="hljs-string">"Update"</span>);
<a class="line-num" href="#line-103" id="line-103" data-line="103"></a>  
<a class="line-num" href="#line-104" id="line-104" data-line="104"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>Flow all the actions</p>
<p>Currently, Selectica do not want us to update status in Click</p>
<p>So we simply remove the functions from flow(); when they're ready, we'll add them back</p>
<p><code>auto finalContext = flow(_construct, _check, _map, _patchCreate, _merge, _create, _patchUpdate, _merge, _update, _constructClickStatusBody, _sendToStore)(context);</code></p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-111" id="line-111" data-line="111"></a>          <span class="hljs-keyword">auto</span> finalContext = flow(<span class="hljs-number">_</span>construct, <span class="hljs-number">_</span>check, <span class="hljs-number">_</span><span class="hljs-built_in">map</span>, <span class="hljs-number">_</span>patchCreate, <span class="hljs-number">_</span>merge, <span class="hljs-number">_</span>create, <span class="hljs-number">_</span>patchUpdate, <span class="hljs-number">_</span>merge, <span class="hljs-number">_u</span>pdate)(selecticaClient-&gt;getContext());
<a class="line-num" href="#line-112" id="line-112" data-line="112"></a>          
<a class="line-num" href="#line-113" id="line-113" data-line="113"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>Or use compose() instead of flow()</p>
<p><code>auto finalContext = compose(_sendToStore, _constructClickStatusBody, _update, _merge, _patchUpdate, _create, _merge, _patchCreate, _map, _check, _construct)(context);</code></p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-116" id="line-116" data-line="116"></a>          
<a class="line-num" href="#line-117" id="line-117" data-line="117"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>Finally clear the context for the next request</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-118" id="line-118" data-line="118"></a>          selecticaClient-&gt;clearContext();
<a class="line-num" href="#line-119" id="line-119" data-line="119"></a>  
<a class="line-num" href="#line-120" id="line-120" data-line="120"></a>          <span class="hljs-keyword">return</span> selecticaClient;
<a class="line-num" href="#line-121" id="line-121" data-line="121"></a>        }
<a class="line-num" href="#line-122" id="line-122" data-line="122"></a>      };
<a class="line-num" href="#line-123" id="line-123" data-line="123"></a>    
<a class="line-num" href="#line-124" id="line-124" data-line="124"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>####Actions
<strong>(CLIENT, P...) =&gt; CLIENT</strong></p>
<div class="dox">
<div class="summary">
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">CLIENT</span>
<span>selectica::client
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">P...</span>
<span>variatic argumentments
</span>
</div>
</div>
</div>
Helper functions that will be composed

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-132" id="line-132" data-line="132"></a>      <span class="hljs-keyword">namespace</span> actions {
<a class="line-num" href="#line-133" id="line-133" data-line="133"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>#####Helpers
######findMappedProperty()
<strong>findMappedProperty(ctx, param) =&gt; ctx</strong></p>
<p>For each mapped attribute, if value is found, add to the property collection</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-138" id="line-138" data-line="138"></a>        <span class="hljs-keyword">auto</span> findMappedProperty = [](<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; ctx, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;PlustacheTypes::ObjectType&gt;&amp; mapping)-&gt;<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; {
<a class="line-num" href="#line-139" id="line-139" data-line="139"></a>          PlustacheTypes::CollectionType property;
<a class="line-num" href="#line-140" id="line-140" data-line="140"></a>          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; e : mapping) {
<a class="line-num" href="#line-141" id="line-141" data-line="141"></a>            <span class="hljs-keyword">auto</span> d = (*ctx).get(e[<span class="hljs-string">"value"</span>]);
<a class="line-num" href="#line-142" id="line-142" data-line="142"></a>            <span class="hljs-keyword">if</span> (d.size() &gt; <span class="hljs-number">0</span>) {
<a class="line-num" href="#line-143" id="line-143" data-line="143"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>Copy</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-144" id="line-144" data-line="144"></a>              PlustacheTypes::<span class="hljs-function">ObjectType <span class="hljs-title">p</span><span class="hljs-params">(e)</span></span>;
<a class="line-num" href="#line-145" id="line-145" data-line="145"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>Get the first instance, sometimes different BO attributes requires the same JSON path</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-146" id="line-146" data-line="146"></a>              <span class="hljs-keyword">auto</span> v = d.front()[e[<span class="hljs-string">"value"</span>]];
<a class="line-num" href="#line-147" id="line-147" data-line="147"></a>              <span class="hljs-keyword">if</span> (v.size() &gt; <span class="hljs-number">0</span>) {
<a class="line-num" href="#line-148" id="line-148" data-line="148"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>Custom formatting</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-149" id="line-149" data-line="149"></a>                <span class="hljs-keyword">if</span> (e[<span class="hljs-string">"dataType"</span>] == <span class="hljs-string">"date"</span>){
<a class="line-num" href="#line-150" id="line-150" data-line="150"></a>                  <span class="hljs-keyword">if</span> (v.substr(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>) != <span class="hljs-string">"1970-01-01"</span>) {
<a class="line-num" href="#line-151" id="line-151" data-line="151"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>&quot;%b/%d/%Y&quot; Apr/23/2016</p>
<p>&quot;%m/%d/%Y&quot; 04/23/2016</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-154" id="line-154" data-line="154"></a>                    v = durian::formatTime(v, <span class="hljs-string">"%m/%d/%Y"</span>);
<a class="line-num" href="#line-155" id="line-155" data-line="155"></a>                  } <span class="hljs-keyword">else</span> {
<a class="line-num" href="#line-156" id="line-156" data-line="156"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>pass empty string if epoch date</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-157" id="line-157" data-line="157"></a>                    v = <span class="hljs-string">""</span>;
<a class="line-num" href="#line-158" id="line-158" data-line="158"></a>                  }                
<a class="line-num" href="#line-159" id="line-159" data-line="159"></a>                }
<a class="line-num" href="#line-160" id="line-160" data-line="160"></a>                p[<span class="hljs-string">"value"</span>] = v;
<a class="line-num" href="#line-161" id="line-161" data-line="161"></a>                property.push_back(p);
<a class="line-num" href="#line-162" id="line-162" data-line="162"></a>              }
<a class="line-num" href="#line-163" id="line-163" data-line="163"></a>            }
<a class="line-num" href="#line-164" id="line-164" data-line="164"></a>          }
<a class="line-num" href="#line-165" id="line-165" data-line="165"></a>          ctx.get()-&gt;add(<span class="hljs-string">"property"</span>, property);
<a class="line-num" href="#line-166" id="line-166" data-line="166"></a>          <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-167" id="line-167" data-line="167"></a>        };
<a class="line-num" href="#line-168" id="line-168" data-line="168"></a>  
<a class="line-num" href="#line-169" id="line-169" data-line="169"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>######fixMappedPropertyTypes()
<strong>fixMappedPropertyTypes(ctx) =&gt; ctx</strong></p>
<p>Convert data types, b/c there is no one-to-one value possible</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-173" id="line-173" data-line="173"></a>        <span class="hljs-keyword">auto</span> fixMappedPropertyTypes = [&amp;](<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; ctx)-&gt;<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; {
<a class="line-num" href="#line-174" id="line-174" data-line="174"></a>          <span class="hljs-keyword">auto</span> propertyList = ctx-&gt;get(<span class="hljs-string">"property"</span>);
<a class="line-num" href="#line-175" id="line-175" data-line="175"></a>          <span class="hljs-keyword">auto</span> studyResearchType = <span class="hljs-built_in">std</span>::find_if(propertyList.begin(), propertyList.end(), [&amp;](<span class="hljs-built_in">std</span>::<span class="hljs-built_in">map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;&amp; d)-&gt;<span class="hljs-keyword">bool</span> {
<a class="line-num" href="#line-176" id="line-176" data-line="176"></a>            <span class="hljs-keyword">return</span> d[<span class="hljs-string">"key"</span>] == <span class="hljs-string">"humanResearch"</span>;
<a class="line-num" href="#line-177" id="line-177" data-line="177"></a>          });
<a class="line-num" href="#line-178" id="line-178" data-line="178"></a>  
<a class="line-num" href="#line-179" id="line-179" data-line="179"></a>          <span class="hljs-keyword">if</span> (studyResearchType != <span class="hljs-built_in">std</span>::end(propertyList)) {
<a class="line-num" href="#line-180" id="line-180" data-line="180"></a>            <span class="hljs-built_in">string</span> v = (*studyResearchType)[<span class="hljs-string">"value"</span>];
<a class="line-num" href="#line-181" id="line-181" data-line="181"></a>            <span class="hljs-built_in">std</span>::for_each(propertyList.begin(), propertyList.end(), [&amp;](<span class="hljs-built_in">std</span>::<span class="hljs-built_in">map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;&amp; d){
<a class="line-num" href="#line-182" id="line-182" data-line="182"></a>              <span class="hljs-keyword">if</span> (d[<span class="hljs-string">"key"</span>] == <span class="hljs-string">"humanResearch"</span>) {
<a class="line-num" href="#line-183" id="line-183" data-line="183"></a>                d[<span class="hljs-string">"value"</span>] = v == <span class="hljs-string">"Human"</span> ? <span class="hljs-string">"Y"</span> : <span class="hljs-string">"N"</span>;
<a class="line-num" href="#line-184" id="line-184" data-line="184"></a>              }
<a class="line-num" href="#line-185" id="line-185" data-line="185"></a>              <span class="hljs-keyword">if</span> (d[<span class="hljs-string">"key"</span>] == <span class="hljs-string">"animalResearch"</span>) {
<a class="line-num" href="#line-186" id="line-186" data-line="186"></a>                d[<span class="hljs-string">"value"</span>] = v == <span class="hljs-string">"Human"</span> ? <span class="hljs-string">"N"</span> : <span class="hljs-string">"Y"</span>;;
<a class="line-num" href="#line-187" id="line-187" data-line="187"></a>              }
<a class="line-num" href="#line-188" id="line-188" data-line="188"></a>            });
<a class="line-num" href="#line-189" id="line-189" data-line="189"></a>          } <span class="hljs-keyword">else</span> {
<a class="line-num" href="#line-190" id="line-190" data-line="190"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<p>Default to human study</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-191" id="line-191" data-line="191"></a>            <span class="hljs-built_in">std</span>::for_each(propertyList.begin(), propertyList.end(), [&amp;](<span class="hljs-built_in">std</span>::<span class="hljs-built_in">map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;&amp; d){
<a class="line-num" href="#line-192" id="line-192" data-line="192"></a>              <span class="hljs-keyword">if</span> (d[<span class="hljs-string">"key"</span>] == <span class="hljs-string">"humanResearch"</span>) {
<a class="line-num" href="#line-193" id="line-193" data-line="193"></a>                d[<span class="hljs-string">"value"</span>] = <span class="hljs-string">"Y"</span>;
<a class="line-num" href="#line-194" id="line-194" data-line="194"></a>              }
<a class="line-num" href="#line-195" id="line-195" data-line="195"></a>              <span class="hljs-keyword">if</span> (d[<span class="hljs-string">"key"</span>] == <span class="hljs-string">"animalResearch"</span>) {
<a class="line-num" href="#line-196" id="line-196" data-line="196"></a>                d[<span class="hljs-string">"value"</span>] = <span class="hljs-string">"N"</span>;
<a class="line-num" href="#line-197" id="line-197" data-line="197"></a>              }
<a class="line-num" href="#line-198" id="line-198" data-line="198"></a>            });
<a class="line-num" href="#line-199" id="line-199" data-line="199"></a>          }
<a class="line-num" href="#line-200" id="line-200" data-line="200"></a>          ctx-&gt;remove(<span class="hljs-string">"property"</span>);
<a class="line-num" href="#line-201" id="line-201" data-line="201"></a>          ctx-&gt;add(<span class="hljs-string">"property"</span>, propertyList);
<a class="line-num" href="#line-202" id="line-202" data-line="202"></a>          <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-203" id="line-203" data-line="203"></a>        };
<a class="line-num" href="#line-204" id="line-204" data-line="204"></a>  
<a class="line-num" href="#line-205" id="line-205" data-line="205"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<p>#####Workflow
######constructSearchQuery()
<strong>constructSearchQuery(ctx, param) =&gt; ctx</strong></p>
<p>Does it exist in selectica, construct query?
f(ctx, param)=&gt;ctx</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-211" id="line-211" data-line="211"></a>        <span class="hljs-keyword">auto</span> constructSearchQuery = [](<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; ctx, <span class="hljs-keyword">const</span> json11::Json&amp; j)-&gt;<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; {
<a class="line-num" href="#line-212" id="line-212" data-line="212"></a>          <span class="hljs-built_in">string</span> <span class="hljs-number">_u</span>id = !j[<span class="hljs-string">"_uid"</span>].is_null() ? j[<span class="hljs-string">"_uid"</span>].string_value() : (!j[<span class="hljs-string">"id"</span>].is_null() ? j[<span class="hljs-string">"id"</span>].string_value() : <span class="hljs-string">"N/A"</span>);
<a class="line-num" href="#line-213" id="line-213" data-line="213"></a>          <span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">boType</span><span class="hljs-params">(<span class="hljs-string">"NYUResearchBO"</span>)</span></span>;
<a class="line-num" href="#line-214" id="line-214" data-line="214"></a>          <span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">reqResearchInfo</span><span class="hljs-params">(<span class="hljs-string">"ReqResearchInfo"</span>)</span></span>;
<a class="line-num" href="#line-215" id="line-215" data-line="215"></a>          <span class="hljs-keyword">if</span> (<span class="hljs-number">_u</span>id != <span class="hljs-string">"N/A"</span>) {
<a class="line-num" href="#line-216" id="line-216" data-line="216"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>(<em>ctx).add(&quot;targetSearch&quot;, &quot;/bundles/&quot; + boType + &quot;/</em>[selecticaAgreementNumber='&quot; + _uid + &quot;']/&quot; + reqResearchInfo);</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-217" id="line-217" data-line="217"></a>            (*ctx).add(<span class="hljs-string">"targetSearch"</span>, <span class="hljs-string">"/bundles/"</span> + boType + <span class="hljs-string">"/*[clickAgreementNumber='"</span> + <span class="hljs-number">_u</span>id + <span class="hljs-string">"']/"</span> + reqResearchInfo);
<a class="line-num" href="#line-218" id="line-218" data-line="218"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>Also add _uid to the context, will be used to update selectica status later</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-219" id="line-219" data-line="219"></a>            ctx-&gt;add(<span class="hljs-string">"_uid"</span>, <span class="hljs-number">_u</span>id);
<a class="line-num" href="#line-220" id="line-220" data-line="220"></a>          }
<a class="line-num" href="#line-221" id="line-221" data-line="221"></a>          <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-222" id="line-222" data-line="222"></a>        };
<a class="line-num" href="#line-223" id="line-223" data-line="223"></a>  
<a class="line-num" href="#line-224" id="line-224" data-line="224"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>######agreementExist()
<strong>agreementExist(ctx, param) =&gt; ctx</strong></p>
<p>Test try to get just one attribute
/bundles/NYUResearchBO/*[selecticaAgreementNumber='a00006756']/ReqResearchInfo
Note: if BO does not exist, it will not have an &quot;PropertyList&quot; attribute (path=&gt; Envelope.Body.GetDataResponse.PropertyList)</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-230" id="line-230" data-line="230"></a>        <span class="hljs-keyword">auto</span> agreementExist = [](<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; ctx, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span>* obj)-&gt;<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; {
<a class="line-num" href="#line-231" id="line-231" data-line="231"></a>          <span class="hljs-built_in">string</span> target = (*ctx).get(<span class="hljs-string">"targetSearch"</span>).front()[<span class="hljs-string">"targetSearch"</span>];
<a class="line-num" href="#line-232" id="line-232" data-line="232"></a>          <span class="hljs-keyword">if</span> (target.size() == <span class="hljs-number">0</span>) {
<a class="line-num" href="#line-233" id="line-233" data-line="233"></a>            <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-234" id="line-234" data-line="234"></a>          }
<a class="line-num" href="#line-235" id="line-235" data-line="235"></a>  
<a class="line-num" href="#line-236" id="line-236" data-line="236"></a>          <span class="hljs-built_in">string</span> socketType = (*ctx).get(<span class="hljs-string">"socketType"</span>).front()[<span class="hljs-string">"socketType"</span>];
<a class="line-num" href="#line-237" id="line-237" data-line="237"></a>          <span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; resp2;
<a class="line-num" href="#line-238" id="line-238" data-line="238"></a>          <span class="hljs-keyword">if</span> (socketType == <span class="hljs-string">"HTTP"</span>) {
<a class="line-num" href="#line-239" id="line-239" data-line="239"></a>            <span class="hljs-keyword">auto</span> o = (selectica::client&lt;SimpleWeb::HTTP&gt;*)obj;
<a class="line-num" href="#line-240" id="line-240" data-line="240"></a>            resp2 = ((selectica::client&lt;SimpleWeb::HTTP&gt;*)obj)-&gt;GetData(target);
<a class="line-num" href="#line-241" id="line-241" data-line="241"></a>          } <span class="hljs-keyword">else</span> {
<a class="line-num" href="#line-242" id="line-242" data-line="242"></a>            resp2 = ((selectica::client&lt;SimpleWeb::HTTPS&gt;*)obj)-&gt;GetData(target);
<a class="line-num" href="#line-243" id="line-243" data-line="243"></a>          }
<a class="line-num" href="#line-244" id="line-244" data-line="244"></a>          <span class="hljs-keyword">auto</span> t = resp2.get()-&gt;get(<span class="hljs-string">"GetData"</span>).front()[<span class="hljs-string">"GetData"</span>];
<a class="line-num" href="#line-245" id="line-245" data-line="245"></a>          
<a class="line-num" href="#line-246" id="line-246" data-line="246"></a>          <span class="hljs-keyword">auto</span> parseProperties = [&amp;](<span class="hljs-built_in">vector</span>&lt;json11::Json&gt; props) {
<a class="line-num" href="#line-247" id="line-247" data-line="247"></a>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span>&amp; prop : props) {
<a class="line-num" href="#line-248" id="line-248" data-line="248"></a>              <span class="hljs-keyword">if</span> (prop[<span class="hljs-string">"Name"</span>].string_value() == <span class="hljs-string">"trackingNumber"</span>) {
<a class="line-num" href="#line-249" id="line-249" data-line="249"></a>                (*ctx).add(<span class="hljs-string">"trackingNumber"</span>, prop[<span class="hljs-string">"Value"</span>].string_value());
<a class="line-num" href="#line-250" id="line-250" data-line="250"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<p>Once it is agreement is created, they no longer want updates in Click</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-251" id="line-251" data-line="251"></a>                ctx-&gt;add(<span class="hljs-string">"agreementExist"</span>, <span class="hljs-string">"true"</span>);
<a class="line-num" href="#line-252" id="line-252" data-line="252"></a>              }
<a class="line-num" href="#line-253" id="line-253" data-line="253"></a>              <span class="hljs-keyword">if</span> (prop[<span class="hljs-string">"Name"</span>].string_value() == <span class="hljs-string">"contractStatus"</span>) {
<a class="line-num" href="#line-254" id="line-254" data-line="254"></a>                <span class="hljs-keyword">auto</span> contractStatus = prop[<span class="hljs-string">"Value"</span>].string_value();
<a class="line-num" href="#line-255" id="line-255" data-line="255"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<p>Will use this status to update Click</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-256" id="line-256" data-line="256"></a>                ctx-&gt;add(<span class="hljs-string">"contractStatus"</span>, contractStatus);
<a class="line-num" href="#line-257" id="line-257" data-line="257"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<p>This will be used by constructClickStatusBody()</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-258" id="line-258" data-line="258"></a>                ctx-&gt;add(<span class="hljs-string">"statusName"</span>, contractStatus);
<a class="line-num" href="#line-259" id="line-259" data-line="259"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<p>Find the Click ID by statusName</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-260" id="line-260" data-line="260"></a>                <span class="hljs-keyword">auto</span> statusId = ctx-&gt;get(<span class="hljs-string">"SelecticaToClickStatusMap"</span>).front()[contractStatus];
<a class="line-num" href="#line-261" id="line-261" data-line="261"></a>                <span class="hljs-keyword">if</span> (statusId.size() &gt; <span class="hljs-number">0</span>) {
<a class="line-num" href="#line-262" id="line-262" data-line="262"></a>                  ctx-&gt;add(<span class="hljs-string">"statusId"</span>, statusId);
<a class="line-num" href="#line-263" id="line-263" data-line="263"></a>                }
<a class="line-num" href="#line-264" id="line-264" data-line="264"></a>              }
<a class="line-num" href="#line-265" id="line-265" data-line="265"></a>            }
<a class="line-num" href="#line-266" id="line-266" data-line="266"></a>          };
<a class="line-num" href="#line-267" id="line-267" data-line="267"></a>  
<a class="line-num" href="#line-268" id="line-268" data-line="268"></a>          <span class="hljs-built_in">string</span> err;
<a class="line-num" href="#line-269" id="line-269" data-line="269"></a>          <span class="hljs-keyword">auto</span> j = json11::Json::parse(t, err, json11::JsonParse::STANDARD);
<a class="line-num" href="#line-270" id="line-270" data-line="270"></a>          <span class="hljs-keyword">auto</span> top = j[<span class="hljs-string">"Envelope"</span>][<span class="hljs-string">"Body"</span>][<span class="hljs-string">"GetDataResponse"</span>][<span class="hljs-string">"PropertyList"</span>];
<a class="line-num" href="#line-271" id="line-271" data-line="271"></a>          <span class="hljs-built_in">vector</span>&lt;json11::Json&gt; props;
<a class="line-num" href="#line-272" id="line-272" data-line="272"></a>          <span class="hljs-keyword">if</span> (top.is_array() &amp;&amp; top.array_items()[<span class="hljs-number">0</span>][<span class="hljs-string">"Property"</span>].is_array()) {
<a class="line-num" href="#line-273" id="line-273" data-line="273"></a>            props = top[<span class="hljs-number">0</span>][<span class="hljs-string">"Property"</span>].array_items();          
<a class="line-num" href="#line-274" id="line-274" data-line="274"></a>          }
<a class="line-num" href="#line-275" id="line-275" data-line="275"></a>          <span class="hljs-keyword">if</span> (top.is_object()) {
<a class="line-num" href="#line-276" id="line-276" data-line="276"></a>            props = top[<span class="hljs-string">"Property"</span>].array_items();
<a class="line-num" href="#line-277" id="line-277" data-line="277"></a>          }
<a class="line-num" href="#line-278" id="line-278" data-line="278"></a>          parseProperties(props);
<a class="line-num" href="#line-279" id="line-279" data-line="279"></a>  
<a class="line-num" href="#line-280" id="line-280" data-line="280"></a>          <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-281" id="line-281" data-line="281"></a>        };
<a class="line-num" href="#line-282" id="line-282" data-line="282"></a>  
<a class="line-num" href="#line-283" id="line-283" data-line="283"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<p>######findValueByMongoMap()
// <strong>findValueByMongoMap(ctx, param, param2) =&gt; ctx</strong></p>
<p>Get all values defined by mapping from the mongo json
f(ctx, param, param)=&gt;ctx</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-288" id="line-288" data-line="288"></a>        <span class="hljs-keyword">auto</span> findValueByMongoMap = [](<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; ctx, <span class="hljs-built_in">string</span> resp, PlustacheTypes::CollectionType mapping)-&gt;<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; {
<a class="line-num" href="#line-289" id="line-289" data-line="289"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<p>durian::createContextFromJson is a useful function, check it out</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-290" id="line-290" data-line="290"></a>          durian::createContextFromJson((resp).c_str(), mapping, <span class="hljs-string">"value"</span>, ctx);
<a class="line-num" href="#line-291" id="line-291" data-line="291"></a>          <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-292" id="line-292" data-line="292"></a>        };
<a class="line-num" href="#line-293" id="line-293" data-line="293"></a>  
<a class="line-num" href="#line-294" id="line-294" data-line="294"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<p>######patchBugForCreate()
<strong>patchBugForCreate(ctx) =&gt; ctx</strong>
To accomodate <strong>Selectica bug</strong>, set dummy values</p>
<pre><code class="bash">agreementCategory =&gt; --select agreement category--

agreementType =&gt; --select agreement <span class="hljs-built_in">type</span>--
</code></pre>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-302" id="line-302" data-line="302"></a>        <span class="hljs-keyword">auto</span> patchBugForCreate = [](<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; ctx)-&gt;<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; {
<a class="line-num" href="#line-303" id="line-303" data-line="303"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<p>if trackingNumber is in the context, this is just an UpdateBO, not CreateBO</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-304" id="line-304" data-line="304"></a>          <span class="hljs-keyword">auto</span> trackingNumberValue = ctx-&gt;get(<span class="hljs-string">"trackingNumber"</span>).front()[<span class="hljs-string">"trackingNumber"</span>];
<a class="line-num" href="#line-305" id="line-305" data-line="305"></a>          <span class="hljs-keyword">if</span> (trackingNumberValue.size() &gt; <span class="hljs-number">0</span>) {
<a class="line-num" href="#line-306" id="line-306" data-line="306"></a>            <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-307" id="line-307" data-line="307"></a>          }
<a class="line-num" href="#line-308" id="line-308" data-line="308"></a>          <span class="hljs-built_in">string</span> agreementCategory = ctx-&gt;get(<span class="hljs-string">"category.name"</span>).front()[<span class="hljs-string">"category.name"</span>];
<a class="line-num" href="#line-309" id="line-309" data-line="309"></a>          <span class="hljs-built_in">string</span> agreementType = ctx-&gt;get(<span class="hljs-string">"categoryType.name"</span>).front()[<span class="hljs-string">"categoryType.name"</span>];
<a class="line-num" href="#line-310" id="line-310" data-line="310"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<p>Update to categoryType dummy value; category is accepted on CreateBO, categoryType will be processed by UpdateBO immediately
ctx-&gt;remove(&quot;category.name&quot;);</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-312" id="line-312" data-line="312"></a>          ctx-&gt;remove(<span class="hljs-string">"categoryType.name"</span>);
<a class="line-num" href="#line-313" id="line-313" data-line="313"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41"></a>
</div>
<p>ctx-&gt;add(&quot;category.name&quot;, &quot;--select agreement category--&quot;);</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-314" id="line-314" data-line="314"></a>          ctx-&gt;add(<span class="hljs-string">"categoryType.name"</span>, <span class="hljs-string">"--select agreement type--"</span>);
<a class="line-num" href="#line-315" id="line-315" data-line="315"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42"></a>
</div>
<p>Add for update</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-316" id="line-316" data-line="316"></a>          ctx-&gt;add(<span class="hljs-string">"category.name.update"</span>, agreementCategory);
<a class="line-num" href="#line-317" id="line-317" data-line="317"></a>          ctx-&gt;add(<span class="hljs-string">"categoryType.name.update"</span>, agreementType);
<a class="line-num" href="#line-318" id="line-318" data-line="318"></a>          <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-319" id="line-319" data-line="319"></a>        };
<a class="line-num" href="#line-320" id="line-320" data-line="320"></a>  
<a class="line-num" href="#line-321" id="line-321" data-line="321"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43"></a>
</div>
<p>######addFoundValueToPropertyCollection()
<strong>addFoundValueToPropertyCollection(ctx, param) =&gt; ctx</strong></p>
<p>For each mapped attribute, if value is found, add to the property collection
f(ctx, param)=&gt;ctx</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-326" id="line-326" data-line="326"></a>        <span class="hljs-keyword">auto</span> addFoundValueToPropertyCollection = [&amp;](<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; ctx, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;PlustacheTypes::ObjectType&gt; mapping)-&gt;<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; {
<a class="line-num" href="#line-327" id="line-327" data-line="327"></a>          ctx-&gt;remove(<span class="hljs-string">"property"</span>);
<a class="line-num" href="#line-328" id="line-328" data-line="328"></a>          findMappedProperty(ctx, mapping);
<a class="line-num" href="#line-329" id="line-329" data-line="329"></a>          fixMappedPropertyTypes(ctx);
<a class="line-num" href="#line-330" id="line-330" data-line="330"></a>          <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-331" id="line-331" data-line="331"></a>        };
<a class="line-num" href="#line-332" id="line-332" data-line="332"></a>  
<a class="line-num" href="#line-333" id="line-333" data-line="333"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44"></a>
</div>
<p>######createBOMessage()
<strong>createBOMessage(ctx, param) =&gt; ctx</strong></p>
<p>If context has &quot;trackingNumber&quot;, it is an UPDATE else CREATE, will be handled by CreateBO
f(ctx)=&gt;ctx</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-338" id="line-338" data-line="338"></a>        <span class="hljs-keyword">auto</span> createBOMessage = [&amp;](<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; ctx, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span>* obj)-&gt;<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; {
<a class="line-num" href="#line-339" id="line-339" data-line="339"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45"></a>
</div>
<p>If trackingNumber is in the context, this is just an UpdateBO, not CreateBO</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-340" id="line-340" data-line="340"></a>          <span class="hljs-keyword">auto</span> trackingNumberValue = ctx-&gt;get(<span class="hljs-string">"trackingNumber"</span>).front()[<span class="hljs-string">"trackingNumber"</span>];
<a class="line-num" href="#line-341" id="line-341" data-line="341"></a>          <span class="hljs-keyword">if</span> (trackingNumberValue.size() &gt; <span class="hljs-number">0</span>) {
<a class="line-num" href="#line-342" id="line-342" data-line="342"></a>            <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-343" id="line-343" data-line="343"></a>          }
<a class="line-num" href="#line-344" id="line-344" data-line="344"></a>          <span class="hljs-built_in">string</span> socketType = (*ctx).get(<span class="hljs-string">"socketType"</span>).front()[<span class="hljs-string">"socketType"</span>];
<a class="line-num" href="#line-345" id="line-345" data-line="345"></a>          <span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; resp2;
<a class="line-num" href="#line-346" id="line-346" data-line="346"></a>          <span class="hljs-keyword">if</span> (socketType == <span class="hljs-string">"HTTP"</span>) {
<a class="line-num" href="#line-347" id="line-347" data-line="347"></a>            resp2 = ((selectica::client&lt;SimpleWeb::HTTP&gt;*)obj)-&gt;CreateBO();
<a class="line-num" href="#line-348" id="line-348" data-line="348"></a>          } <span class="hljs-keyword">else</span> {
<a class="line-num" href="#line-349" id="line-349" data-line="349"></a>            resp2 = ((selectica::client&lt;SimpleWeb::HTTPS&gt;*)obj)-&gt;CreateBO();
<a class="line-num" href="#line-350" id="line-350" data-line="350"></a>          }
<a class="line-num" href="#line-351" id="line-351" data-line="351"></a>          <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-352" id="line-352" data-line="352"></a>        };
<a class="line-num" href="#line-353" id="line-353" data-line="353"></a>  
<a class="line-num" href="#line-354" id="line-354" data-line="354"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46"></a>
</div>
<p>######patchBugForUpdate()
<strong>patchBugForUpdate(ctx) =&gt; ctx</strong></p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-356" id="line-356" data-line="356"></a>        <span class="hljs-keyword">auto</span> patchBugForUpdate = [](<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; ctx)-&gt;<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; {
<a class="line-num" href="#line-357" id="line-357" data-line="357"></a>          <span class="hljs-keyword">auto</span> agreementType = ctx-&gt;get(<span class="hljs-string">"categoryType.name.update"</span>).front()[<span class="hljs-string">"categoryType.name.update"</span>];
<a class="line-num" href="#line-358" id="line-358" data-line="358"></a>          ctx-&gt;remove(<span class="hljs-string">"category.name"</span>);
<a class="line-num" href="#line-359" id="line-359" data-line="359"></a>          ctx-&gt;remove(<span class="hljs-string">"categoryType.name"</span>);
<a class="line-num" href="#line-360" id="line-360" data-line="360"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-47" id="section-47"></a>
</div>
<p>Was a CreateBO processed prior to entering this block; if so, CreateBO would exist in the context</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-361" id="line-361" data-line="361"></a>          <span class="hljs-keyword">auto</span> createBOValue = ctx-&gt;get(<span class="hljs-string">"CreateBO"</span>).front()[<span class="hljs-string">"CreateBO"</span>];
<a class="line-num" href="#line-362" id="line-362" data-line="362"></a>          <span class="hljs-keyword">if</span> (createBOValue.size() &gt; <span class="hljs-number">0</span>) {
<a class="line-num" href="#line-363" id="line-363" data-line="363"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-48" id="section-48"></a>
</div>
<p>Previously created and stored by patchBugForCreate thunk
Add for update if previous step was a CreateBO ONLY
ctx-&gt;add(&quot;category.name&quot;, agreementCategory);
<strong>Heads up! Adding both category and type fails, just update type</strong></p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-367" id="line-367" data-line="367"></a>            ctx-&gt;add(<span class="hljs-string">"categoryType.name"</span>, agreementType);
<a class="line-num" href="#line-368" id="line-368" data-line="368"></a>          }
<a class="line-num" href="#line-369" id="line-369" data-line="369"></a>          <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-370" id="line-370" data-line="370"></a>        };
<a class="line-num" href="#line-371" id="line-371" data-line="371"></a>  
<a class="line-num" href="#line-372" id="line-372" data-line="372"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-49" id="section-49"></a>
</div>
<p>######updateBOMessage()
<strong>updateBOMessage(ctx, param) =&gt; ctx</strong></p>
<p>If agreement already exists, they no longer want updates from Click</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-376" id="line-376" data-line="376"></a>        <span class="hljs-keyword">auto</span> updateBOMessage = [&amp;](<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; ctx, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span>* obj)-&gt;<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; {
<a class="line-num" href="#line-377" id="line-377" data-line="377"></a>          <span class="hljs-keyword">auto</span> agreementExist = ctx-&gt;get(<span class="hljs-string">"agreementExist"</span>).front()[<span class="hljs-string">"agreementExist"</span>];
<a class="line-num" href="#line-378" id="line-378" data-line="378"></a>          <span class="hljs-keyword">if</span> (agreementExist.size() &gt; <span class="hljs-number">0</span>) {
<a class="line-num" href="#line-379" id="line-379" data-line="379"></a>            ctx-&gt;add(<span class="hljs-string">"agreementAlreadyExist"</span>, <span class="hljs-string">"Study =&gt; "</span> + ctx-&gt;get(<span class="hljs-string">"_uid"</span>).front()[<span class="hljs-string">"_uid"</span>] + <span class="hljs-string">" Tracking Number =&gt; "</span> + ctx-&gt;get(<span class="hljs-string">"trackingNumber"</span>).front()[<span class="hljs-string">"trackingNumber"</span>]);
<a class="line-num" href="#line-380" id="line-380" data-line="380"></a>            durian::addToLog(MODULE, ctx, <span class="hljs-string">"agreementAlreadyExist"</span>);
<a class="line-num" href="#line-381" id="line-381" data-line="381"></a>            <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-382" id="line-382" data-line="382"></a>          }
<a class="line-num" href="#line-383" id="line-383" data-line="383"></a>          <span class="hljs-built_in">string</span> socketType = (*ctx).get(<span class="hljs-string">"socketType"</span>).front()[<span class="hljs-string">"socketType"</span>];
<a class="line-num" href="#line-384" id="line-384" data-line="384"></a>          <span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; resp2;
<a class="line-num" href="#line-385" id="line-385" data-line="385"></a>          <span class="hljs-keyword">if</span> (socketType == <span class="hljs-string">"HTTP"</span>) {
<a class="line-num" href="#line-386" id="line-386" data-line="386"></a>            resp2 = ((selectica::client&lt;SimpleWeb::HTTP&gt;*)obj)-&gt;UpdateBO();
<a class="line-num" href="#line-387" id="line-387" data-line="387"></a>          } <span class="hljs-keyword">else</span> {
<a class="line-num" href="#line-388" id="line-388" data-line="388"></a>            resp2 = ((selectica::client&lt;SimpleWeb::HTTPS&gt;*)obj)-&gt;UpdateBO();
<a class="line-num" href="#line-389" id="line-389" data-line="389"></a>          }
<a class="line-num" href="#line-390" id="line-390" data-line="390"></a>          <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-391" id="line-391" data-line="391"></a>        };
<a class="line-num" href="#line-392" id="line-392" data-line="392"></a>  
<a class="line-num" href="#line-393" id="line-393" data-line="393"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-50" id="section-50"></a>
</div>
<p>######constructClickStatusBody()
<strong>constructClickStatusBody(ctx, param) =&gt; ctx</strong></p>
<div class="dox">
<div class="summary">
<p>compile the SOAP body
selectica client will send this action to the store</p>
</div>
<div class="body">
</div>
</div>
<div class="dox">
<div class="summary">
<p>updateClickStatus
For now, update selectica status from selectica client
Next version, selectica client should send XML to store, (new topic required) selectica client should pick up from store and process accordingly</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-404" id="line-404" data-line="404"></a>        <span class="hljs-keyword">auto</span> constructClickStatusBody = [&amp;](<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; ctx, <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> action)-&gt;<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; {
<a class="line-num" href="#line-405" id="line-405" data-line="405"></a>          <span class="hljs-keyword">auto</span> selecticaAgreementId = ctx-&gt;get(<span class="hljs-string">"_uid"</span>).front()[<span class="hljs-string">"_uid"</span>];
<a class="line-num" href="#line-406" id="line-406" data-line="406"></a>          <span class="hljs-keyword">auto</span> statusName = ctx-&gt;get(<span class="hljs-string">"statusName"</span>).front()[<span class="hljs-string">"statusName"</span>];
<a class="line-num" href="#line-407" id="line-407" data-line="407"></a>          <span class="hljs-keyword">auto</span> statusId = ctx-&gt;get(<span class="hljs-string">"statusId"</span>).front()[<span class="hljs-string">"statusId"</span>];
<a class="line-num" href="#line-408" id="line-408" data-line="408"></a>          <span class="hljs-keyword">if</span> (statusId.size() == <span class="hljs-number">0</span> || statusName.size() == <span class="hljs-number">0</span>) {
<a class="line-num" href="#line-409" id="line-409" data-line="409"></a>            <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-410" id="line-410" data-line="410"></a>          }
<a class="line-num" href="#line-411" id="line-411" data-line="411"></a>          <span class="hljs-keyword">auto</span> requestXmlString = make_shared&lt;<span class="hljs-built_in">string</span>&gt;();
<a class="line-num" href="#line-412" id="line-412" data-line="412"></a>          <span class="hljs-keyword">auto</span> context = make_shared&lt;Plustache::Context&gt;();
<a class="line-num" href="#line-413" id="line-413" data-line="413"></a>          context-&gt;add(<span class="hljs-string">"selecticaAgreementId"</span>, selecticaAgreementId);
<a class="line-num" href="#line-414" id="line-414" data-line="414"></a>          context-&gt;add(<span class="hljs-string">"statusName"</span>, statusName);
<a class="line-num" href="#line-415" id="line-415" data-line="415"></a>          context-&gt;add(<span class="hljs-string">"statusId"</span>, statusId);
<a class="line-num" href="#line-416" id="line-416" data-line="416"></a>  
<a class="line-num" href="#line-417" id="line-417" data-line="417"></a>          <span class="hljs-built_in">string</span> tplPath = <span class="hljs-string">"tpl/selectica/toClick/"</span> + action;
<a class="line-num" href="#line-418" id="line-418" data-line="418"></a>          durian::generator&lt;durian::XmlElement::Body&gt; body;
<a class="line-num" href="#line-419" id="line-419" data-line="419"></a>          requestXmlString.swap(body.compile(context, tplPath));
<a class="line-num" href="#line-420" id="line-420" data-line="420"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-51" id="section-51"></a>
</div>
<p>Save to context for next function</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-421" id="line-421" data-line="421"></a>          ctx-&gt;add(<span class="hljs-string">"requestXmlString"</span>, *requestXmlString);
<a class="line-num" href="#line-422" id="line-422" data-line="422"></a>  
<a class="line-num" href="#line-423" id="line-423" data-line="423"></a>          <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-424" id="line-424" data-line="424"></a>        };
<a class="line-num" href="#line-425" id="line-425" data-line="425"></a>  
<a class="line-num" href="#line-426" id="line-426" data-line="426"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-52" id="section-52"></a>
</div>
<p>######sendToStore()
<strong>sendToStore(ctx, param, param2) =&gt; ctx</strong></p>
<div class="dox">
<div class="summary">
<p>Invoke the Selectica client
selectica client should just process this action like a dumb component</p>
</div>
<div class="body">
</div>
</div>
<div class="dox">
<div class="summary">
<p>Should send the generated XML to the store
For now, we will actually process the SOAP request</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-436" id="line-436" data-line="436"></a>        <span class="hljs-keyword">auto</span> sendToStore = [&amp;](<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; ctx, json11::Json clickRnumber, <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> action)-&gt;<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; {
<a class="line-num" href="#line-437" id="line-437" data-line="437"></a>          <span class="hljs-built_in">string</span> requestXmlString = ctx-&gt;get(<span class="hljs-string">"requestXmlString"</span>).front()[<span class="hljs-string">"requestXmlString"</span>];
<a class="line-num" href="#line-438" id="line-438" data-line="438"></a>          <span class="hljs-keyword">if</span> (requestXmlString.size() == <span class="hljs-number">0</span>) {
<a class="line-num" href="#line-439" id="line-439" data-line="439"></a>            <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-440" id="line-440" data-line="440"></a>          }
<a class="line-num" href="#line-441" id="line-441" data-line="441"></a>  
<a class="line-num" href="#line-442" id="line-442" data-line="442"></a>          <span class="hljs-built_in">std</span>::<span class="hljs-built_in">map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; customHeaders1 = { { <span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"text/xml"</span> }, { <span class="hljs-string">"SOAPAction"</span>, <span class="hljs-string">"http://selecticacommerce.com/Extranet/WebServices/Login"</span> } };
<a class="line-num" href="#line-443" id="line-443" data-line="443"></a>          click::client&lt;SimpleWeb::HTTP&gt; clickClient(clickRnumber[<span class="hljs-string">"host"</span>].string_value().c_str(),
<a class="line-num" href="#line-444" id="line-444" data-line="444"></a>            clickRnumber[<span class="hljs-string">"entityServicePath"</span>].string_value().c_str(),
<a class="line-num" href="#line-445" id="line-445" data-line="445"></a>            clickRnumber[<span class="hljs-string">"esetServicePath"</span>].string_value().c_str(),
<a class="line-num" href="#line-446" id="line-446" data-line="446"></a>            clickRnumber[<span class="hljs-string">"dataManagementServicePath"</span>].string_value().c_str(),
<a class="line-num" href="#line-447" id="line-447" data-line="447"></a>            clickRnumber[<span class="hljs-string">"searchServicePath"</span>].string_value().c_str(),
<a class="line-num" href="#line-448" id="line-448" data-line="448"></a>            clickRnumber[<span class="hljs-string">"user"</span>].string_value().c_str(), clickRnumber[<span class="hljs-string">"pass"</span>].string_value().c_str(), customHeaders1);
<a class="line-num" href="#line-449" id="line-449" data-line="449"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-53" id="section-53"></a>
</div>
<p>__Heads up!</p>
<p>__b/c durian only appends &quot;user&quot; to context, we also need to append userName to context</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-452" id="line-452" data-line="452"></a>          clickClient.getContext()-&gt;add(<span class="hljs-string">"userName"</span>, clickRnumber[<span class="hljs-string">"user"</span>].string_value().c_str());
<a class="line-num" href="#line-453" id="line-453" data-line="453"></a>          clickClient.getContext()-&gt;add(<span class="hljs-string">"storeName"</span>, <span class="hljs-string">"ResearchNavigator"</span>);
<a class="line-num" href="#line-454" id="line-454" data-line="454"></a>  
<a class="line-num" href="#line-455" id="line-455" data-line="455"></a>          clickClient.InvokeDataManagement(action, requestXmlString);
<a class="line-num" href="#line-456" id="line-456" data-line="456"></a>  
<a class="line-num" href="#line-457" id="line-457" data-line="457"></a>          ctx-&gt;add(<span class="hljs-string">"sendToStore"</span>, requestXmlString);
<a class="line-num" href="#line-458" id="line-458" data-line="458"></a>          durian::addToLog(MODULE, ctx, <span class="hljs-string">"sendToStore"</span>);
<a class="line-num" href="#line-459" id="line-459" data-line="459"></a>  
<a class="line-num" href="#line-460" id="line-460" data-line="460"></a>          <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-461" id="line-461" data-line="461"></a>        };
<a class="line-num" href="#line-462" id="line-462" data-line="462"></a>  
<a class="line-num" href="#line-463" id="line-463" data-line="463"></a>      } <span class="hljs-comment">// le fin selectica::integration::actions namespace</span>
<a class="line-num" href="#line-464" id="line-464" data-line="464"></a>    }
<a class="line-num" href="#line-465" id="line-465" data-line="465"></a>  }
<a class="line-num" href="#line-466" id="line-466" data-line="466"></a>  
<a class="line-num" href="#line-467" id="line-467" data-line="467"></a>  </pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
