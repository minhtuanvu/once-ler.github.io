<!DOCTYPE html>
<html>
<head>
  <title>selectica.h</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "C:\\cygwin64\\home\\htao\\harmony-middleware-doc\\\\middleware\\selectica\\selectica.h";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>selectica.h</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-1" id="line-1" data-line="1"></a>  <span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> once</span>
<a class="line-num" href="#line-2" id="line-2" data-line="2"></a>  
<a class="line-num" href="#line-3" id="line-3" data-line="3"></a>  <span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> SELECTICA_H</span>
<a class="line-num" href="#line-4" id="line-4" data-line="4"></a>  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SELECTICA_H</span>
<a class="line-num" href="#line-5" id="line-5" data-line="5"></a>  
<a class="line-num" href="#line-6" id="line-6" data-line="6"></a>  <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"durian.h"</span></span>
<a class="line-num" href="#line-7" id="line-7" data-line="7"></a>  <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"click.h"</span></span>
<a class="line-num" href="#line-8" id="line-8" data-line="8"></a>  <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;functional&gt;</span></span>
<a class="line-num" href="#line-9" id="line-9" data-line="9"></a>  <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span>
<a class="line-num" href="#line-10" id="line-10" data-line="10"></a>  
<a class="line-num" href="#line-11" id="line-11" data-line="11"></a>  <span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;
<a class="line-num" href="#line-12" id="line-12" data-line="12"></a>  <span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> durian;
<a class="line-num" href="#line-13" id="line-13" data-line="13"></a>  
<a class="line-num" href="#line-14" id="line-14" data-line="14"></a>  <span class="hljs-keyword">namespace</span> selectica {
<a class="line-num" href="#line-15" id="line-15" data-line="15"></a>  
<a class="line-num" href="#line-16" id="line-16" data-line="16"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>should contain global context/config
static Plustache::Context context;
static json11::Json config;</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-19" id="line-19" data-line="19"></a>    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">MODULE</span><span class="hljs-params">(<span class="hljs-string">"selectica 0.4.0"</span>)</span></span>;
<a class="line-num" href="#line-20" id="line-20" data-line="20"></a>  
<a class="line-num" href="#line-21" id="line-21" data-line="21"></a>    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> socketType&gt;
<a class="line-num" href="#line-22" id="line-22" data-line="22"></a>    <span class="hljs-keyword">class</span> client : <span class="hljs-keyword">public</span> durian::client&lt;socketType&gt; {
<a class="line-num" href="#line-23" id="line-23" data-line="23"></a>    <span class="hljs-keyword">public</span>:
<a class="line-num" href="#line-24" id="line-24" data-line="24"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>remove after implementation of sendToStore</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-25" id="line-25" data-line="25"></a>      json11::Json clickNumber;
<a class="line-num" href="#line-26" id="line-26" data-line="26"></a>  
<a class="line-num" href="#line-27" id="line-27" data-line="27"></a>      client(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* <span class="hljs-number">_</span>host,
<a class="line-num" href="#line-28" id="line-28" data-line="28"></a>        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* <span class="hljs-number">_</span>servicePath,
<a class="line-num" href="#line-29" id="line-29" data-line="29"></a>        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* <span class="hljs-number">_u</span>ser,
<a class="line-num" href="#line-30" id="line-30" data-line="30"></a>        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* <span class="hljs-number">_</span>password,
<a class="line-num" href="#line-31" id="line-31" data-line="31"></a>        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;&amp; <span class="hljs-number">_</span>customHeaders) : durian::client&lt;socketType&gt;(<span class="hljs-number">_</span>host, <span class="hljs-number">_</span>servicePath, <span class="hljs-number">_u</span>ser, <span class="hljs-number">_</span>password, <span class="hljs-number">_</span>customHeaders) {}
<a class="line-num" href="#line-32" id="line-32" data-line="32"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>required constructor before click can be its own lib</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-33" id="line-33" data-line="33"></a>      client(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* <span class="hljs-number">_</span>host,
<a class="line-num" href="#line-34" id="line-34" data-line="34"></a>        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* <span class="hljs-number">_</span>servicePath,
<a class="line-num" href="#line-35" id="line-35" data-line="35"></a>        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* <span class="hljs-number">_u</span>ser,
<a class="line-num" href="#line-36" id="line-36" data-line="36"></a>        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* <span class="hljs-number">_</span>password,
<a class="line-num" href="#line-37" id="line-37" data-line="37"></a>        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;&amp; <span class="hljs-number">_</span>customHeaders, json11::Json <span class="hljs-number">_</span>clickRnumber) : durian::client&lt;socketType&gt;(<span class="hljs-number">_</span>host, <span class="hljs-number">_</span>servicePath, <span class="hljs-number">_u</span>ser, <span class="hljs-number">_</span>password, <span class="hljs-number">_</span>customHeaders) {
<a class="line-num" href="#line-38" id="line-38" data-line="38"></a>        clickNumber = <span class="hljs-number">_</span>clickRnumber;
<a class="line-num" href="#line-39" id="line-39" data-line="39"></a>      }
<a class="line-num" href="#line-40" id="line-40" data-line="40"></a>  
<a class="line-num" href="#line-41" id="line-41" data-line="41"></a>      <span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; selectica::client&lt;socketType&gt;::GetBOTypes() {
<a class="line-num" href="#line-42" id="line-42" data-line="42"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>get a login future</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-43" id="line-43" data-line="43"></a>        <span class="hljs-keyword">auto</span> login = <span class="hljs-keyword">this</span>-&gt;apiClient-&gt;methodPromise[<span class="hljs-string">"POST"</span>];
<a class="line-num" href="#line-44" id="line-44" data-line="44"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>get login template</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-45" id="line-45" data-line="45"></a>        <span class="hljs-keyword">auto</span> loginXml = <span class="hljs-keyword">this</span>-&gt;generator.render(ctx, <span class="hljs-string">"tpl/selectica/Login"</span>, <span class="hljs-string">"tpl/selectica/root"</span>);
<a class="line-num" href="#line-46" id="line-46" data-line="46"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>start the promises</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-47" id="line-47" data-line="47"></a>        <span class="hljs-keyword">auto</span> promises = login(servicePath, *loginXml, customHeaders)
<a class="line-num" href="#line-48" id="line-48" data-line="48"></a>          .then(loginResponse(<span class="hljs-keyword">this</span>-&gt;ctx))
<a class="line-num" href="#line-49" id="line-49" data-line="49"></a>          .then(getBOTypes(<span class="hljs-keyword">this</span>-&gt;ctx, <span class="hljs-string">"tpl/selectica/GetBOTypes"</span>, <span class="hljs-string">"tpl/selectica/root"</span>, target))
<a class="line-num" href="#line-50" id="line-50" data-line="50"></a>          .then(getBOTypesResponse())
<a class="line-num" href="#line-51" id="line-51" data-line="51"></a>          .then(logout(<span class="hljs-keyword">this</span>-&gt;ctx, <span class="hljs-string">"tpl/selectica/Logout"</span>, <span class="hljs-string">"tpl/selectica/root"</span>))
<a class="line-num" href="#line-52" id="line-52" data-line="52"></a>          .then(logoutResponse());
<a class="line-num" href="#line-53" id="line-53" data-line="53"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>wait</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-54" id="line-54" data-line="54"></a>        <span class="hljs-keyword">auto</span> resp = promises.get();
<a class="line-num" href="#line-55" id="line-55" data-line="55"></a>  
<a class="line-num" href="#line-56" id="line-56" data-line="56"></a>        <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-57" id="line-57" data-line="57"></a>      }
<a class="line-num" href="#line-58" id="line-58" data-line="58"></a>  
<a class="line-num" href="#line-59" id="line-59" data-line="59"></a>      <span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; selectica::client&lt;socketType&gt;::GetTrackingNums(<span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> boType) {
<a class="line-num" href="#line-60" id="line-60" data-line="60"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>get a login future</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-61" id="line-61" data-line="61"></a>        <span class="hljs-keyword">auto</span> login = <span class="hljs-keyword">this</span>-&gt;apiClient-&gt;methodPromise[<span class="hljs-string">"POST"</span>];
<a class="line-num" href="#line-62" id="line-62" data-line="62"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>get login template</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-63" id="line-63" data-line="63"></a>        <span class="hljs-keyword">auto</span> loginXml = <span class="hljs-keyword">this</span>-&gt;generator.render(ctx, <span class="hljs-string">"tpl/selectica/Login"</span>, <span class="hljs-string">"tpl/selectica/root"</span>);
<a class="line-num" href="#line-64" id="line-64" data-line="64"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>start the promises</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-65" id="line-65" data-line="65"></a>        <span class="hljs-keyword">auto</span> promises = login(servicePath, *loginXml, customHeaders)
<a class="line-num" href="#line-66" id="line-66" data-line="66"></a>          .then(loginResponse(<span class="hljs-keyword">this</span>-&gt;ctx))
<a class="line-num" href="#line-67" id="line-67" data-line="67"></a>          .then(getTrackingNums(<span class="hljs-keyword">this</span>-&gt;ctx, <span class="hljs-string">"tpl/selectica/GetTrackingNums"</span>, <span class="hljs-string">"tpl/selectica/root"</span>, boType))
<a class="line-num" href="#line-68" id="line-68" data-line="68"></a>          .then(getTrackingNumsResponse())
<a class="line-num" href="#line-69" id="line-69" data-line="69"></a>          .then(logout(<span class="hljs-keyword">this</span>-&gt;ctx, <span class="hljs-string">"tpl/selectica/Logout"</span>, <span class="hljs-string">"tpl/selectica/root"</span>))
<a class="line-num" href="#line-70" id="line-70" data-line="70"></a>          .then(logoutResponse());
<a class="line-num" href="#line-71" id="line-71" data-line="71"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>wait</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-72" id="line-72" data-line="72"></a>        <span class="hljs-keyword">auto</span> resp = promises.get();
<a class="line-num" href="#line-73" id="line-73" data-line="73"></a>  
<a class="line-num" href="#line-74" id="line-74" data-line="74"></a>        <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-75" id="line-75" data-line="75"></a>      }
<a class="line-num" href="#line-76" id="line-76" data-line="76"></a>  
<a class="line-num" href="#line-77" id="line-77" data-line="77"></a>      <span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; selectica::client&lt;socketType&gt;::GetData(<span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> target) {
<a class="line-num" href="#line-78" id="line-78" data-line="78"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>get a login future</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-79" id="line-79" data-line="79"></a>        <span class="hljs-keyword">auto</span> login = <span class="hljs-keyword">this</span>-&gt;apiClient-&gt;methodPromise[<span class="hljs-string">"POST"</span>];
<a class="line-num" href="#line-80" id="line-80" data-line="80"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>get login template</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-81" id="line-81" data-line="81"></a>        <span class="hljs-keyword">auto</span> loginXml = <span class="hljs-keyword">this</span>-&gt;generator.render(ctx, <span class="hljs-string">"tpl/selectica/Login"</span>, <span class="hljs-string">"tpl/selectica/root"</span>);
<a class="line-num" href="#line-82" id="line-82" data-line="82"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>start the promises</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-83" id="line-83" data-line="83"></a>        <span class="hljs-keyword">auto</span> promises = login(servicePath, *loginXml, customHeaders)
<a class="line-num" href="#line-84" id="line-84" data-line="84"></a>          .then(loginResponse(<span class="hljs-keyword">this</span>-&gt;ctx))
<a class="line-num" href="#line-85" id="line-85" data-line="85"></a>          .then(getData(<span class="hljs-keyword">this</span>-&gt;ctx, <span class="hljs-string">"tpl/selectica/GetData"</span>, <span class="hljs-string">"tpl/selectica/root"</span>, target))
<a class="line-num" href="#line-86" id="line-86" data-line="86"></a>          .then(getDataResponse())
<a class="line-num" href="#line-87" id="line-87" data-line="87"></a>          .then(logout(<span class="hljs-keyword">this</span>-&gt;ctx, <span class="hljs-string">"tpl/selectica/Logout"</span>, <span class="hljs-string">"tpl/selectica/root"</span>))
<a class="line-num" href="#line-88" id="line-88" data-line="88"></a>          .then(logoutResponse());
<a class="line-num" href="#line-89" id="line-89" data-line="89"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>wait</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-90" id="line-90" data-line="90"></a>        <span class="hljs-keyword">auto</span> resp = promises.get();
<a class="line-num" href="#line-91" id="line-91" data-line="91"></a>        <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-92" id="line-92" data-line="92"></a>      }
<a class="line-num" href="#line-93" id="line-93" data-line="93"></a>  
<a class="line-num" href="#line-94" id="line-94" data-line="94"></a>      <span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; selectica::client&lt;socketType&gt;::CreateBO() {
<a class="line-num" href="#line-95" id="line-95" data-line="95"></a>        <span class="hljs-keyword">this</span>-&gt;getContext()-&gt;add(<span class="hljs-string">"boType"</span>, <span class="hljs-string">"NYUResearchBO"</span>);
<a class="line-num" href="#line-96" id="line-96" data-line="96"></a>        <span class="hljs-keyword">this</span>-&gt;getContext()-&gt;add(<span class="hljs-string">"listType"</span>, <span class="hljs-string">"ReqResearchInfo"</span>);
<a class="line-num" href="#line-97" id="line-97" data-line="97"></a>        <span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">bodyXml</span><span class="hljs-params">(<span class="hljs-string">"tpl/selectica/CreateBO"</span>)</span></span>;
<a class="line-num" href="#line-98" id="line-98" data-line="98"></a>        <span class="hljs-keyword">auto</span> trackingNumber = <span class="hljs-keyword">this</span>-&gt;getContext()-&gt;get(<span class="hljs-string">"trackingNumber"</span>).front()[<span class="hljs-string">"trackingNumber"</span>];
<a class="line-num" href="#line-99" id="line-99" data-line="99"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>exit if contract already exists</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-100" id="line-100" data-line="100"></a>        <span class="hljs-keyword">if</span> (trackingNumber.size() &gt; <span class="hljs-number">0</span>) {
<a class="line-num" href="#line-101" id="line-101" data-line="101"></a>          <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-102" id="line-102" data-line="102"></a>        }
<a class="line-num" href="#line-103" id="line-103" data-line="103"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>get a login future</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-104" id="line-104" data-line="104"></a>        <span class="hljs-keyword">auto</span> login = <span class="hljs-keyword">this</span>-&gt;apiClient-&gt;methodPromise[<span class="hljs-string">"POST"</span>];
<a class="line-num" href="#line-105" id="line-105" data-line="105"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>get login template</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-106" id="line-106" data-line="106"></a>        <span class="hljs-keyword">auto</span> loginXml = <span class="hljs-keyword">this</span>-&gt;generator.render(<span class="hljs-keyword">this</span>-&gt;ctx, <span class="hljs-string">"tpl/selectica/Login"</span>, <span class="hljs-string">"tpl/selectica/root"</span>);
<a class="line-num" href="#line-107" id="line-107" data-line="107"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>start the promises</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-108" id="line-108" data-line="108"></a>        <span class="hljs-keyword">auto</span> promises = login(servicePath, *loginXml, customHeaders)
<a class="line-num" href="#line-109" id="line-109" data-line="109"></a>          .then(loginResponse(<span class="hljs-keyword">this</span>-&gt;ctx))
<a class="line-num" href="#line-110" id="line-110" data-line="110"></a>          .then(createBO(<span class="hljs-keyword">this</span>-&gt;ctx, bodyXml, <span class="hljs-string">"tpl/selectica/root"</span>))
<a class="line-num" href="#line-111" id="line-111" data-line="111"></a>          .then(createBOResponse())
<a class="line-num" href="#line-112" id="line-112" data-line="112"></a>          .then(logout(<span class="hljs-keyword">this</span>-&gt;ctx, <span class="hljs-string">"tpl/selectica/Logout"</span>, <span class="hljs-string">"tpl/selectica/root"</span>))
<a class="line-num" href="#line-113" id="line-113" data-line="113"></a>          .then(logoutResponse());
<a class="line-num" href="#line-114" id="line-114" data-line="114"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>wait</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-115" id="line-115" data-line="115"></a>        <span class="hljs-keyword">auto</span> resp = promises.get();
<a class="line-num" href="#line-116" id="line-116" data-line="116"></a>  
<a class="line-num" href="#line-117" id="line-117" data-line="117"></a>        <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-118" id="line-118" data-line="118"></a>      }
<a class="line-num" href="#line-119" id="line-119" data-line="119"></a>  
<a class="line-num" href="#line-120" id="line-120" data-line="120"></a>      <span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; selectica::client&lt;socketType&gt;::UpdateBO() {
<a class="line-num" href="#line-121" id="line-121" data-line="121"></a>        <span class="hljs-keyword">auto</span> trackingNumber = <span class="hljs-keyword">this</span>-&gt;getContext()-&gt;get(<span class="hljs-string">"trackingNumber"</span>).front()[<span class="hljs-string">"trackingNumber"</span>];
<a class="line-num" href="#line-122" id="line-122" data-line="122"></a>        <span class="hljs-keyword">if</span> (trackingNumber.size() == <span class="hljs-number">0</span>){
<a class="line-num" href="#line-123" id="line-123" data-line="123"></a>          <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-124" id="line-124" data-line="124"></a>        }
<a class="line-num" href="#line-125" id="line-125" data-line="125"></a>        <span class="hljs-keyword">this</span>-&gt;getContext()-&gt;add(<span class="hljs-string">"listType"</span>, <span class="hljs-string">"ReqResearchInfo"</span>);
<a class="line-num" href="#line-126" id="line-126" data-line="126"></a>        <span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">bodyXml</span><span class="hljs-params">(<span class="hljs-string">"tpl/selectica/UpdateBO"</span>)</span></span>;      
<a class="line-num" href="#line-127" id="line-127" data-line="127"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>get a login future</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-128" id="line-128" data-line="128"></a>        <span class="hljs-keyword">auto</span> login = <span class="hljs-keyword">this</span>-&gt;apiClient-&gt;methodPromise[<span class="hljs-string">"POST"</span>];
<a class="line-num" href="#line-129" id="line-129" data-line="129"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>get login template</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-130" id="line-130" data-line="130"></a>        <span class="hljs-keyword">auto</span> loginXml = <span class="hljs-keyword">this</span>-&gt;generator.render(<span class="hljs-keyword">this</span>-&gt;ctx, <span class="hljs-string">"tpl/selectica/Login"</span>, <span class="hljs-string">"tpl/selectica/root"</span>);
<a class="line-num" href="#line-131" id="line-131" data-line="131"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>start the promises</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-132" id="line-132" data-line="132"></a>        <span class="hljs-keyword">auto</span> promises = login(servicePath, *loginXml, customHeaders)
<a class="line-num" href="#line-133" id="line-133" data-line="133"></a>          .then(loginResponse(<span class="hljs-keyword">this</span>-&gt;ctx))
<a class="line-num" href="#line-134" id="line-134" data-line="134"></a>          .then(updateBO(<span class="hljs-keyword">this</span>-&gt;ctx, bodyXml, <span class="hljs-string">"tpl/selectica/root"</span>))
<a class="line-num" href="#line-135" id="line-135" data-line="135"></a>          .then(updateBOResponse())
<a class="line-num" href="#line-136" id="line-136" data-line="136"></a>          .then(logout(<span class="hljs-keyword">this</span>-&gt;ctx, <span class="hljs-string">"tpl/selectica/Logout"</span>, <span class="hljs-string">"tpl/selectica/root"</span>))
<a class="line-num" href="#line-137" id="line-137" data-line="137"></a>          .then(logoutResponse());
<a class="line-num" href="#line-138" id="line-138" data-line="138"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>wait</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-139" id="line-139" data-line="139"></a>        <span class="hljs-keyword">auto</span> resp = promises.get();
<a class="line-num" href="#line-140" id="line-140" data-line="140"></a>  
<a class="line-num" href="#line-141" id="line-141" data-line="141"></a>        <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-142" id="line-142" data-line="142"></a>      }
<a class="line-num" href="#line-143" id="line-143" data-line="143"></a>  
<a class="line-num" href="#line-144" id="line-144" data-line="144"></a>      <span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; selectica::client&lt;socketType&gt;::DeleteBO(<span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> trackingNumber) {
<a class="line-num" href="#line-145" id="line-145" data-line="145"></a>        <span class="hljs-keyword">this</span>-&gt;getContext()-&gt;add(<span class="hljs-string">"trackingNumber"</span>, trackingNumber);
<a class="line-num" href="#line-146" id="line-146" data-line="146"></a>        <span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">bodyXml</span><span class="hljs-params">(<span class="hljs-string">"tpl/selectica/DeleteBO"</span>)</span></span>;
<a class="line-num" href="#line-147" id="line-147" data-line="147"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>get a login future</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-148" id="line-148" data-line="148"></a>        <span class="hljs-keyword">auto</span> login = <span class="hljs-keyword">this</span>-&gt;apiClient-&gt;methodPromise[<span class="hljs-string">"POST"</span>];
<a class="line-num" href="#line-149" id="line-149" data-line="149"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<p>get login template</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-150" id="line-150" data-line="150"></a>        <span class="hljs-keyword">auto</span> loginXml = <span class="hljs-keyword">this</span>-&gt;generator.render(<span class="hljs-keyword">this</span>-&gt;ctx, <span class="hljs-string">"tpl/selectica/Login"</span>, <span class="hljs-string">"tpl/selectica/root"</span>);
<a class="line-num" href="#line-151" id="line-151" data-line="151"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<p>start the promises</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-152" id="line-152" data-line="152"></a>        <span class="hljs-keyword">auto</span> promises = login(servicePath, *loginXml, customHeaders)
<a class="line-num" href="#line-153" id="line-153" data-line="153"></a>          .then(loginResponse(<span class="hljs-keyword">this</span>-&gt;ctx))
<a class="line-num" href="#line-154" id="line-154" data-line="154"></a>          .then(deleteBO(<span class="hljs-keyword">this</span>-&gt;ctx, bodyXml, <span class="hljs-string">"tpl/selectica/root"</span>))
<a class="line-num" href="#line-155" id="line-155" data-line="155"></a>          .then(deleteBOResponse())
<a class="line-num" href="#line-156" id="line-156" data-line="156"></a>          .then(logout(<span class="hljs-keyword">this</span>-&gt;ctx, <span class="hljs-string">"tpl/selectica/Logout"</span>, <span class="hljs-string">"tpl/selectica/root"</span>))
<a class="line-num" href="#line-157" id="line-157" data-line="157"></a>          .then(logoutResponse());
<a class="line-num" href="#line-158" id="line-158" data-line="158"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>wait</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-159" id="line-159" data-line="159"></a>        <span class="hljs-keyword">auto</span> resp = promises.get();
<a class="line-num" href="#line-160" id="line-160" data-line="160"></a>        <span class="hljs-keyword">return</span> ctx;
<a class="line-num" href="#line-161" id="line-161" data-line="161"></a>      }
<a class="line-num" href="#line-162" id="line-162" data-line="162"></a>  
<a class="line-num" href="#line-163" id="line-163" data-line="163"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>overrides</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-164" id="line-164" data-line="164"></a>      <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">loadMapping</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* filename)</span> override </span>{
<a class="line-num" href="#line-165" id="line-165" data-line="165"></a>        PlustacheTypes::CollectionType pl;
<a class="line-num" href="#line-166" id="line-166" data-line="166"></a>        
<a class="line-num" href="#line-167" id="line-167" data-line="167"></a>        ifstream ifs;
<a class="line-num" href="#line-168" id="line-168" data-line="168"></a>        ifs.open(filename, ios::in | ios::binary);
<a class="line-num" href="#line-169" id="line-169" data-line="169"></a>  
<a class="line-num" href="#line-170" id="line-170" data-line="170"></a>        <span class="hljs-keyword">if</span> (ifs){
<a class="line-num" href="#line-171" id="line-171" data-line="171"></a>          <span class="hljs-built_in">stringstream</span> ss;
<a class="line-num" href="#line-172" id="line-172" data-line="172"></a>          ss &lt;&lt; ifs.rdbuf();
<a class="line-num" href="#line-173" id="line-173" data-line="173"></a>  
<a class="line-num" href="#line-174" id="line-174" data-line="174"></a>          <span class="hljs-built_in">string</span> err;
<a class="line-num" href="#line-175" id="line-175" data-line="175"></a>          <span class="hljs-keyword">auto</span> d = json11::Json::parse(ss.str(), err, json11::STANDARD);
<a class="line-num" href="#line-176" id="line-176" data-line="176"></a>  
<a class="line-num" href="#line-177" id="line-177" data-line="177"></a>          <span class="hljs-keyword">if</span> (err.size() &gt; <span class="hljs-number">0</span>) {
<a class="line-num" href="#line-178" id="line-178" data-line="178"></a>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
<a class="line-num" href="#line-179" id="line-179" data-line="179"></a>          }
<a class="line-num" href="#line-180" id="line-180" data-line="180"></a>  
<a class="line-num" href="#line-181" id="line-181" data-line="181"></a>          <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> propList = d[<span class="hljs-string">"CreateBO"</span>];
<a class="line-num" href="#line-182" id="line-182" data-line="182"></a>  
<a class="line-num" href="#line-183" id="line-183" data-line="183"></a>          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span>&amp; e : propList.array_items()){
<a class="line-num" href="#line-184" id="line-184" data-line="184"></a>            PlustacheTypes::ObjectType p;
<a class="line-num" href="#line-185" id="line-185" data-line="185"></a>            p[<span class="hljs-string">"key"</span>] = e[<span class="hljs-string">"key"</span>].string_value();
<a class="line-num" href="#line-186" id="line-186" data-line="186"></a>            p[<span class="hljs-string">"dataType"</span>] = e[<span class="hljs-string">"dataType"</span>].string_value();
<a class="line-num" href="#line-187" id="line-187" data-line="187"></a>  
<a class="line-num" href="#line-188" id="line-188" data-line="188"></a>            <span class="hljs-keyword">if</span> (e[<span class="hljs-string">"value"</span>].is_array()) {
<a class="line-num" href="#line-189" id="line-189" data-line="189"></a>              p[<span class="hljs-string">"value"</span>] = e[<span class="hljs-string">"value"</span>].dump();
<a class="line-num" href="#line-190" id="line-190" data-line="190"></a>            } <span class="hljs-keyword">else</span> {
<a class="line-num" href="#line-191" id="line-191" data-line="191"></a>              p[<span class="hljs-string">"value"</span>] = e[<span class="hljs-string">"value"</span>].string_value();
<a class="line-num" href="#line-192" id="line-192" data-line="192"></a>            }
<a class="line-num" href="#line-193" id="line-193" data-line="193"></a>            
<a class="line-num" href="#line-194" id="line-194" data-line="194"></a>            pl.push_back(p);
<a class="line-num" href="#line-195" id="line-195" data-line="195"></a>          }
<a class="line-num" href="#line-196" id="line-196" data-line="196"></a>          <span class="hljs-keyword">this</span>-&gt;ctx-&gt;add(<span class="hljs-string">"CreateBOMap"</span>, pl);
<a class="line-num" href="#line-197" id="line-197" data-line="197"></a>  
<a class="line-num" href="#line-198" id="line-198" data-line="198"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>now get status names from Selectica and map it to Click</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-199" id="line-199" data-line="199"></a>          <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> selecticaToClickStatus = d[<span class="hljs-string">"SelecticaToClickStatus"</span>];
<a class="line-num" href="#line-200" id="line-200" data-line="200"></a>          PlustacheTypes::ObjectType p;
<a class="line-num" href="#line-201" id="line-201" data-line="201"></a>          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span>&amp; e : selecticaToClickStatus.array_items()) {
<a class="line-num" href="#line-202" id="line-202" data-line="202"></a>            p[e[<span class="hljs-string">"name"</span>].string_value()] = e[<span class="hljs-string">"id"</span>].string_value();
<a class="line-num" href="#line-203" id="line-203" data-line="203"></a>          }
<a class="line-num" href="#line-204" id="line-204" data-line="204"></a>          <span class="hljs-keyword">this</span>-&gt;ctx-&gt;add(<span class="hljs-string">"SelecticaToClickStatusMap"</span>, p);
<a class="line-num" href="#line-205" id="line-205" data-line="205"></a>  
<a class="line-num" href="#line-206" id="line-206" data-line="206"></a>          ifs.close();
<a class="line-num" href="#line-207" id="line-207" data-line="207"></a>          <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
<a class="line-num" href="#line-208" id="line-208" data-line="208"></a>        }
<a class="line-num" href="#line-209" id="line-209" data-line="209"></a>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
<a class="line-num" href="#line-210" id="line-210" data-line="210"></a>      }    
<a class="line-num" href="#line-211" id="line-211" data-line="211"></a>  
<a class="line-num" href="#line-212" id="line-212" data-line="212"></a>    <span class="hljs-keyword">private</span>:
<a class="line-num" href="#line-213" id="line-213" data-line="213"></a>  
<a class="line-num" href="#line-214" id="line-214" data-line="214"></a>      <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">checkResponseForError</span><span class="hljs-params">(<span class="hljs-built_in">string</span>&amp; raw)</span> </span>{
<a class="line-num" href="#line-215" id="line-215" data-line="215"></a>        <span class="hljs-keyword">int</span> hasError = <span class="hljs-number">0</span>;
<a class="line-num" href="#line-216" id="line-216" data-line="216"></a>        <span class="hljs-keyword">struct</span> json_token *arr, *tok;
<a class="line-num" href="#line-217" id="line-217" data-line="217"></a>        arr = parse_json2(raw.c_str(), raw.size());
<a class="line-num" href="#line-218" id="line-218" data-line="218"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<p>Envelope.Body.Fault.detail.ECMServiceExceptionElement.errorMessage</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-219" id="line-219" data-line="219"></a>        tok = find_json_token(arr, <span class="hljs-string">"Envelope.Body.Fault.faultstring"</span>);
<a class="line-num" href="#line-220" id="line-220" data-line="220"></a>        <span class="hljs-keyword">if</span> (tok) {
<a class="line-num" href="#line-221" id="line-221" data-line="221"></a>          <span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">a</span><span class="hljs-params">(tok-&gt;ptr, tok-&gt;len)</span></span>;
<a class="line-num" href="#line-222" id="line-222" data-line="222"></a>          raw = a;
<a class="line-num" href="#line-223" id="line-223" data-line="223"></a>          ctx-&gt;add(<span class="hljs-string">"checkResponseForError"</span>, raw);
<a class="line-num" href="#line-224" id="line-224" data-line="224"></a>          durian::addToLog(MODULE, ctx, <span class="hljs-string">"checkResponseForError"</span>);
<a class="line-num" href="#line-225" id="line-225" data-line="225"></a>          hasError = <span class="hljs-number">1</span>;
<a class="line-num" href="#line-226" id="line-226" data-line="226"></a>        }
<a class="line-num" href="#line-227" id="line-227" data-line="227"></a>        <span class="hljs-built_in">free</span>(arr);
<a class="line-num" href="#line-228" id="line-228" data-line="228"></a>        <span class="hljs-keyword">return</span> hasError;
<a class="line-num" href="#line-229" id="line-229" data-line="229"></a>      }
<a class="line-num" href="#line-230" id="line-230" data-line="230"></a>  
<a class="line-num" href="#line-231" id="line-231" data-line="231"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<div class="dox">
<div class="summary">
<p>Soap Action implementations</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-234" id="line-234" data-line="234"></a>  
<a class="line-num" href="#line-235" id="line-235" data-line="235"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<p>GetData</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-236" id="line-236" data-line="236"></a>      <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-built_in">string</span>(boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;)&gt; getData(<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; ctx, <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> bodyTpl, <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> rootTpl, <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> target) {
<a class="line-num" href="#line-237" id="line-237" data-line="237"></a>        <span class="hljs-keyword">return</span> [&amp;, bodyTpl, rootTpl, target](boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt; f)-&gt;<span class="hljs-built_in">string</span>{
<a class="line-num" href="#line-238" id="line-238" data-line="238"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<p>the session token is already stored in the context (ctx)</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-239" id="line-239" data-line="239"></a>          ctx-&gt;add(<span class="hljs-string">"target"</span>, target);
<a class="line-num" href="#line-240" id="line-240" data-line="240"></a>          <span class="hljs-keyword">auto</span> getDataXml = <span class="hljs-keyword">this</span>-&gt;generator.render(ctx, bodyTpl, rootTpl);
<a class="line-num" href="#line-241" id="line-241" data-line="241"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<p>add to context for user</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-242" id="line-242" data-line="242"></a>          ctx-&gt;add(<span class="hljs-string">"getDataXml"</span>, *getDataXml);
<a class="line-num" href="#line-243" id="line-243" data-line="243"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<p>log what was sent</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-244" id="line-244" data-line="244"></a>          durian::addToLog(MODULE, ctx, <span class="hljs-string">"getDataXml"</span>);
<a class="line-num" href="#line-245" id="line-245" data-line="245"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<p>future factory</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-246" id="line-246" data-line="246"></a>          <span class="hljs-keyword">auto</span> future2 = apiClient-&gt;methodPromise[<span class="hljs-string">"POST"</span>];
<a class="line-num" href="#line-247" id="line-247" data-line="247"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<p>create the future</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-248" id="line-248" data-line="248"></a>          <span class="hljs-keyword">auto</span> f2 = future2(servicePath, *getDataXml, customHeaders);
<a class="line-num" href="#line-249" id="line-249" data-line="249"></a>          <span class="hljs-keyword">return</span> f2.get();
<a class="line-num" href="#line-250" id="line-250" data-line="250"></a>        };
<a class="line-num" href="#line-251" id="line-251" data-line="251"></a>      }
<a class="line-num" href="#line-252" id="line-252" data-line="252"></a>  
<a class="line-num" href="#line-253" id="line-253" data-line="253"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<p>GetData response</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-254" id="line-254" data-line="254"></a>      <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-built_in">string</span>(boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;)&gt; getDataResponse() {
<a class="line-num" href="#line-255" id="line-255" data-line="255"></a>        <span class="hljs-keyword">return</span> [&amp;](boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt; fut)-&gt;<span class="hljs-built_in">string</span>{
<a class="line-num" href="#line-256" id="line-256" data-line="256"></a>          <span class="hljs-keyword">auto</span> res = fut.get();
<a class="line-num" href="#line-257" id="line-257" data-line="257"></a>          <span class="hljs-keyword">auto</span> raw = getResponse(res);
<a class="line-num" href="#line-258" id="line-258" data-line="258"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41"></a>
</div>
<p>check for error</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-259" id="line-259" data-line="259"></a>          checkResponseForError(raw);
<a class="line-num" href="#line-260" id="line-260" data-line="260"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42"></a>
</div>
<p>save response in the context, this will be used by the caller</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-261" id="line-261" data-line="261"></a>          ctx-&gt;add(<span class="hljs-string">"GetData"</span>, raw);
<a class="line-num" href="#line-262" id="line-262" data-line="262"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43"></a>
</div>
<p>log what was received</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-263" id="line-263" data-line="263"></a>          durian::addToLog(MODULE, ctx, <span class="hljs-string">"GetData"</span>);
<a class="line-num" href="#line-264" id="line-264" data-line="264"></a>          <span class="hljs-keyword">return</span> raw;
<a class="line-num" href="#line-265" id="line-265" data-line="265"></a>        };
<a class="line-num" href="#line-266" id="line-266" data-line="266"></a>      }
<a class="line-num" href="#line-267" id="line-267" data-line="267"></a>  
<a class="line-num" href="#line-268" id="line-268" data-line="268"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44"></a>
</div>
<p>GetTrackingNums</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-269" id="line-269" data-line="269"></a>      <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-built_in">string</span>(boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;)&gt; getTrackingNums(<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; ctx, <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> bodyTpl, <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> rootTpl, <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> boType) {
<a class="line-num" href="#line-270" id="line-270" data-line="270"></a>        <span class="hljs-keyword">return</span> [&amp;, bodyTpl, rootTpl, boType](boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt; f)-&gt;<span class="hljs-built_in">string</span>{
<a class="line-num" href="#line-271" id="line-271" data-line="271"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45"></a>
</div>
<p>the session token is already stored in the context (ctx)</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-272" id="line-272" data-line="272"></a>          ctx-&gt;add(<span class="hljs-string">"boType"</span>, boType);
<a class="line-num" href="#line-273" id="line-273" data-line="273"></a>          <span class="hljs-keyword">auto</span> getTrackingNumsXml = <span class="hljs-keyword">this</span>-&gt;generator.render(ctx, bodyTpl, rootTpl);
<a class="line-num" href="#line-274" id="line-274" data-line="274"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46"></a>
</div>
<p>add to context for user</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-275" id="line-275" data-line="275"></a>          ctx-&gt;add(<span class="hljs-string">"getTrackingNumsXml"</span>, *getTrackingNumsXml);
<a class="line-num" href="#line-276" id="line-276" data-line="276"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-47" id="section-47"></a>
</div>
<p>log what was sent</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-277" id="line-277" data-line="277"></a>          durian::addToLog(MODULE, ctx, <span class="hljs-string">"getTrackingNumsXml"</span>);
<a class="line-num" href="#line-278" id="line-278" data-line="278"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-48" id="section-48"></a>
</div>
<p>future factory</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-279" id="line-279" data-line="279"></a>          <span class="hljs-keyword">auto</span> future2 = apiClient-&gt;methodPromise[<span class="hljs-string">"POST"</span>];
<a class="line-num" href="#line-280" id="line-280" data-line="280"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-49" id="section-49"></a>
</div>
<p>create the future</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-281" id="line-281" data-line="281"></a>          <span class="hljs-keyword">auto</span> f2 = future2(servicePath, *getTrackingNumsXml, customHeaders);
<a class="line-num" href="#line-282" id="line-282" data-line="282"></a>          <span class="hljs-keyword">return</span> f2.get();
<a class="line-num" href="#line-283" id="line-283" data-line="283"></a>        };
<a class="line-num" href="#line-284" id="line-284" data-line="284"></a>      }
<a class="line-num" href="#line-285" id="line-285" data-line="285"></a>  
<a class="line-num" href="#line-286" id="line-286" data-line="286"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-50" id="section-50"></a>
</div>
<p>GetTrackingNums response</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-287" id="line-287" data-line="287"></a>      <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-built_in">string</span>(boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;)&gt; getTrackingNumsResponse() {
<a class="line-num" href="#line-288" id="line-288" data-line="288"></a>        <span class="hljs-keyword">return</span> [&amp;](boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt; fut)-&gt;<span class="hljs-built_in">string</span>{
<a class="line-num" href="#line-289" id="line-289" data-line="289"></a>          <span class="hljs-keyword">auto</span> res = fut.get();
<a class="line-num" href="#line-290" id="line-290" data-line="290"></a>          <span class="hljs-keyword">auto</span> raw = xml2json(res.c_str());
<a class="line-num" href="#line-291" id="line-291" data-line="291"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-51" id="section-51"></a>
</div>
<p>check for error</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-292" id="line-292" data-line="292"></a>          checkResponseForError(raw);
<a class="line-num" href="#line-293" id="line-293" data-line="293"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-52" id="section-52"></a>
</div>
<p>save response in the context, this will be used by the caller</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-294" id="line-294" data-line="294"></a>          response[<span class="hljs-string">"GetTrackingNums"</span>] = raw;
<a class="line-num" href="#line-295" id="line-295" data-line="295"></a>          (*ctx).add(response);
<a class="line-num" href="#line-296" id="line-296" data-line="296"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-53" id="section-53"></a>
</div>
<p>log what was received</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-297" id="line-297" data-line="297"></a>          durian::addToLog(MODULE, ctx, <span class="hljs-string">"GetTrackingNums"</span>);
<a class="line-num" href="#line-298" id="line-298" data-line="298"></a>          <span class="hljs-keyword">return</span> raw;
<a class="line-num" href="#line-299" id="line-299" data-line="299"></a>        };
<a class="line-num" href="#line-300" id="line-300" data-line="300"></a>      }
<a class="line-num" href="#line-301" id="line-301" data-line="301"></a>  
<a class="line-num" href="#line-302" id="line-302" data-line="302"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-54" id="section-54"></a>
</div>
<p>GetBOTypes</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-303" id="line-303" data-line="303"></a>      <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-built_in">string</span>(boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;)&gt; getBOTypes(<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; ctx, <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> bodyTpl, <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> rootTpl) {
<a class="line-num" href="#line-304" id="line-304" data-line="304"></a>        <span class="hljs-keyword">return</span> [&amp;, bodyTpl, rootTpl](boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt; fut)-&gt;<span class="hljs-built_in">string</span>{
<a class="line-num" href="#line-305" id="line-305" data-line="305"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-55" id="section-55"></a>
</div>
<p>the session token is already stored in the context (ctx)</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-306" id="line-306" data-line="306"></a>          <span class="hljs-keyword">auto</span> getBOTypesXml = <span class="hljs-keyword">this</span>-&gt;generator.render(ctx, bodyTpl, rootTpl);
<a class="line-num" href="#line-307" id="line-307" data-line="307"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-56" id="section-56"></a>
</div>
<p>add to context for user</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-308" id="line-308" data-line="308"></a>          ctx-&gt;add(<span class="hljs-string">"getBOTypesXml"</span>, *getBOTypesXml);
<a class="line-num" href="#line-309" id="line-309" data-line="309"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-57" id="section-57"></a>
</div>
<p>log what was sent</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-310" id="line-310" data-line="310"></a>          durian::addToLog(MODULE, ctx, <span class="hljs-string">"getBOTypesXml"</span>);
<a class="line-num" href="#line-311" id="line-311" data-line="311"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-58" id="section-58"></a>
</div>
<p>future factory</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-312" id="line-312" data-line="312"></a>          <span class="hljs-keyword">auto</span> future2 = apiClient-&gt;methodPromise[<span class="hljs-string">"POST"</span>];
<a class="line-num" href="#line-313" id="line-313" data-line="313"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-59" id="section-59"></a>
</div>
<p>create the future</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-314" id="line-314" data-line="314"></a>          <span class="hljs-keyword">auto</span> f2 = future2(servicePath, *getBOTypesXml, customHeaders);
<a class="line-num" href="#line-315" id="line-315" data-line="315"></a>          <span class="hljs-keyword">return</span> f2.get();
<a class="line-num" href="#line-316" id="line-316" data-line="316"></a>        };
<a class="line-num" href="#line-317" id="line-317" data-line="317"></a>      }
<a class="line-num" href="#line-318" id="line-318" data-line="318"></a>  
<a class="line-num" href="#line-319" id="line-319" data-line="319"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-60" id="section-60"></a>
</div>
<p>GetBOTypes response</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-320" id="line-320" data-line="320"></a>      <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-built_in">string</span>(boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;)&gt; getBOTypesResponse() {
<a class="line-num" href="#line-321" id="line-321" data-line="321"></a>        <span class="hljs-keyword">return</span> [&amp;](boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt; fut)-&gt;<span class="hljs-built_in">string</span>{
<a class="line-num" href="#line-322" id="line-322" data-line="322"></a>          <span class="hljs-keyword">auto</span> res = fut.get();
<a class="line-num" href="#line-323" id="line-323" data-line="323"></a>          <span class="hljs-keyword">auto</span> raw = xml2json(res.c_str());
<a class="line-num" href="#line-324" id="line-324" data-line="324"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-61" id="section-61"></a>
</div>
<p>check for error</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-325" id="line-325" data-line="325"></a>          checkResponseForError(raw);
<a class="line-num" href="#line-326" id="line-326" data-line="326"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-62" id="section-62"></a>
</div>
<p>save response in the context, this will be used by the caller</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-327" id="line-327" data-line="327"></a>          response[<span class="hljs-string">"GetBOTypes"</span>] = raw;
<a class="line-num" href="#line-328" id="line-328" data-line="328"></a>          (*ctx).add(response);
<a class="line-num" href="#line-329" id="line-329" data-line="329"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-63" id="section-63"></a>
</div>
<p>log what was received</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-330" id="line-330" data-line="330"></a>          durian::addToLog(MODULE, ctx, <span class="hljs-string">"GetBOTypes"</span>);
<a class="line-num" href="#line-331" id="line-331" data-line="331"></a>          <span class="hljs-keyword">return</span> raw;
<a class="line-num" href="#line-332" id="line-332" data-line="332"></a>        };
<a class="line-num" href="#line-333" id="line-333" data-line="333"></a>      }
<a class="line-num" href="#line-334" id="line-334" data-line="334"></a>  
<a class="line-num" href="#line-335" id="line-335" data-line="335"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-64" id="section-64"></a>
</div>
<p>CreateBO</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-336" id="line-336" data-line="336"></a>      <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-built_in">string</span>(boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;)&gt; createBO(<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; ctx, <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> bodyTpl, <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> rootTpl) {
<a class="line-num" href="#line-337" id="line-337" data-line="337"></a>        <span class="hljs-keyword">return</span> [&amp;, bodyTpl, rootTpl](boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt; f)-&gt;<span class="hljs-built_in">string</span>{
<a class="line-num" href="#line-338" id="line-338" data-line="338"></a>          <span class="hljs-keyword">auto</span> createBOXml = <span class="hljs-keyword">this</span>-&gt;generator.render(ctx, bodyTpl, rootTpl);
<a class="line-num" href="#line-339" id="line-339" data-line="339"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-65" id="section-65"></a>
</div>
<p>even if it's an update, user should look for createBOXml to check what was sent out</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-340" id="line-340" data-line="340"></a>          ctx-&gt;add(<span class="hljs-string">"createBOXml"</span>, *createBOXml);
<a class="line-num" href="#line-341" id="line-341" data-line="341"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-66" id="section-66"></a>
</div>
<p>log what was sent</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-342" id="line-342" data-line="342"></a>          durian::addToLog(MODULE, ctx, <span class="hljs-string">"createBOXml"</span>);
<a class="line-num" href="#line-343" id="line-343" data-line="343"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-67" id="section-67"></a>
</div>
<p>future factory</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-344" id="line-344" data-line="344"></a>          <span class="hljs-keyword">auto</span> future2 = apiClient-&gt;methodPromise[<span class="hljs-string">"POST"</span>];
<a class="line-num" href="#line-345" id="line-345" data-line="345"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-68" id="section-68"></a>
</div>
<p>create the future</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-346" id="line-346" data-line="346"></a>          <span class="hljs-keyword">auto</span> f2 = future2(servicePath, *createBOXml, customHeaders);
<a class="line-num" href="#line-347" id="line-347" data-line="347"></a>          <span class="hljs-keyword">return</span> f2.get();
<a class="line-num" href="#line-348" id="line-348" data-line="348"></a>        };
<a class="line-num" href="#line-349" id="line-349" data-line="349"></a>      }
<a class="line-num" href="#line-350" id="line-350" data-line="350"></a>  
<a class="line-num" href="#line-351" id="line-351" data-line="351"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-69" id="section-69"></a>
</div>
<p>CreateBO response</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-352" id="line-352" data-line="352"></a>      <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-built_in">string</span>(boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;)&gt; createBOResponse() {
<a class="line-num" href="#line-353" id="line-353" data-line="353"></a>        <span class="hljs-keyword">return</span> [&amp;](boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt; fut)-&gt;<span class="hljs-built_in">string</span>{
<a class="line-num" href="#line-354" id="line-354" data-line="354"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-70" id="section-70"></a>
</div>
<p>auto createBOResponse = [&amp;](boost::future<a href="std::string.html">std::string</a> fut){</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-355" id="line-355" data-line="355"></a>          <span class="hljs-keyword">auto</span> res = fut.get();
<a class="line-num" href="#line-356" id="line-356" data-line="356"></a>          <span class="hljs-keyword">auto</span> raw = getResponse(res);
<a class="line-num" href="#line-357" id="line-357" data-line="357"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-71" id="section-71"></a>
</div>
<p>check for error</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-358" id="line-358" data-line="358"></a>          checkResponseForError(raw);
<a class="line-num" href="#line-359" id="line-359" data-line="359"></a>  
<a class="line-num" href="#line-360" id="line-360" data-line="360"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-72" id="section-72"></a>
</div>
<p>get the tracking number and store it in context</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-361" id="line-361" data-line="361"></a>          <span class="hljs-keyword">struct</span> json_token *arr, *tok;
<a class="line-num" href="#line-362" id="line-362" data-line="362"></a>          arr = parse_json2(raw.c_str(), raw.size());
<a class="line-num" href="#line-363" id="line-363" data-line="363"></a>          <span class="hljs-keyword">if</span> (arr) {
<a class="line-num" href="#line-364" id="line-364" data-line="364"></a>            tok = find_json_token(arr, <span class="hljs-string">"Envelope.Body.InvokeEventResponse"</span>);
<a class="line-num" href="#line-365" id="line-365" data-line="365"></a>            <span class="hljs-keyword">if</span> (tok) {
<a class="line-num" href="#line-366" id="line-366" data-line="366"></a>              tok = find_json_token(arr, <span class="hljs-string">"Envelope.Body.InvokeEventResponse.Result"</span>);
<a class="line-num" href="#line-367" id="line-367" data-line="367"></a>              <span class="hljs-keyword">if</span> (tok) {
<a class="line-num" href="#line-368" id="line-368" data-line="368"></a>                <span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">trackingNumber</span><span class="hljs-params">(tok-&gt;ptr, tok-&gt;len)</span></span>;
<a class="line-num" href="#line-369" id="line-369" data-line="369"></a>                <span class="hljs-keyword">this</span>-&gt;getContext()-&gt;add(<span class="hljs-string">"trackingNumber"</span>, trackingNumber);
<a class="line-num" href="#line-370" id="line-370" data-line="370"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-73" id="section-73"></a>
</div>
<p>add initial Selectica status values to context</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-371" id="line-371" data-line="371"></a>                <span class="hljs-keyword">this</span>-&gt;getContext()-&gt;add(<span class="hljs-string">"statusName"</span>, <span class="hljs-string">"Draft"</span>);
<a class="line-num" href="#line-372" id="line-372" data-line="372"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-74" id="section-74"></a>
</div>
<p>this-&gt;getContext()-&gt;add(&quot;statusId&quot;, &quot;ID00000023&quot;);</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-373" id="line-373" data-line="373"></a>                <span class="hljs-keyword">auto</span> statusId = ctx-&gt;get(<span class="hljs-string">"SelecticaToClickStatusMap"</span>).front()[<span class="hljs-string">"Draft"</span>];
<a class="line-num" href="#line-374" id="line-374" data-line="374"></a>                <span class="hljs-keyword">if</span> (statusId.size() &gt; <span class="hljs-number">0</span>) {
<a class="line-num" href="#line-375" id="line-375" data-line="375"></a>                  ctx-&gt;add(<span class="hljs-string">"statusId"</span>, statusId);
<a class="line-num" href="#line-376" id="line-376" data-line="376"></a>                }
<a class="line-num" href="#line-377" id="line-377" data-line="377"></a>              }
<a class="line-num" href="#line-378" id="line-378" data-line="378"></a>            }
<a class="line-num" href="#line-379" id="line-379" data-line="379"></a>          }
<a class="line-num" href="#line-380" id="line-380" data-line="380"></a>          <span class="hljs-built_in">free</span>(arr);
<a class="line-num" href="#line-381" id="line-381" data-line="381"></a>  
<a class="line-num" href="#line-382" id="line-382" data-line="382"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-75" id="section-75"></a>
</div>
<p>save response in the context, this will be used by the caller</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-383" id="line-383" data-line="383"></a>          ctx-&gt;add(<span class="hljs-string">"CreateBO"</span>, raw);
<a class="line-num" href="#line-384" id="line-384" data-line="384"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-76" id="section-76"></a>
</div>
<p>log what was received</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-385" id="line-385" data-line="385"></a>          durian::addToLog(MODULE, ctx, <span class="hljs-string">"CreateBO"</span>);
<a class="line-num" href="#line-386" id="line-386" data-line="386"></a>          <span class="hljs-keyword">return</span> raw;
<a class="line-num" href="#line-387" id="line-387" data-line="387"></a>        };
<a class="line-num" href="#line-388" id="line-388" data-line="388"></a>      }
<a class="line-num" href="#line-389" id="line-389" data-line="389"></a>    
<a class="line-num" href="#line-390" id="line-390" data-line="390"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-77" id="section-77"></a>
</div>
<p>UpdateBO</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-391" id="line-391" data-line="391"></a>      <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-built_in">string</span>(boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;)&gt; updateBO(<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; ctx, <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> bodyTpl, <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> rootTpl) {
<a class="line-num" href="#line-392" id="line-392" data-line="392"></a>        <span class="hljs-keyword">return</span> [&amp;, bodyTpl, rootTpl](boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt; f)-&gt;<span class="hljs-built_in">string</span>{
<a class="line-num" href="#line-393" id="line-393" data-line="393"></a>          <span class="hljs-keyword">auto</span> updateBOXml = <span class="hljs-keyword">this</span>-&gt;generator.render(ctx, bodyTpl, rootTpl);
<a class="line-num" href="#line-394" id="line-394" data-line="394"></a>          ctx-&gt;add(<span class="hljs-string">"updateBOXml"</span>, *updateBOXml);
<a class="line-num" href="#line-395" id="line-395" data-line="395"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-78" id="section-78"></a>
</div>
<p>log what was sent</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-396" id="line-396" data-line="396"></a>          durian::addToLog(MODULE, ctx, <span class="hljs-string">"updateBOXml"</span>);
<a class="line-num" href="#line-397" id="line-397" data-line="397"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-79" id="section-79"></a>
</div>
<p>future factory</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-398" id="line-398" data-line="398"></a>          <span class="hljs-keyword">auto</span> future2 = apiClient-&gt;methodPromise[<span class="hljs-string">"POST"</span>];
<a class="line-num" href="#line-399" id="line-399" data-line="399"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-80" id="section-80"></a>
</div>
<p>create the future</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-400" id="line-400" data-line="400"></a>          <span class="hljs-keyword">auto</span> f2 = future2(servicePath, *updateBOXml, customHeaders);
<a class="line-num" href="#line-401" id="line-401" data-line="401"></a>          <span class="hljs-keyword">return</span> f2.get();
<a class="line-num" href="#line-402" id="line-402" data-line="402"></a>        };
<a class="line-num" href="#line-403" id="line-403" data-line="403"></a>      }
<a class="line-num" href="#line-404" id="line-404" data-line="404"></a>  
<a class="line-num" href="#line-405" id="line-405" data-line="405"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-81" id="section-81"></a>
</div>
<p>UpdateBO response</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-406" id="line-406" data-line="406"></a>      <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-built_in">string</span>(boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;)&gt; updateBOResponse() {
<a class="line-num" href="#line-407" id="line-407" data-line="407"></a>        <span class="hljs-keyword">return</span> [&amp;](boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt; fut)-&gt;<span class="hljs-built_in">string</span>{
<a class="line-num" href="#line-408" id="line-408" data-line="408"></a>          <span class="hljs-keyword">auto</span> res = fut.get();
<a class="line-num" href="#line-409" id="line-409" data-line="409"></a>          <span class="hljs-keyword">auto</span> raw = getResponse(res);
<a class="line-num" href="#line-410" id="line-410" data-line="410"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-82" id="section-82"></a>
</div>
<p>check for error</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-411" id="line-411" data-line="411"></a>          checkResponseForError(raw);
<a class="line-num" href="#line-412" id="line-412" data-line="412"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-83" id="section-83"></a>
</div>
<p>save response in the context, this will be used by the caller</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-413" id="line-413" data-line="413"></a>          ctx-&gt;add(<span class="hljs-string">"UpdateBO"</span>, raw);
<a class="line-num" href="#line-414" id="line-414" data-line="414"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-84" id="section-84"></a>
</div>
<p>log what was received</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-415" id="line-415" data-line="415"></a>          durian::addToLog(MODULE, ctx, <span class="hljs-string">"UpdateBO"</span>);
<a class="line-num" href="#line-416" id="line-416" data-line="416"></a>          <span class="hljs-keyword">return</span> raw;
<a class="line-num" href="#line-417" id="line-417" data-line="417"></a>        };
<a class="line-num" href="#line-418" id="line-418" data-line="418"></a>      }
<a class="line-num" href="#line-419" id="line-419" data-line="419"></a>  
<a class="line-num" href="#line-420" id="line-420" data-line="420"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-85" id="section-85"></a>
</div>
<p>DeleteBO</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-421" id="line-421" data-line="421"></a>      <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-built_in">string</span>(boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;)&gt; deleteBO(<span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; ctx, <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> bodyTpl, <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> rootTpl) {
<a class="line-num" href="#line-422" id="line-422" data-line="422"></a>        <span class="hljs-keyword">return</span> [&amp;, bodyTpl, rootTpl](boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt; f)-&gt;<span class="hljs-built_in">string</span>{
<a class="line-num" href="#line-423" id="line-423" data-line="423"></a>          <span class="hljs-keyword">auto</span> deleteBOXml = <span class="hljs-keyword">this</span>-&gt;generator.render(ctx, bodyTpl, rootTpl);
<a class="line-num" href="#line-424" id="line-424" data-line="424"></a>          ctx-&gt;add(<span class="hljs-string">"deleteBOXml"</span>, *deleteBOXml);
<a class="line-num" href="#line-425" id="line-425" data-line="425"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-86" id="section-86"></a>
</div>
<p>log what was sent</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-426" id="line-426" data-line="426"></a>          durian::addToLog(MODULE, ctx, <span class="hljs-string">"deleteBOXml"</span>);
<a class="line-num" href="#line-427" id="line-427" data-line="427"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-87" id="section-87"></a>
</div>
<p>future factory</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-428" id="line-428" data-line="428"></a>          <span class="hljs-keyword">auto</span> future2 = apiClient-&gt;methodPromise[<span class="hljs-string">"POST"</span>];
<a class="line-num" href="#line-429" id="line-429" data-line="429"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-88" id="section-88"></a>
</div>
<p>create the future</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-430" id="line-430" data-line="430"></a>          <span class="hljs-keyword">auto</span> f2 = future2(servicePath, *deleteBOXml, customHeaders);
<a class="line-num" href="#line-431" id="line-431" data-line="431"></a>          <span class="hljs-keyword">return</span> f2.get();
<a class="line-num" href="#line-432" id="line-432" data-line="432"></a>        };
<a class="line-num" href="#line-433" id="line-433" data-line="433"></a>      }
<a class="line-num" href="#line-434" id="line-434" data-line="434"></a>  
<a class="line-num" href="#line-435" id="line-435" data-line="435"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-89" id="section-89"></a>
</div>
<p>DeleteBO response</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-436" id="line-436" data-line="436"></a>      <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-built_in">string</span>(boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;)&gt; deleteBOResponse() {
<a class="line-num" href="#line-437" id="line-437" data-line="437"></a>        <span class="hljs-keyword">return</span> [&amp;](boost::future&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt; fut)-&gt;<span class="hljs-built_in">string</span>{
<a class="line-num" href="#line-438" id="line-438" data-line="438"></a>          <span class="hljs-keyword">auto</span> res = fut.get();
<a class="line-num" href="#line-439" id="line-439" data-line="439"></a>          <span class="hljs-keyword">auto</span> raw = getResponse(res);
<a class="line-num" href="#line-440" id="line-440" data-line="440"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-90" id="section-90"></a>
</div>
<p>check for error</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-441" id="line-441" data-line="441"></a>          checkResponseForError(raw);
<a class="line-num" href="#line-442" id="line-442" data-line="442"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-91" id="section-91"></a>
</div>
<p>save response in the context, this will be used by the caller</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-443" id="line-443" data-line="443"></a>          ctx-&gt;add(<span class="hljs-string">"DeleteBO"</span>, raw);
<a class="line-num" href="#line-444" id="line-444" data-line="444"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-92" id="section-92"></a>
</div>
<p>log what was received</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-445" id="line-445" data-line="445"></a>          durian::addToLog(MODULE, ctx, <span class="hljs-string">"DeleteBO"</span>);
<a class="line-num" href="#line-446" id="line-446" data-line="446"></a>          <span class="hljs-keyword">return</span> raw;
<a class="line-num" href="#line-447" id="line-447" data-line="447"></a>        };
<a class="line-num" href="#line-448" id="line-448" data-line="448"></a>      }
<a class="line-num" href="#line-449" id="line-449" data-line="449"></a>  
<a class="line-num" href="#line-450" id="line-450" data-line="450"></a>    };  
<a class="line-num" href="#line-451" id="line-451" data-line="451"></a>  }
<a class="line-num" href="#line-452" id="line-452" data-line="452"></a>  
<a class="line-num" href="#line-453" id="line-453" data-line="453"></a>  <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
<a class="line-num" href="#line-454" id="line-454" data-line="454"></a>  
<a class="line-num" href="#line-455" id="line-455" data-line="455"></a>  </pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
