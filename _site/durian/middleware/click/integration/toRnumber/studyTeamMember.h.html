<!DOCTYPE html>
<html>
<head>
  <title>studyTeamMember.h</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../doc-style.css" />
  <script src="../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../";
    var thisFile = "C:\\cygwin64\\home\\htao\\harmony-middleware-doc\\\\middleware\\click\\integration\\toRnumber\\studyTeamMember.h";
    var defaultSidebar = true;
  </script>
  <script src="../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#studyteammember.h">studyTeamMember.h</a>
      </div>

      <div class="heading h4">
        <a href="#syncing-study-team-members-from-research-navigator-to-irb">Syncing Study Team Members from Research Navigator to IRB</a>
      </div>

      <div class="heading h2">
        <a href="#studyteammemberlesstgreater">studyTeamMember&amp;lt;T&amp;gt;</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="studyteammember.h">
  <h1>
    <a href="#studyteammember.h" name="studyteammember.h" class="pilcrow"></a>
studyTeamMember.h
  </h1>
</div>
<div class="pilwrap" id="syncing-study-team-members-from-research-navigator-to-irb">
  <h4>
    <a href="#syncing-study-team-members-from-research-navigator-to-irb" name="syncing-study-team-members-from-research-navigator-to-irb" class="pilcrow"></a>
Syncing Study Team Members from Research Navigator to IRB
  </h4>
</div>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-3" id="line-3" data-line="3"></a>  <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"click.h"</span></span>
<a class="line-num" href="#line-4" id="line-4" data-line="4"></a>  <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"middleware.h"</span></span>
<a class="line-num" href="#line-5" id="line-5" data-line="5"></a>  
<a class="line-num" href="#line-6" id="line-6" data-line="6"></a>  <span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> json11;
<a class="line-num" href="#line-7" id="line-7" data-line="7"></a>  <span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> click::enhance::dataManagement;
<a class="line-num" href="#line-8" id="line-8" data-line="8"></a>  
<a class="line-num" href="#line-9" id="line-9" data-line="9"></a>  <span class="hljs-keyword">namespace</span> click {
<a class="line-num" href="#line-10" id="line-10" data-line="10"></a>  
<a class="line-num" href="#line-11" id="line-11" data-line="11"></a>    <span class="hljs-keyword">typedef</span> <span class="hljs-built_in">shared_ptr</span>&lt;Plustache::Context&gt; CONTEXT;
<a class="line-num" href="#line-12" id="line-12" data-line="12"></a>    <span class="hljs-keyword">typedef</span> durian::generator&lt;durian::XmlElement::Body&gt; XMLBODY;
<a class="line-num" href="#line-13" id="line-13" data-line="13"></a>    <span class="hljs-keyword">typedef</span> PlustacheTypes::CollectionType COLLECTION;
<a class="line-num" href="#line-14" id="line-14" data-line="14"></a>    <span class="hljs-keyword">typedef</span> PlustacheTypes::ObjectType MAP;
<a class="line-num" href="#line-15" id="line-15" data-line="15"></a>  
<a class="line-num" href="#line-16" id="line-16" data-line="16"></a>    <span class="hljs-keyword">namespace</span> integration {
<a class="line-num" href="#line-17" id="line-17" data-line="17"></a>      <span class="hljs-keyword">namespace</span> rnumber {
<a class="line-num" href="#line-18" id="line-18" data-line="18"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="studyteammemberlesstgreater">
  <h2>
    <a href="#studyteammemberlesstgreater" name="studyteammemberlesstgreater" class="pilcrow"></a>
studyTeamMember&lt;T&gt;
  </h2>
</div>
<p><strong>The middleware class that must be implemented</strong></p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-26" id="line-26" data-line="26"></a>        <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<a class="line-num" href="#line-27" id="line-27" data-line="27"></a>        <span class="hljs-keyword">class</span> studyTeamMember : <span class="hljs-keyword">public</span> middleware::handler &lt; click::client&lt;T&gt; &gt; {
<a class="line-num" href="#line-28" id="line-28" data-line="28"></a>          <span class="hljs-keyword">typedef</span> click::client&lt;T&gt;* CLIENT;
<a class="line-num" href="#line-29" id="line-29" data-line="29"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p><strong>integration:irb:rnumber:studyteammember:update</strong> is the only action type this middleware will act on!</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-30" id="line-30" data-line="30"></a>          <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> ACTION_TYPE = <span class="hljs-string">"integration:irb:rnumber:studyteammember:batch:update"</span>;
<a class="line-num" href="#line-31" id="line-31" data-line="31"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>###public</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-32" id="line-32" data-line="32"></a>        <span class="hljs-keyword">public</span>:
<a class="line-num" href="#line-33" id="line-33" data-line="33"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<div class="dox">
<div class="summary">
<p>####sync()
<strong>(clickClient, j) =&gt; clickClient</strong></p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">clickClient</span>
<span>click::client client specific to this middleware
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">j</span>
<span>json11::Json json document
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>clickClient same client passed in
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-40" id="line-40" data-line="40"></a>          click::client&lt;T&gt;&amp; sync(click::client&lt;T&gt;&amp; clickClient, Json j) override {
<a class="line-num" href="#line-41" id="line-41" data-line="41"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p><strong>If you're not interested in this action, return immediately!</strong></p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-42" id="line-42" data-line="42"></a>            <span class="hljs-keyword">if</span> (j[<span class="hljs-string">"action"</span>].is_null() || j[<span class="hljs-string">"action"</span>].string_value() != ACTION_TYPE || j[<span class="hljs-string">"xml"</span>].is_null()) {
<a class="line-num" href="#line-43" id="line-43" data-line="43"></a>              <span class="hljs-keyword">return</span> clickClient;
<a class="line-num" href="#line-44" id="line-44" data-line="44"></a>            }
<a class="line-num" href="#line-45" id="line-45" data-line="45"></a>  
<a class="line-num" href="#line-46" id="line-46" data-line="46"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>Try converting xml attribute to json
Convert to json</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-48" id="line-48" data-line="48"></a>            <span class="hljs-built_in">string</span> raw, error;
<a class="line-num" href="#line-49" id="line-49" data-line="49"></a>            Json js;
<a class="line-num" href="#line-50" id="line-50" data-line="50"></a>            <span class="hljs-keyword">try</span> {
<a class="line-num" href="#line-51" id="line-51" data-line="51"></a>              raw = xml2json(j[<span class="hljs-string">"xml"</span>].string_value().c_str());
<a class="line-num" href="#line-52" id="line-52" data-line="52"></a>              js = Json::parse(raw, error, JsonParse::STANDARD);
<a class="line-num" href="#line-53" id="line-53" data-line="53"></a>              <span class="hljs-keyword">if</span> (error.size() &gt; <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span>;
<a class="line-num" href="#line-54" id="line-54" data-line="54"></a>            } <span class="hljs-keyword">catch</span> (...) {
<a class="line-num" href="#line-55" id="line-55" data-line="55"></a>              <span class="hljs-keyword">return</span> clickClient;
<a class="line-num" href="#line-56" id="line-56" data-line="56"></a>            }
<a class="line-num" href="#line-57" id="line-57" data-line="57"></a>  
<a class="line-num" href="#line-58" id="line-58" data-line="58"></a>            <span class="hljs-keyword">using</span> studyTeamMemberClient = click::integration::rnumber::studyTeamMember&lt;T&gt;;
<a class="line-num" href="#line-59" id="line-59" data-line="59"></a>  
<a class="line-num" href="#line-60" id="line-60" data-line="60"></a>            <span class="hljs-keyword">auto</span> <span class="hljs-number">_</span>readCurrentMembers = createAction&lt;CLIENT&gt;(action::sideeffect::readCurrentTeamMembersAction&lt;T&gt;, j);
<a class="line-num" href="#line-61" id="line-61" data-line="61"></a>            <span class="hljs-keyword">auto</span> <span class="hljs-number">_</span>parseCurrentMembers = createAction&lt;CLIENT&gt;(action::sideeffect::parseCurrentTeamMembers&lt;T&gt;, j);
<a class="line-num" href="#line-62" id="line-62" data-line="62"></a>            <span class="hljs-keyword">auto</span> <span class="hljs-number">_f</span>etchMemberDetails = createAction&lt;CLIENT&gt;(action::sideeffect::fetchMemberDetailsAction&lt;T&gt;, j);
<a class="line-num" href="#line-63" id="line-63" data-line="63"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>Get all current members from Rnumber and their userIds</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-64" id="line-64" data-line="64"></a>            flow(<span class="hljs-number">_</span>readCurrentMembers, <span class="hljs-number">_</span>parseCurrentMembers, <span class="hljs-number">_f</span>etchMemberDetails)(&amp;clickClient);
<a class="line-num" href="#line-65" id="line-65" data-line="65"></a>  
<a class="line-num" href="#line-66" id="line-66" data-line="66"></a>            <span class="hljs-built_in">vector</span>&lt;Json&gt; v;
<a class="line-num" href="#line-67" id="line-67" data-line="67"></a>            <span class="hljs-keyword">if</span> (js[<span class="hljs-string">"studyTeamMembers"</span>][<span class="hljs-string">"studyTeamMember"</span>].is_array()) {
<a class="line-num" href="#line-68" id="line-68" data-line="68"></a>              <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; e : js[<span class="hljs-string">"studyTeamMembers"</span>][<span class="hljs-string">"studyTeamMember"</span>].array_items()) {
<a class="line-num" href="#line-69" id="line-69" data-line="69"></a>                v.emplace_back(e);
<a class="line-num" href="#line-70" id="line-70" data-line="70"></a>              }
<a class="line-num" href="#line-71" id="line-71" data-line="71"></a>            } <span class="hljs-keyword">else</span> {
<a class="line-num" href="#line-72" id="line-72" data-line="72"></a>              v.emplace_back(js[<span class="hljs-string">"studyTeamMembers"</span>][<span class="hljs-string">"studyTeamMember"</span>]);
<a class="line-num" href="#line-73" id="line-73" data-line="73"></a>            }
<a class="line-num" href="#line-74" id="line-74" data-line="74"></a>  
<a class="line-num" href="#line-75" id="line-75" data-line="75"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>Create study team member in destination store if required</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-76" id="line-76" data-line="76"></a>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; e : v) {
<a class="line-num" href="#line-77" id="line-77" data-line="77"></a>              <span class="hljs-keyword">auto</span> <span class="hljs-number">_</span>shouldAddMember = createAction&lt;CLIENT&gt;(action::sideeffect::shouldAddMemberAction&lt;T&gt;, e);
<a class="line-num" href="#line-78" id="line-78" data-line="78"></a>              <span class="hljs-keyword">auto</span> <span class="hljs-number">_</span>addNewMember = createAction&lt;CLIENT&gt;(action::sideeffect::addNewStudyTeamMemberAction&lt;T&gt;, e, j[<span class="hljs-string">"_uid"</span>].string_value());            
<a class="line-num" href="#line-79" id="line-79" data-line="79"></a>  
<a class="line-num" href="#line-80" id="line-80" data-line="80"></a>              flow(<span class="hljs-number">_</span>shouldAddMember, <span class="hljs-number">_</span>addNewMember)(&amp;clickClient);
<a class="line-num" href="#line-81" id="line-81" data-line="81"></a>            }
<a class="line-num" href="#line-82" id="line-82" data-line="82"></a>  
<a class="line-num" href="#line-83" id="line-83" data-line="83"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>Update study with all new/existing members in one batch</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-84" id="line-84" data-line="84"></a>            <span class="hljs-keyword">auto</span> <span class="hljs-number">_u</span>pdateStudy = createAction&lt;CLIENT&gt;(action::sideeffect::updateStudyWithNewMemberAction&lt;T&gt;, j[<span class="hljs-string">"toStudyId"</span>].string_value());
<a class="line-num" href="#line-85" id="line-85" data-line="85"></a>            <span class="hljs-keyword">auto</span> finalClient = flow(<span class="hljs-number">_u</span>pdateStudy)(&amp;clickClient);
<a class="line-num" href="#line-86" id="line-86" data-line="86"></a>  
<a class="line-num" href="#line-87" id="line-87" data-line="87"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>Don't forget to clearContext for the next middleware!</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-88" id="line-88" data-line="88"></a>            clickClient.clearContext(clickClient.additionalWhitelist);
<a class="line-num" href="#line-89" id="line-89" data-line="89"></a>            
<a class="line-num" href="#line-90" id="line-90" data-line="90"></a>            <span class="hljs-keyword">return</span> clickClient;
<a class="line-num" href="#line-91" id="line-91" data-line="91"></a>          }
<a class="line-num" href="#line-92" id="line-92" data-line="92"></a>        };
<a class="line-num" href="#line-93" id="line-93" data-line="93"></a>  
<a class="line-num" href="#line-94" id="line-94" data-line="94"></a>        <span class="hljs-keyword">namespace</span> action {
<a class="line-num" href="#line-95" id="line-95" data-line="95"></a>          <span class="hljs-keyword">namespace</span> sideeffect {
<a class="line-num" href="#line-96" id="line-96" data-line="96"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>####Side Effects
<strong>(CLIENT, Json) =&gt; CLIENT</strong></p>
<div class="dox">
<div class="summary">
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">CLIENT</span>
<span>click::client
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">Json</span>
<span>json11::Json
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-103" id="line-103" data-line="103"></a>  
<a class="line-num" href="#line-104" id="line-104" data-line="104"></a>            <span class="hljs-keyword">namespace</span> helpers {
<a class="line-num" href="#line-105" id="line-105" data-line="105"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<div class="dox">
<div class="summary">
<p>// Deprecate b/c moved to single roleOnStudy
// Create the roles collection for the new Study Team Member
template<typename T>
string createRoleAttributes(click::client<T>* clickClient, Json j) {
vector<string> roleCollection;
vector<Json> v;
if (j[&quot;roles&quot;][&quot;role&quot;].is_array()) {
for (auto&amp; e : j[&quot;roles&quot;][&quot;role&quot;].array_items()) {
v.emplace_back(e);
}
}
else {
v.emplace_back(j[&quot;roles&quot;][&quot;role&quot;]);
}</p>
<p>for (auto&amp; e : v) {
roleCollection.emplace_back(e[&quot;@roleId&quot;].string_value());
}</p>
<p>Element::AttributeMember attributeMember{ &quot;Roles on Study&quot;, &quot;_studyTeamMemberRole&quot;, &quot;ID&quot;, roleCollection };
return clickClient-&gt;dataManagementHelper.createElement(attributeMember);
}</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-129" id="line-129" data-line="129"></a>  
<a class="line-num" href="#line-130" id="line-130" data-line="130"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>Create the unique ID for the Study Team Member entity</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-131" id="line-131" data-line="131"></a>              <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<a class="line-num" href="#line-132" id="line-132" data-line="132"></a>              <span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">createNewID</span><span class="hljs-params">(click::client&lt;T&gt;* clickClient, <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> newId)</span> </span>{
<a class="line-num" href="#line-133" id="line-133" data-line="133"></a>                Element::Attribute attribute{ <span class="hljs-string">"ID"</span>, <span class="hljs-string">"String"</span>, <span class="hljs-string">""</span>, <span class="hljs-string">"ID"</span>, newId };
<a class="line-num" href="#line-134" id="line-134" data-line="134"></a>                <span class="hljs-keyword">return</span> clickClient-&gt;dataManagementHelper.createElement(attribute);
<a class="line-num" href="#line-135" id="line-135" data-line="135"></a>              }
<a class="line-num" href="#line-136" id="line-136" data-line="136"></a>  
<a class="line-num" href="#line-137" id="line-137" data-line="137"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>Create the Person referenced by Study Team Member Entity</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-138" id="line-138" data-line="138"></a>              <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<a class="line-num" href="#line-139" id="line-139" data-line="139"></a>              <span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">createReferenceToPerson</span><span class="hljs-params">(click::client&lt;T&gt;* clickClient, <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> userId)</span> </span>{
<a class="line-num" href="#line-140" id="line-140" data-line="140"></a>                Element::Attribute attribute{ <span class="hljs-string">"Study Team Member"</span>, <span class="hljs-string">"Person"</span>, <span class="hljs-string">"EntityType"</span>, <span class="hljs-string">"userId"</span>, userId };
<a class="line-num" href="#line-141" id="line-141" data-line="141"></a>                <span class="hljs-keyword">return</span> clickClient-&gt;dataManagementHelper.createElement(attribute);
<a class="line-num" href="#line-142" id="line-142" data-line="142"></a>              }
<a class="line-num" href="#line-143" id="line-143" data-line="143"></a>  
<a class="line-num" href="#line-144" id="line-144" data-line="144"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>Create Role</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-145" id="line-145" data-line="145"></a>              <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<a class="line-num" href="#line-146" id="line-146" data-line="146"></a>              <span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">createRoleAttribute</span><span class="hljs-params">(click::client&lt;T&gt;* clickClient, <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> roleId)</span> </span>{
<a class="line-num" href="#line-147" id="line-147" data-line="147"></a>                Element::Attribute attribute{ <span class="hljs-string">"Role on Study"</span>, <span class="hljs-string">"_studyTeamMemberRole"</span>, <span class="hljs-string">"EntityType"</span>, <span class="hljs-string">"ID"</span>, roleId };
<a class="line-num" href="#line-148" id="line-148" data-line="148"></a>                <span class="hljs-keyword">return</span> clickClient-&gt;dataManagementHelper.createElement(attribute);
<a class="line-num" href="#line-149" id="line-149" data-line="149"></a>              }
<a class="line-num" href="#line-150" id="line-150" data-line="150"></a>            }
<a class="line-num" href="#line-151" id="line-151" data-line="151"></a>  
<a class="line-num" href="#line-152" id="line-152" data-line="152"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<div class="dox">
<div class="summary">
<p><strong>Top level functions that uses helper functions to create SOAP bodies and sends those bodies to web services</strong></p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-155" id="line-155" data-line="155"></a>            
<a class="line-num" href="#line-156" id="line-156" data-line="156"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>#####readCurrentTeamMembersAction()
Read the current list of study team members for this study</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-158" id="line-158" data-line="158"></a>            <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<a class="line-num" href="#line-159" id="line-159" data-line="159"></a>            click::client&lt;T&gt;* readCurrentTeamMembersAction(click::client&lt;T&gt;* clickClient, Json j) {
<a class="line-num" href="#line-160" id="line-160" data-line="160"></a>              <span class="hljs-keyword">auto</span> studyId = <span class="hljs-string">"s"</span> + j[<span class="hljs-string">"_uid"</span>].string_value();
<a class="line-num" href="#line-161" id="line-161" data-line="161"></a>              Element::WebService webService{ <span class="hljs-string">"Rnumber"</span>, <span class="hljs-string">"ID"</span>, studyId, <span class="hljs-string">"_Research Project"</span> };
<a class="line-num" href="#line-162" id="line-162" data-line="162"></a>              <span class="hljs-built_in">string</span> readMembersBody = clickClient-&gt;dataManagementHelper.createElement(webService);
<a class="line-num" href="#line-163" id="line-163" data-line="163"></a>  
<a class="line-num" href="#line-164" id="line-164" data-line="164"></a>              clickClient-&gt;InvokeDataManagement(<span class="hljs-string">"Read"</span>, readMembersBody);
<a class="line-num" href="#line-165" id="line-165" data-line="165"></a>  
<a class="line-num" href="#line-166" id="line-166" data-line="166"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>Add to context for next function</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-167" id="line-167" data-line="167"></a>              <span class="hljs-built_in">string</span> readResponse = clickClient-&gt;getContext()-&gt;first(<span class="hljs-string">"InvokeDataManagementResponse"</span>);
<a class="line-num" href="#line-168" id="line-168" data-line="168"></a>              clickClient-&gt;getContext()-&gt;add(<span class="hljs-string">"readResponse"</span>, readResponse);
<a class="line-num" href="#line-169" id="line-169" data-line="169"></a>  
<a class="line-num" href="#line-170" id="line-170" data-line="170"></a>              <span class="hljs-keyword">return</span> clickClient;
<a class="line-num" href="#line-171" id="line-171" data-line="171"></a>            }
<a class="line-num" href="#line-172" id="line-172" data-line="172"></a>  
<a class="line-num" href="#line-173" id="line-173" data-line="173"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>Parse the response XML</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-174" id="line-174" data-line="174"></a>            <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<a class="line-num" href="#line-175" id="line-175" data-line="175"></a>            click::client&lt;T&gt;* parseCurrentTeamMembers(click::client&lt;T&gt;* clickClient, Json j) {
<a class="line-num" href="#line-176" id="line-176" data-line="176"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>&quot;readResponse&quot; should have been inserted from previous function</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-177" id="line-177" data-line="177"></a>              <span class="hljs-built_in">string</span> readResponse = clickClient-&gt;getContext()-&gt;first(<span class="hljs-string">"readResponse"</span>);
<a class="line-num" href="#line-178" id="line-178" data-line="178"></a>              <span class="hljs-keyword">if</span> (readResponse.size() == <span class="hljs-number">0</span>) {
<a class="line-num" href="#line-179" id="line-179" data-line="179"></a>                <span class="hljs-keyword">return</span> clickClient;
<a class="line-num" href="#line-180" id="line-180" data-line="180"></a>              }
<a class="line-num" href="#line-181" id="line-181" data-line="181"></a>              COLLECTION members;
<a class="line-num" href="#line-182" id="line-182" data-line="182"></a>  
<a class="line-num" href="#line-183" id="line-183" data-line="183"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>Convert to json</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-184" id="line-184" data-line="184"></a>              <span class="hljs-built_in">string</span> raw;
<a class="line-num" href="#line-185" id="line-185" data-line="185"></a>              <span class="hljs-keyword">try</span> {
<a class="line-num" href="#line-186" id="line-186" data-line="186"></a>                raw = xml2json(readResponse.c_str());;
<a class="line-num" href="#line-187" id="line-187" data-line="187"></a>              }
<a class="line-num" href="#line-188" id="line-188" data-line="188"></a>              <span class="hljs-keyword">catch</span> (...) {
<a class="line-num" href="#line-189" id="line-189" data-line="189"></a>                <span class="hljs-keyword">return</span> clickClient;
<a class="line-num" href="#line-190" id="line-190" data-line="190"></a>              }
<a class="line-num" href="#line-191" id="line-191" data-line="191"></a>              
<a class="line-num" href="#line-192" id="line-192" data-line="192"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>parse to Json::Object</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-193" id="line-193" data-line="193"></a>              <span class="hljs-built_in">string</span> err;
<a class="line-num" href="#line-194" id="line-194" data-line="194"></a>              <span class="hljs-keyword">auto</span> d = json11::Json::parse(raw, err, json11::JsonParse::STANDARD);
<a class="line-num" href="#line-195" id="line-195" data-line="195"></a>  
<a class="line-num" href="#line-196" id="line-196" data-line="196"></a>              <span class="hljs-keyword">if</span> (!d[<span class="hljs-string">"Envelope"</span>][<span class="hljs-string">"Body"</span>].is_null() &amp;&amp; !d[<span class="hljs-string">"Envelope"</span>][<span class="hljs-string">"Body"</span>][<span class="hljs-string">"ReadResponse"</span>].is_null()) {
<a class="line-num" href="#line-197" id="line-197" data-line="197"></a>                <span class="hljs-keyword">auto</span> resp = d[<span class="hljs-string">"Envelope"</span>][<span class="hljs-string">"Body"</span>][<span class="hljs-string">"ReadResponse"</span>][<span class="hljs-string">"ReadResult"</span>].string_value();
<a class="line-num" href="#line-198" id="line-198" data-line="198"></a>                <span class="hljs-keyword">auto</span> raw1 = xml2json(resp.c_str());
<a class="line-num" href="#line-199" id="line-199" data-line="199"></a>                <span class="hljs-keyword">auto</span> readResult = json11::Json::parse(raw1, err, json11::JsonParse::STANDARD);
<a class="line-num" href="#line-200" id="line-200" data-line="200"></a>  
<a class="line-num" href="#line-201" id="line-201" data-line="201"></a>                <span class="hljs-keyword">if</span> (readResult[<span class="hljs-string">"WebServiceRoot"</span>][<span class="hljs-string">"WebService"</span>][<span class="hljs-string">"Attribute"</span>].is_array()) {
<a class="line-num" href="#line-202" id="line-202" data-line="202"></a>                  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp;e : readResult[<span class="hljs-string">"WebServiceRoot"</span>][<span class="hljs-string">"WebService"</span>][<span class="hljs-string">"Attribute"</span>].array_items()) {
<a class="line-num" href="#line-203" id="line-203" data-line="203"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>xml2json transforms a one object array into plain object</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-204" id="line-204" data-line="204"></a>                    <span class="hljs-keyword">if</span> (!e[<span class="hljs-string">"@DataType"</span>].is_null() &amp;&amp; e[<span class="hljs-string">"@DataType"</span>].string_value() == <span class="hljs-string">"_studyTeamMember"</span>) {
<a class="line-num" href="#line-205" id="line-205" data-line="205"></a>                      <span class="hljs-keyword">if</span> (e[<span class="hljs-string">"AttributeMember"</span>].is_array()) {
<a class="line-num" href="#line-206" id="line-206" data-line="206"></a>                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; f : e[<span class="hljs-string">"AttributeMember"</span>].array_items()) {
<a class="line-num" href="#line-207" id="line-207" data-line="207"></a>                          members.emplace_back(MAP{ { <span class="hljs-string">"Value"</span>, f[<span class="hljs-string">"@Value"</span>].string_value() } });
<a class="line-num" href="#line-208" id="line-208" data-line="208"></a>                        }
<a class="line-num" href="#line-209" id="line-209" data-line="209"></a>                      } <span class="hljs-keyword">else</span> {
<a class="line-num" href="#line-210" id="line-210" data-line="210"></a>                        <span class="hljs-keyword">if</span> (!e[<span class="hljs-string">"AttributeMember"</span>].is_null()) {
<a class="line-num" href="#line-211" id="line-211" data-line="211"></a>                          members.emplace_back(MAP{ { <span class="hljs-string">"Value"</span>, e[<span class="hljs-string">"AttributeMember"</span>][<span class="hljs-string">"@Value"</span>].string_value() } });
<a class="line-num" href="#line-212" id="line-212" data-line="212"></a>                        }                      
<a class="line-num" href="#line-213" id="line-213" data-line="213"></a>                      }
<a class="line-num" href="#line-214" id="line-214" data-line="214"></a>                    }
<a class="line-num" href="#line-215" id="line-215" data-line="215"></a>                  }
<a class="line-num" href="#line-216" id="line-216" data-line="216"></a>                }
<a class="line-num" href="#line-217" id="line-217" data-line="217"></a>              }
<a class="line-num" href="#line-218" id="line-218" data-line="218"></a>  
<a class="line-num" href="#line-219" id="line-219" data-line="219"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>Save members to context for next function</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-220" id="line-220" data-line="220"></a>              clickClient-&gt;getContext()-&gt;add(<span class="hljs-string">"members"</span>, members);
<a class="line-num" href="#line-221" id="line-221" data-line="221"></a>  
<a class="line-num" href="#line-222" id="line-222" data-line="222"></a>              <span class="hljs-keyword">return</span> clickClient;
<a class="line-num" href="#line-223" id="line-223" data-line="223"></a>            }
<a class="line-num" href="#line-224" id="line-224" data-line="224"></a>  
<a class="line-num" href="#line-225" id="line-225" data-line="225"></a>            <span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">parseStudyTeamMemberBody</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> readResponse)</span> </span>{            
<a class="line-num" href="#line-226" id="line-226" data-line="226"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>Convert to json</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-227" id="line-227" data-line="227"></a>              <span class="hljs-built_in">string</span> raw;
<a class="line-num" href="#line-228" id="line-228" data-line="228"></a>              <span class="hljs-keyword">try</span> {
<a class="line-num" href="#line-229" id="line-229" data-line="229"></a>                raw = xml2json(readResponse.c_str());;
<a class="line-num" href="#line-230" id="line-230" data-line="230"></a>              } <span class="hljs-keyword">catch</span> (...) {
<a class="line-num" href="#line-231" id="line-231" data-line="231"></a>                <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
<a class="line-num" href="#line-232" id="line-232" data-line="232"></a>              }
<a class="line-num" href="#line-233" id="line-233" data-line="233"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<p>parse to Json::Object</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-234" id="line-234" data-line="234"></a>              <span class="hljs-built_in">string</span> err;
<a class="line-num" href="#line-235" id="line-235" data-line="235"></a>              <span class="hljs-keyword">auto</span> d = json11::Json::parse(raw, err, json11::JsonParse::STANDARD);
<a class="line-num" href="#line-236" id="line-236" data-line="236"></a>  
<a class="line-num" href="#line-237" id="line-237" data-line="237"></a>              <span class="hljs-keyword">if</span> (err.size() &gt; <span class="hljs-number">0</span>){
<a class="line-num" href="#line-238" id="line-238" data-line="238"></a>                <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
<a class="line-num" href="#line-239" id="line-239" data-line="239"></a>              }
<a class="line-num" href="#line-240" id="line-240" data-line="240"></a>  
<a class="line-num" href="#line-241" id="line-241" data-line="241"></a>              <span class="hljs-keyword">if</span> (!d[<span class="hljs-string">"Envelope"</span>][<span class="hljs-string">"Body"</span>].is_null() &amp;&amp; !d[<span class="hljs-string">"Envelope"</span>][<span class="hljs-string">"Body"</span>][<span class="hljs-string">"ReadResponse"</span>].is_null()) {
<a class="line-num" href="#line-242" id="line-242" data-line="242"></a>                <span class="hljs-keyword">auto</span> resp = d[<span class="hljs-string">"Envelope"</span>][<span class="hljs-string">"Body"</span>][<span class="hljs-string">"ReadResponse"</span>][<span class="hljs-string">"ReadResult"</span>].string_value();
<a class="line-num" href="#line-243" id="line-243" data-line="243"></a>                <span class="hljs-keyword">auto</span> raw1 = xml2json(resp.c_str());
<a class="line-num" href="#line-244" id="line-244" data-line="244"></a>                <span class="hljs-keyword">auto</span> readResult = json11::Json::parse(raw1, err, json11::JsonParse::STANDARD);
<a class="line-num" href="#line-245" id="line-245" data-line="245"></a>  
<a class="line-num" href="#line-246" id="line-246" data-line="246"></a>                <span class="hljs-keyword">if</span> (readResult[<span class="hljs-string">"WebServiceRoot"</span>][<span class="hljs-string">"WebService"</span>][<span class="hljs-string">"Attribute"</span>].is_array()) {
<a class="line-num" href="#line-247" id="line-247" data-line="247"></a>                  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp;e : readResult[<span class="hljs-string">"WebServiceRoot"</span>][<span class="hljs-string">"WebService"</span>][<span class="hljs-string">"Attribute"</span>].array_items()) {
<a class="line-num" href="#line-248" id="line-248" data-line="248"></a>                    <span class="hljs-keyword">if</span> (!e[<span class="hljs-string">"@Caption"</span>].is_null() &amp;&amp; e[<span class="hljs-string">"@Caption"</span>].string_value() == <span class="hljs-string">"Study Team Member.userId"</span>) {
<a class="line-num" href="#line-249" id="line-249" data-line="249"></a>                      <span class="hljs-keyword">return</span> e[<span class="hljs-string">"@Value"</span>].string_value();
<a class="line-num" href="#line-250" id="line-250" data-line="250"></a>                    }
<a class="line-num" href="#line-251" id="line-251" data-line="251"></a>                  }
<a class="line-num" href="#line-252" id="line-252" data-line="252"></a>                }
<a class="line-num" href="#line-253" id="line-253" data-line="253"></a>              }
<a class="line-num" href="#line-254" id="line-254" data-line="254"></a>              <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
<a class="line-num" href="#line-255" id="line-255" data-line="255"></a>            }
<a class="line-num" href="#line-256" id="line-256" data-line="256"></a>  
<a class="line-num" href="#line-257" id="line-257" data-line="257"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<p>Fetch StudyTeamMember details to get userId</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-258" id="line-258" data-line="258"></a>            <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<a class="line-num" href="#line-259" id="line-259" data-line="259"></a>            click::client&lt;T&gt;* fetchMemberDetailsAction(click::client&lt;T&gt;* clickClient, Json j) {
<a class="line-num" href="#line-260" id="line-260" data-line="260"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>&quot;members&quot; should have been inserted from previous function</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-261" id="line-261" data-line="261"></a>              <span class="hljs-keyword">auto</span> members = clickClient-&gt;getContext()-&gt;get(<span class="hljs-string">"members"</span>);
<a class="line-num" href="#line-262" id="line-262" data-line="262"></a>              COLLECTION userIds;
<a class="line-num" href="#line-263" id="line-263" data-line="263"></a>  
<a class="line-num" href="#line-264" id="line-264" data-line="264"></a>              <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; e : members) {
<a class="line-num" href="#line-265" id="line-265" data-line="265"></a>                Element::WebService webService{ <span class="hljs-string">"StudyTeamMember"</span>, <span class="hljs-string">"ID"</span>, e[<span class="hljs-string">"Value"</span>], <span class="hljs-string">"_studyTeamMember"</span> };
<a class="line-num" href="#line-266" id="line-266" data-line="266"></a>                <span class="hljs-built_in">string</span> readMembersBody = clickClient-&gt;dataManagementHelper.createElement(webService);
<a class="line-num" href="#line-267" id="line-267" data-line="267"></a>                clickClient-&gt;InvokeDataManagement(<span class="hljs-string">"Read"</span>, readMembersBody);
<a class="line-num" href="#line-268" id="line-268" data-line="268"></a>  
<a class="line-num" href="#line-269" id="line-269" data-line="269"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>Add to context for next function
<strong>NOTE</strong> we need to use -&gt;last() because results are pushed back in the vector; thus, last item is the most recent</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-271" id="line-271" data-line="271"></a>                <span class="hljs-built_in">string</span> readResponse = clickClient-&gt;getContext()-&gt;last(<span class="hljs-string">"InvokeDataManagementResponse"</span>);
<a class="line-num" href="#line-272" id="line-272" data-line="272"></a>                <span class="hljs-keyword">auto</span> userId = parseStudyTeamMemberBody(readResponse);
<a class="line-num" href="#line-273" id="line-273" data-line="273"></a>                <span class="hljs-keyword">if</span> (userId.size() &gt; <span class="hljs-number">0</span>) {
<a class="line-num" href="#line-274" id="line-274" data-line="274"></a>                  userIds.emplace_back(MAP{ { <span class="hljs-string">"Value"</span>, userId } });
<a class="line-num" href="#line-275" id="line-275" data-line="275"></a>                }
<a class="line-num" href="#line-276" id="line-276" data-line="276"></a>              }
<a class="line-num" href="#line-277" id="line-277" data-line="277"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>Add to context for next function</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-278" id="line-278" data-line="278"></a>              clickClient-&gt;getContext()-&gt;add(<span class="hljs-string">"userIds"</span>, userIds);
<a class="line-num" href="#line-279" id="line-279" data-line="279"></a>              
<a class="line-num" href="#line-280" id="line-280" data-line="280"></a>              <span class="hljs-keyword">return</span> clickClient;
<a class="line-num" href="#line-281" id="line-281" data-line="281"></a>            }
<a class="line-num" href="#line-282" id="line-282" data-line="282"></a>  
<a class="line-num" href="#line-283" id="line-283" data-line="283"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<p>Should we add user to list? If userId is already found in the userIds context, we need to SKIP!</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-284" id="line-284" data-line="284"></a>            <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<a class="line-num" href="#line-285" id="line-285" data-line="285"></a>            click::client&lt;T&gt;* shouldAddMemberAction(click::client&lt;T&gt;* clickClient, Json j) {
<a class="line-num" href="#line-286" id="line-286" data-line="286"></a>              clickClient-&gt;getContext()-&gt;remove(<span class="hljs-string">"addMember"</span>);
<a class="line-num" href="#line-287" id="line-287" data-line="287"></a>              clickClient-&gt;getContext()-&gt;add(<span class="hljs-string">"addMember"</span>, <span class="hljs-string">"true"</span>);
<a class="line-num" href="#line-288" id="line-288" data-line="288"></a>              
<a class="line-num" href="#line-289" id="line-289" data-line="289"></a>              <span class="hljs-keyword">auto</span> userIds = clickClient-&gt;getContext()-&gt;get(<span class="hljs-string">"userIds"</span>);
<a class="line-num" href="#line-290" id="line-290" data-line="290"></a>              <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp;e : userIds) {
<a class="line-num" href="#line-291" id="line-291" data-line="291"></a>                <span class="hljs-keyword">if</span> (e[<span class="hljs-string">"Value"</span>] == j[<span class="hljs-string">"@userId"</span>].string_value()) {
<a class="line-num" href="#line-292" id="line-292" data-line="292"></a>                  clickClient-&gt;getContext()-&gt;remove(<span class="hljs-string">"addMember"</span>);
<a class="line-num" href="#line-293" id="line-293" data-line="293"></a>                  clickClient-&gt;getContext()-&gt;add(<span class="hljs-string">"addMember"</span>, <span class="hljs-string">"false"</span>);
<a class="line-num" href="#line-294" id="line-294" data-line="294"></a>                }
<a class="line-num" href="#line-295" id="line-295" data-line="295"></a>              }
<a class="line-num" href="#line-296" id="line-296" data-line="296"></a>              <span class="hljs-keyword">return</span> clickClient;
<a class="line-num" href="#line-297" id="line-297" data-line="297"></a>            }
<a class="line-num" href="#line-298" id="line-298" data-line="298"></a>  
<a class="line-num" href="#line-299" id="line-299" data-line="299"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<p>#####addNewStudyTeamMemberAction()
Add new study team member action</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-301" id="line-301" data-line="301"></a>            <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<a class="line-num" href="#line-302" id="line-302" data-line="302"></a>            click::client&lt;T&gt;* addNewStudyTeamMemberAction(click::client&lt;T&gt;* clickClient, Json j, <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> <span class="hljs-number">_u</span>id) {
<a class="line-num" href="#line-303" id="line-303" data-line="303"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<p>Just exit if user already is in the study team ESET</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-304" id="line-304" data-line="304"></a>              <span class="hljs-keyword">if</span> (clickClient-&gt;getContext()-&gt;first(<span class="hljs-string">"addMember"</span>) == <span class="hljs-string">"false"</span>) {
<a class="line-num" href="#line-305" id="line-305" data-line="305"></a>                <span class="hljs-keyword">return</span> clickClient;
<a class="line-num" href="#line-306" id="line-306" data-line="306"></a>              }
<a class="line-num" href="#line-307" id="line-307" data-line="307"></a>  
<a class="line-num" href="#line-308" id="line-308" data-line="308"></a>              <span class="hljs-keyword">namespace</span> helpers = integration::rnumber::action::sideeffect::helpers;
<a class="line-num" href="#line-309" id="line-309" data-line="309"></a>              
<a class="line-num" href="#line-310" id="line-310" data-line="310"></a>              <span class="hljs-keyword">auto</span> newId = <span class="hljs-number">_u</span>id + <span class="hljs-string">":stm:"</span> + j[<span class="hljs-string">"@userId"</span>].string_value();
<a class="line-num" href="#line-311" id="line-311" data-line="311"></a>              <span class="hljs-keyword">auto</span> userId = j[<span class="hljs-string">"@userId"</span>].string_value();
<a class="line-num" href="#line-312" id="line-312" data-line="312"></a>              <span class="hljs-keyword">auto</span> roleId = j[<span class="hljs-string">"@roleId"</span>].string_value();
<a class="line-num" href="#line-313" id="line-313" data-line="313"></a>  
<a class="line-num" href="#line-314" id="line-314" data-line="314"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<p>Get all generated XML strings</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-315" id="line-315" data-line="315"></a>              <span class="hljs-keyword">auto</span> newIdEl = helpers::createNewID(clickClient, newId);
<a class="line-num" href="#line-316" id="line-316" data-line="316"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<p>auto rolesEl = helpers::createRoleAttributes(clickClient, j);</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-317" id="line-317" data-line="317"></a>              <span class="hljs-keyword">auto</span> personRefEl = helpers::createReferenceToPerson(clickClient, userId);
<a class="line-num" href="#line-318" id="line-318" data-line="318"></a>              <span class="hljs-keyword">auto</span> roleIdEl = helpers::createRoleAttribute(clickClient, roleId);
<a class="line-num" href="#line-319" id="line-319" data-line="319"></a>              
<a class="line-num" href="#line-320" id="line-320" data-line="320"></a>              Element::WebService webService{ <span class="hljs-string">"StudyTeamMember"</span>, <span class="hljs-string">"ID"</span>, newId, <span class="hljs-string">"_studyTeamMember"</span>, { newIdEl, roleIdEl, personRefEl } };
<a class="line-num" href="#line-321" id="line-321" data-line="321"></a>              <span class="hljs-built_in">string</span> addMemberBody = clickClient-&gt;dataManagementHelper.createElement(webService);
<a class="line-num" href="#line-322" id="line-322" data-line="322"></a>  
<a class="line-num" href="#line-323" id="line-323" data-line="323"></a>              clickClient-&gt;InvokeDataManagement(<span class="hljs-string">"Add"</span>, addMemberBody);
<a class="line-num" href="#line-324" id="line-324" data-line="324"></a>  
<a class="line-num" href="#line-325" id="line-325" data-line="325"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<p>Get response and look for error, if successful, add to members context</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-326" id="line-326" data-line="326"></a>              <span class="hljs-built_in">string</span> hasError = clickClient-&gt;getContext()-&gt;first(<span class="hljs-string">"InvokeDataManagementResponseHasError"</span>);
<a class="line-num" href="#line-327" id="line-327" data-line="327"></a>  
<a class="line-num" href="#line-328" id="line-328" data-line="328"></a>              <span class="hljs-keyword">if</span> (hasError == <span class="hljs-string">"false"</span>) {
<a class="line-num" href="#line-329" id="line-329" data-line="329"></a>                <span class="hljs-keyword">auto</span> members = clickClient-&gt;getContext()-&gt;get(<span class="hljs-string">"members"</span>);
<a class="line-num" href="#line-330" id="line-330" data-line="330"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<p>Add new member to members collection</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-331" id="line-331" data-line="331"></a>                members.emplace_back(MAP{ { <span class="hljs-string">"Value"</span>, newId } });
<a class="line-num" href="#line-332" id="line-332" data-line="332"></a>                clickClient-&gt;getContext()-&gt;remove(<span class="hljs-string">"members"</span>);
<a class="line-num" href="#line-333" id="line-333" data-line="333"></a>                clickClient-&gt;getContext()-&gt;add(<span class="hljs-string">"members"</span>, members);
<a class="line-num" href="#line-334" id="line-334" data-line="334"></a>              }
<a class="line-num" href="#line-335" id="line-335" data-line="335"></a>              <span class="hljs-keyword">return</span> clickClient;
<a class="line-num" href="#line-336" id="line-336" data-line="336"></a>            }
<a class="line-num" href="#line-337" id="line-337" data-line="337"></a>  
<a class="line-num" href="#line-338" id="line-338" data-line="338"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<p>Update the study with new list of study team members that includes the new member that was just created</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-339" id="line-339" data-line="339"></a>            <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<a class="line-num" href="#line-340" id="line-340" data-line="340"></a>            click::client&lt;T&gt;* updateStudyWithNewMemberAction(click::client&lt;T&gt;* clickClient, <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> toStudyId) {
<a class="line-num" href="#line-341" id="line-341" data-line="341"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<p>&quot;members&quot; should have been inserted from previous function</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-342" id="line-342" data-line="342"></a>              <span class="hljs-keyword">auto</span> members = clickClient-&gt;getContext()-&gt;get(<span class="hljs-string">"members"</span>);
<a class="line-num" href="#line-343" id="line-343" data-line="343"></a>  
<a class="line-num" href="#line-344" id="line-344" data-line="344"></a>  </pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41"></a>
</div>
<p>Create a consolidated list of current team members and the new study team member</p>

        </td>
        <td class="code highlight">
          <pre class="c"><a class="line-num" href="#line-345" id="line-345" data-line="345"></a>              <span class="hljs-keyword">auto</span> createConsolidatedTeamMembers = [&amp;]()-&gt;<span class="hljs-built_in">string</span> {
<a class="line-num" href="#line-346" id="line-346" data-line="346"></a>                Element::AttributeMember attributeMember{ <span class="hljs-string">"Study Details.Study Team Member"</span>, <span class="hljs-string">"_studyTeamMember"</span>, <span class="hljs-string">"ID"</span>, members };
<a class="line-num" href="#line-347" id="line-347" data-line="347"></a>                <span class="hljs-keyword">return</span> clickClient-&gt;dataManagementHelper.createElement(attributeMember);
<a class="line-num" href="#line-348" id="line-348" data-line="348"></a>              };
<a class="line-num" href="#line-349" id="line-349" data-line="349"></a>  
<a class="line-num" href="#line-350" id="line-350" data-line="350"></a>              <span class="hljs-keyword">auto</span> consolidateMembers = createConsolidatedTeamMembers();
<a class="line-num" href="#line-351" id="line-351" data-line="351"></a>              
<a class="line-num" href="#line-352" id="line-352" data-line="352"></a>              Element::WebService webService{ <span class="hljs-string">"Rnumber"</span>, <span class="hljs-string">"ID"</span>, toStudyId, <span class="hljs-string">"_Research Project"</span>, { consolidateMembers } };
<a class="line-num" href="#line-353" id="line-353" data-line="353"></a>              <span class="hljs-built_in">string</span> updateMemberBody = clickClient-&gt;dataManagementHelper.createElement(webService);
<a class="line-num" href="#line-354" id="line-354" data-line="354"></a>  
<a class="line-num" href="#line-355" id="line-355" data-line="355"></a>              clickClient-&gt;InvokeDataManagement(<span class="hljs-string">"Update"</span>, updateMemberBody);
<a class="line-num" href="#line-356" id="line-356" data-line="356"></a>  
<a class="line-num" href="#line-357" id="line-357" data-line="357"></a>              <span class="hljs-keyword">return</span> clickClient;
<a class="line-num" href="#line-358" id="line-358" data-line="358"></a>            }
<a class="line-num" href="#line-359" id="line-359" data-line="359"></a>  
<a class="line-num" href="#line-360" id="line-360" data-line="360"></a>          }
<a class="line-num" href="#line-361" id="line-361" data-line="361"></a>        }
<a class="line-num" href="#line-362" id="line-362" data-line="362"></a>      } <span class="hljs-comment">// le fin rnumber</span>
<a class="line-num" href="#line-363" id="line-363" data-line="363"></a>    }
<a class="line-num" href="#line-364" id="line-364" data-line="364"></a>  }
<a class="line-num" href="#line-365" id="line-365" data-line="365"></a>  
<a class="line-num" href="#line-366" id="line-366" data-line="366"></a>  </pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
