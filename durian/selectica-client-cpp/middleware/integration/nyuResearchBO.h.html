<!DOCTYPE html>
<html>
<head>
  <title>nyuResearchBO.h</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="doc-style.css" />
  <script src="doc-filelist.js"></script>
  <script>
    var relativeDir = "", thisFile = "C:\\cygwin64\\home\\htao\\selectica-client-cpp\\include\\integration\\nyuResearchBO.h", defaultSidebar = true;
  </script>
  <script src="doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="headings">Headings</span>
      <span class="tree">Files</span>
    </div>
    <div id="headings">
      <div class="heading h1">
        <a href="#nyuresearchbo.h">nyuResearchBO.h</a>
      </div>
      <div class="heading h4">
        <a href="#syncing%20document%20review%20from%20research%20navigator%20to%20selectica">Syncing Document Review from Research Navigator to Selectica</a>
      </div>
      <div class="heading h2">
        <a href="#nyuresearchbo%26lt%3Bt%26gt%3B">nyuResearchBO&LT;T&GT;</a>
      </div>
      <div class="heading h3">
        <a href="#public">public</a>
      </div>
      <div class="heading h4">
        <a href="#sync()">sync()</a>
      </div>
      <div class="heading h3">
        <a href="#private">private</a>
      </div>
      <div class="heading h4">
        <a href="#side%20effects">Side Effects</a>
      </div>
      <div class="heading h5">
        <a href="#upsertdocumentreviewaction()">upsertDocumentReviewAction()</a>
      </div>
      <div class="heading h4">
        <a href="#actions">Actions</a>
      </div>
      <div class="heading h5">
        <a href="#helpers">Helpers</a>
      </div>
      <div class="heading h6">
        <a href="#findmappedproperty()">findMappedProperty()</a>
      </div>
      <div class="heading h6">
        <a href="#fixmappedpropertytypes()">fixMappedPropertyTypes()</a>
      </div>
      <div class="heading h5">
        <a href="#workflow">Workflow</a>
      </div>
      <div class="heading h6">
        <a href="#constructsearchquery()">constructSearchQuery()</a>
      </div>
      <div class="heading h6">
        <a href="#agreementexist()">agreementExist()</a>
      </div>
      <div class="heading h6">
        <a href="#findvaluebymongomap()">findValueByMongoMap()</a>
      </div>
      <div class="heading h6">
        <a href="#patchbugforcreate()">patchBugForCreate()</a>
      </div>
      <div class="heading h6">
        <a href="#addfoundvaluetopropertycollection()">addFoundValueToPropertyCollection()</a>
      </div>
      <div class="heading h6">
        <a href="#createbomessage()">createBOMessage()</a>
      </div>
      <div class="heading h6">
        <a href="#patchbugforupdate()">patchBugForUpdate()</a>
      </div>
      <div class="heading h6">
        <a href="#updatebomessage()">updateBOMessage()</a>
      </div>
      <div class="heading h6">
        <a href="#constructclickstatusbody()">constructClickStatusBody()</a>
      </div>
      <div class="heading h6">
        <a href="#sendtostore()">sendToStore()</a>
      </div>
    </div>
    <div id="tree"></div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
<div class="pilwrap" id="nyuresearchbo.h">
  <h1>
    <a href="#nyuresearchbo.h" name="nyuresearchbo.h" class="pilcrow">&#182;</a>
    nyuResearchBO.h
  </h1>
</div>



<div class="pilwrap" id="syncing%20document%20review%20from%20research%20navigator%20to%20selectica">
  <h4>
    <a href="#syncing%20document%20review%20from%20research%20navigator%20to%20selectica" name="syncing%20document%20review%20from%20research%20navigator%20to%20selectica" class="pilcrow">&#182;</a>
    Syncing Document Review from Research Navigator to Selectica
  </h4>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="cp">#include &quot;selectica.h&quot;</span>
<span class="cp">#include &quot;middleware.h&quot;</span>

<span class="n">using</span> <span class="n">namespace</span> <span class="n">json11</span><span class="p">;</span>

<span class="n">namespace</span> <span class="n">selectica</span> <span class="p">{</span>

  <span class="k">typedef</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">CONTEXT</span><span class="p">;</span>
  <span class="k">typedef</span> <span class="n">durian</span><span class="o">::</span><span class="n">generator</span><span class="o">&lt;</span><span class="n">durian</span><span class="o">::</span><span class="n">XmlElement</span><span class="o">::</span><span class="n">Body</span><span class="o">&gt;</span> <span class="n">XMLBODY</span><span class="p">;</span>
  <span class="k">typedef</span> <span class="n">PlustacheTypes</span><span class="o">::</span><span class="n">CollectionType</span> <span class="n">COLLECTION</span><span class="p">;</span>
  <span class="k">typedef</span> <span class="n">PlustacheTypes</span><span class="o">::</span><span class="n">ObjectType</span> <span class="n">MAP</span><span class="p">;</span>

  <span class="n">namespace</span> <span class="n">integration</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="nyuresearchbo%26lt%3Bt%26gt%3B">
  <h2>
    <a href="#nyuresearchbo%26lt%3Bt%26gt%3B" name="nyuresearchbo%26lt%3Bt%26gt%3B" class="pilcrow">&#182;</a>
    nyuResearchBO&LT;T&GT;
  </h2>
</div>


<p><strong>The middleware class that must be implemented</strong></p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">class</div>
    <div class="dox_tag_detail">
      <span>nyuResearchBO&LT;T&GT;</span>
    </div>
    <div class="dox_tag_title">tparam</div>
    <div class="dox_tag_detail">
      <span>SimpleWeb::HTTP or SimpleWeb::HTTPS</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="n">template</span><span class="o">&lt;</span><span class="kr">typename</span> <span class="n">T</span><span class="o">&gt;</span>
    <span class="n">class</span> <span class="n">nyuResearchBO</span> <span class="o">:</span> <span class="n">public</span> <span class="n">middleware</span><span class="o">::</span><span class="n">handler</span><span class="o">&lt;</span><span class="n">selectica</span><span class="o">::</span><span class="n">client</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
      <span class="k">typedef</span> <span class="n">selectica</span><span class="o">::</span><span class="n">client</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;*</span> <span class="n">CLIENT</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3">&#182;</a>
</div>
<p><strong>integration:rnumber:selectica:documentreview:update</strong> is the only action type this middleware will act on!</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">const</span> <span class="n">string</span> <span class="n">ACTION_TYPE</span> <span class="o">=</span> <span class="s">&quot;integration:rnumber:selectica:documentreview:update&quot;</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="public">
  <h3>
    <a href="#public" name="public" class="pilcrow">&#182;</a>
    public
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nl">public:</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="sync()">
  <h4>
    <a href="#sync()" name="sync()" class="pilcrow">&#182;</a>
    sync()
  </h4>
</div>


<p><strong>The sync function that must be overridden</strong></p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">client</span>
      <span class="dox_type">selectica::client</span>
      <span>specific to this middleware</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">json</span>
      <span class="dox_type">json11::Json</span>
      <span>document</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">selectica::client</span>
      <span>same client passed in</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="n">selectica</span><span class="o">::</span><span class="n">client</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span> <span class="n">sync</span><span class="p">(</span><span class="n">selectica</span><span class="o">::</span><span class="n">client</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span> <span class="n">selecticaClient</span><span class="p">,</span> <span class="n">Json</span> <span class="n">j</span><span class="p">)</span> <span class="n">override</span> <span class="p">{</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<p><strong>If you're not interested in this action, return immediately!</strong></p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="s">&quot;action&quot;</span><span class="p">].</span><span class="n">is_null</span><span class="p">()</span> <span class="o">||</span> <span class="n">j</span><span class="p">[</span><span class="s">&quot;action&quot;</span><span class="p">].</span><span class="n">string_value</span><span class="p">()</span> <span class="o">!=</span> <span class="n">ACTION_TYPE</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="n">selecticaClient</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">string</span> <span class="n">_uid</span> <span class="o">=</span> <span class="o">!</span><span class="n">j</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">][</span><span class="s">&quot;_uid&quot;</span><span class="p">].</span><span class="n">is_null</span><span class="p">()</span> <span class="o">?</span> <span class="n">j</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">][</span><span class="s">&quot;_uid&quot;</span><span class="p">].</span><span class="n">string_value</span><span class="p">()</span> <span class="o">:</span> <span class="p">(</span><span class="o">!</span><span class="n">j</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">][</span><span class="s">&quot;id&quot;</span><span class="p">].</span><span class="n">is_null</span><span class="p">()</span> <span class="o">?</span> <span class="n">j</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">][</span><span class="s">&quot;id&quot;</span><span class="p">].</span><span class="n">string_value</span><span class="p">()</span> <span class="o">:</span> <span class="s">&quot;N/A&quot;</span><span class="p">);</span>
        <span class="k">auto</span> <span class="n">context</span> <span class="o">=</span> <span class="n">selecticaClient</span><span class="p">.</span><span class="n">getContext</span><span class="p">();</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<p>What is the status of this document? only interested in Negotiation</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">].</span><span class="n">is_null</span><span class="p">()</span> <span class="o">||</span> <span class="n">j</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">][</span><span class="s">&quot;status&quot;</span><span class="p">].</span><span class="n">is_null</span><span class="p">()</span> <span class="o">||</span> <span class="n">j</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">][</span><span class="s">&quot;status&quot;</span><span class="p">].</span><span class="n">string_value</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&quot;Negotiation&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">string</span> <span class="n">status</span> <span class="o">=</span> <span class="o">!</span><span class="n">j</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">][</span><span class="s">&quot;status&quot;</span><span class="p">].</span><span class="n">is_null</span><span class="p">()</span> <span class="o">?</span> <span class="n">j</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">][</span><span class="s">&quot;status&quot;</span><span class="p">].</span><span class="n">string_value</span><span class="p">()</span> <span class="o">:</span> <span class="s">&quot;N/A&quot;</span><span class="p">;;</span>
          <span class="n">context</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;sync&quot;</span><span class="p">,</span> <span class="s">&quot;Skipping study =&gt; &quot;</span> <span class="o">+</span> <span class="n">_uid</span> <span class="o">+</span> <span class="s">&quot; status =&gt; &quot;</span> <span class="o">+</span> <span class="n">status</span><span class="p">);</span>
          <span class="n">durian</span><span class="o">::</span><span class="n">addToLog</span><span class="p">(</span><span class="n">MODULE</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="s">&quot;sync&quot;</span><span class="p">);</span>
          <span class="k">return</span> <span class="n">selecticaClient</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="n">using</span> <span class="n">nyuResearchBOType</span> <span class="o">=</span> <span class="n">selectica</span><span class="o">::</span><span class="n">integration</span><span class="o">::</span><span class="n">nyuResearchBO</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<p>There is 1 task you need to accomplish in order to sync</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">auto</span> <span class="n">_upsertDocumentReview</span> <span class="o">=</span> <span class="n">createAction</span><span class="o">&lt;</span><span class="n">CLIENT</span><span class="o">&gt;</span><span class="p">(</span><span class="n">nyuResearchBOType</span><span class="o">::</span><span class="n">upsertDocumentReviewAction</span><span class="p">,</span> <span class="n">j</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>Compose your tasks</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">auto</span> <span class="n">finalClient</span> <span class="o">=</span> <span class="n">flow</span><span class="p">(</span><span class="n">_upsertDocumentReview</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">selecticaClient</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10">&#182;</a>
</div>
<p>Don't forget to clearContext for the next middleware!</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="n">finalClient</span><span class="o">-&gt;</span><span class="n">clearContext</span><span class="p">();</span>

        <span class="k">return</span> <span class="o">*</span><span class="n">finalClient</span><span class="p">;</span>
      <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="private">
  <h3>
    <a href="#private" name="private" class="pilcrow">&#182;</a>
    private
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nl">private:</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="side%20effects">
  <h4>
    <a href="#side%20effects" name="side%20effects" class="pilcrow">&#182;</a>
    Side Effects
  </h4>
</div>


<p><strong>(CLIENT, Json) => CLIENT</strong></p>

<div class="dox">
  <div class="summary">
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">CLIENT</span>
      <span>click::client</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">Json</span>
      <span>json11::Json</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>CLIENT click::client</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>Top level functions that uses helper functions to create SOAP bodies and sends those bodies to web services</strong></p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
     

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="upsertdocumentreviewaction()">
  <h5>
    <a href="#upsertdocumentreviewaction()" name="upsertdocumentreviewaction()" class="pilcrow">&#182;</a>
    upsertDocumentReviewAction()
  </h5>
</div>


<p><strong>upsertDocumentReviewAction(ctx, param) => ctx</strong></p>

<p><strong>Add Agreement to Selectica if not exist and update Click status with Selectica status action</strong></p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">static</span> <span class="n">CLIENT</span> <span class="n">upsertDocumentReviewAction</span><span class="p">(</span><span class="n">CLIENT</span> <span class="n">selecticaClient</span><span class="p">,</span> <span class="n">Json</span> <span class="n">j</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="n">string</span> <span class="n">data</span> <span class="o">=</span> <span class="n">j</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">].</span><span class="n">dump</span><span class="p">();</span>
        <span class="k">auto</span> <span class="n">mapping</span> <span class="o">=</span> <span class="n">selecticaClient</span><span class="o">-&gt;</span><span class="n">getContext</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;CreateBOMap&quot;</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<p>Create all workflow actions</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">auto</span> <span class="n">_construct</span> <span class="o">=</span> <span class="n">createAction</span><span class="o">&lt;</span><span class="n">CONTEXT</span><span class="o">&gt;</span><span class="p">(</span><span class="n">selectica</span><span class="o">::</span><span class="n">integration</span><span class="o">::</span><span class="n">actions</span><span class="o">::</span><span class="n">constructSearchQuery</span><span class="p">,</span> <span class="n">j</span><span class="p">);</span>
        <span class="k">auto</span> <span class="n">_check</span> <span class="o">=</span> <span class="n">createAction</span><span class="o">&lt;</span><span class="n">CONTEXT</span><span class="o">&gt;</span><span class="p">(</span><span class="n">selectica</span><span class="o">::</span><span class="n">integration</span><span class="o">::</span><span class="n">actions</span><span class="o">::</span><span class="n">agreementExist</span><span class="p">,</span> <span class="n">selecticaClient</span><span class="p">);</span>
        <span class="k">auto</span> <span class="n">_map</span> <span class="o">=</span> <span class="n">createAction</span><span class="o">&lt;</span><span class="n">CONTEXT</span><span class="o">&gt;</span><span class="p">(</span><span class="n">selectica</span><span class="o">::</span><span class="n">integration</span><span class="o">::</span><span class="n">actions</span><span class="o">::</span><span class="n">findValueByMongoMap</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">mapping</span><span class="p">);</span>
        <span class="k">auto</span> <span class="n">_patchCreate</span> <span class="o">=</span> <span class="n">createAction</span><span class="o">&lt;</span><span class="n">CONTEXT</span><span class="o">&gt;</span><span class="p">(</span><span class="n">selectica</span><span class="o">::</span><span class="n">integration</span><span class="o">::</span><span class="n">actions</span><span class="o">::</span><span class="n">patchBugForCreate</span><span class="p">);</span>
        <span class="k">auto</span> <span class="n">_merge</span> <span class="o">=</span> <span class="n">createAction</span><span class="o">&lt;</span><span class="n">CONTEXT</span><span class="o">&gt;</span><span class="p">(</span><span class="n">selectica</span><span class="o">::</span><span class="n">integration</span><span class="o">::</span><span class="n">actions</span><span class="o">::</span><span class="n">addFoundValueToPropertyCollection</span><span class="p">,</span> <span class="n">mapping</span><span class="p">);</span>
        <span class="k">auto</span> <span class="n">_create</span> <span class="o">=</span> <span class="n">createAction</span><span class="o">&lt;</span><span class="n">CONTEXT</span><span class="o">&gt;</span><span class="p">(</span><span class="n">selectica</span><span class="o">::</span><span class="n">integration</span><span class="o">::</span><span class="n">actions</span><span class="o">::</span><span class="n">createBOMessage</span><span class="p">,</span> <span class="n">selecticaClient</span><span class="p">);</span>
        <span class="k">auto</span> <span class="n">_patchUpdate</span> <span class="o">=</span> <span class="n">createAction</span><span class="o">&lt;</span><span class="n">CONTEXT</span><span class="o">&gt;</span><span class="p">(</span><span class="n">selectica</span><span class="o">::</span><span class="n">integration</span><span class="o">::</span><span class="n">actions</span><span class="o">::</span><span class="n">patchBugForUpdate</span><span class="p">);</span>
        <span class="k">auto</span> <span class="n">_update</span> <span class="o">=</span> <span class="n">createAction</span><span class="o">&lt;</span><span class="n">CONTEXT</span><span class="o">&gt;</span><span class="p">(</span><span class="n">selectica</span><span class="o">::</span><span class="n">integration</span><span class="o">::</span><span class="n">actions</span><span class="o">::</span><span class="n">updateBOMessage</span><span class="p">,</span> <span class="n">selecticaClient</span><span class="p">);</span>
        <span class="k">auto</span> <span class="n">_constructClickStatusBody</span> <span class="o">=</span> <span class="n">createAction</span><span class="o">&lt;</span><span class="n">CONTEXT</span><span class="o">&gt;</span><span class="p">(</span><span class="n">selectica</span><span class="o">::</span><span class="n">integration</span><span class="o">::</span><span class="n">actions</span><span class="o">::</span><span class="n">constructClickStatusBody</span><span class="p">,</span> <span class="s">&quot;Update&quot;</span><span class="p">);</span>
        <span class="k">auto</span> <span class="n">_sendToStore</span> <span class="o">=</span> <span class="n">createAction</span><span class="o">&lt;</span><span class="n">CONTEXT</span><span class="o">&gt;</span><span class="p">(</span><span class="n">selectica</span><span class="o">::</span><span class="n">integration</span><span class="o">::</span><span class="n">actions</span><span class="o">::</span><span class="n">sendToStore</span><span class="p">,</span> <span class="n">selecticaClient</span><span class="o">-&gt;</span><span class="n">selecticaNumber</span><span class="p">,</span> <span class="s">&quot;Update&quot;</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<p>Flow all the actions</p>

<p>Currently, Selectica do not want us to update status in Click</p>

<p>So we simply remove the functions from flow(); when they're ready, we'll add them back</p>

<p><code>auto finalContext = flow(_construct, _check, _map, _patchCreate, _merge, _create, _patchUpdate, _merge, _update, _constructClickStatusBody, _sendToStore)(context);</code></p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">auto</span> <span class="n">finalContext</span> <span class="o">=</span> <span class="n">flow</span><span class="p">(</span><span class="n">_construct</span><span class="p">,</span> <span class="n">_check</span><span class="p">,</span> <span class="n">_map</span><span class="p">,</span> <span class="n">_patchCreate</span><span class="p">,</span> <span class="n">_merge</span><span class="p">,</span> <span class="n">_create</span><span class="p">,</span> <span class="n">_patchUpdate</span><span class="p">,</span> <span class="n">_merge</span><span class="p">,</span> <span class="n">_update</span><span class="p">)(</span><span class="n">selecticaClient</span><span class="o">-&gt;</span><span class="n">getContext</span><span class="p">());</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>Or use compose() instead of flow()</p>

<p><code>auto finalContext = compose(_sendToStore, _constructClickStatusBody, _update, _merge, _patchUpdate, _create, _merge, _patchCreate, _map, _check, _construct)(context);</code></p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<p>Finally clear the context for the next request</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="n">selecticaClient</span><span class="o">-&gt;</span><span class="n">clearContext</span><span class="p">();</span>

        <span class="k">return</span> <span class="n">selecticaClient</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="actions">
  <h4>
    <a href="#actions" name="actions" class="pilcrow">&#182;</a>
    Actions
  </h4>
</div>


<p><strong>(CLIENT, P...) => CLIENT</strong></p>

<div class="dox">
  <div class="summary">
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">CLIENT</span>
      <span>selectica::client</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">P...</span>
      <span>variatic argumentments</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>CLIENT selectica::client</span>
    </div>
  </div>
</div>

<p>Helper functions that will be composed</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="n">namespace</span> <span class="n">actions</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="helpers">
  <h5>
    <a href="#helpers" name="helpers" class="pilcrow">&#182;</a>
    Helpers
  </h5>
</div>



<div class="pilwrap" id="findmappedproperty()">
  <h6>
    <a href="#findmappedproperty()" name="findmappedproperty()" class="pilcrow">&#182;</a>
    findMappedProperty()
  </h6>
</div>


<p><strong>findMappedProperty(ctx, param) => ctx</strong></p>

<p>For each mapped attribute, if value is found, add to the property collection</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">auto</span> <span class="n">findMappedProperty</span> <span class="o">=</span> <span class="p">[](</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">PlustacheTypes</span><span class="o">::</span><span class="n">ObjectType</span><span class="o">&gt;&amp;</span> <span class="n">mapping</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="n">PlustacheTypes</span><span class="o">::</span><span class="n">CollectionType</span> <span class="n">property</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="n">e</span> <span class="o">:</span> <span class="n">mapping</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">auto</span> <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="p">).</span><span class="n">get</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&quot;value&quot;</span><span class="p">]);</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<p>Copy</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="n">PlustacheTypes</span><span class="o">::</span><span class="n">ObjectType</span> <span class="n">p</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<p>Get the first instance, sometimes different BO attributes requires the same JSON path</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="k">auto</span> <span class="n">v</span> <span class="o">=</span> <span class="n">d</span><span class="p">.</span><span class="n">front</span><span class="p">()[</span><span class="n">e</span><span class="p">[</span><span class="s">&quot;value&quot;</span><span class="p">]];</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<p>Custom formatting</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
              <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&quot;dataType&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;date&quot;</span><span class="p">){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24">&#182;</a>
</div>
<p>"%b/%d/%Y" Apr/23/2016</p>

<p>"%m/%d/%Y" 04/23/2016</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                <span class="n">v</span> <span class="o">=</span> <span class="n">durian</span><span class="o">::</span><span class="n">formatTime</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s">&quot;%m/%d/%Y&quot;</span><span class="p">);</span>
              <span class="p">}</span>
              <span class="n">p</span><span class="p">[</span><span class="s">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span>
              <span class="n">property</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">ctx</span><span class="p">.</span><span class="n">get</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;property&quot;</span><span class="p">,</span> <span class="n">property</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">ctx</span><span class="p">;</span>
      <span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="fixmappedpropertytypes()">
  <h6>
    <a href="#fixmappedpropertytypes()" name="fixmappedpropertytypes()" class="pilcrow">&#182;</a>
    fixMappedPropertyTypes()
  </h6>
</div>


<p><strong>fixMappedPropertyTypes(ctx) => ctx</strong></p>

<p>Convert data types, b/c there is no one-to-one value possible</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">auto</span> <span class="n">fixMappedPropertyTypes</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">ctx</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">auto</span> <span class="n">propertyList</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;property&quot;</span><span class="p">);</span>
        <span class="k">auto</span> <span class="n">studyResearchType</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">find_if</span><span class="p">(</span><span class="n">propertyList</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">propertyList</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">string</span><span class="o">&gt;&amp;</span> <span class="n">d</span><span class="p">)</span><span class="o">-&gt;</span><span class="kt">bool</span> <span class="p">{</span>
          <span class="k">return</span> <span class="n">d</span><span class="p">[</span><span class="s">&quot;key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;humanResearch&quot;</span><span class="p">;</span>
        <span class="p">});</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">studyResearchType</span> <span class="o">!=</span> <span class="n">std</span><span class="o">::</span><span class="n">end</span><span class="p">(</span><span class="n">propertyList</span><span class="p">))</span> <span class="p">{</span>
          <span class="n">string</span> <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">studyResearchType</span><span class="p">)[</span><span class="s">&quot;value&quot;</span><span class="p">];</span>
          <span class="n">std</span><span class="o">::</span><span class="n">for_each</span><span class="p">(</span><span class="n">propertyList</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">propertyList</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">string</span><span class="o">&gt;&amp;</span> <span class="n">d</span><span class="p">){</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&quot;key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;humanResearch&quot;</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">d</span><span class="p">[</span><span class="s">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> <span class="o">==</span> <span class="s">&quot;Human&quot;</span> <span class="o">?</span> <span class="s">&quot;Y&quot;</span> <span class="o">:</span> <span class="s">&quot;N&quot;</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&quot;key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;animalResearch&quot;</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">d</span><span class="p">[</span><span class="s">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> <span class="o">==</span> <span class="s">&quot;Human&quot;</span> <span class="o">?</span> <span class="s">&quot;N&quot;</span> <span class="o">:</span> <span class="s">&quot;Y&quot;</span><span class="p">;;</span>
            <span class="p">}</span>
          <span class="p">});</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26">&#182;</a>
</div>
<p>Default to human study</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="n">std</span><span class="o">::</span><span class="n">for_each</span><span class="p">(</span><span class="n">propertyList</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">propertyList</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">string</span><span class="o">&gt;&amp;</span> <span class="n">d</span><span class="p">){</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&quot;key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;humanResearch&quot;</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">d</span><span class="p">[</span><span class="s">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Y&quot;</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&quot;key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;animalResearch&quot;</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">d</span><span class="p">[</span><span class="s">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;N&quot;</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">});</span>
        <span class="p">}</span>
        <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;property&quot;</span><span class="p">);</span>
        <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;property&quot;</span><span class="p">,</span> <span class="n">propertyList</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">ctx</span><span class="p">;</span>
      <span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="workflow">
  <h5>
    <a href="#workflow" name="workflow" class="pilcrow">&#182;</a>
    Workflow
  </h5>
</div>



<div class="pilwrap" id="constructsearchquery()">
  <h6>
    <a href="#constructsearchquery()" name="constructsearchquery()" class="pilcrow">&#182;</a>
    constructSearchQuery()
  </h6>
</div>


<p><strong>constructSearchQuery(ctx, param) => ctx</strong></p>

<p>Does it exist in selectica, construct query?
f(ctx, param)=>ctx </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">auto</span> <span class="n">constructSearchQuery</span> <span class="o">=</span> <span class="p">[](</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">ctx</span><span class="p">,</span> <span class="k">const</span> <span class="n">json11</span><span class="o">::</span><span class="n">Json</span><span class="o">&amp;</span> <span class="n">j</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="n">string</span> <span class="n">_uid</span> <span class="o">=</span> <span class="o">!</span><span class="n">j</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">][</span><span class="s">&quot;_uid&quot;</span><span class="p">].</span><span class="n">is_null</span><span class="p">()</span> <span class="o">?</span> <span class="n">j</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">][</span><span class="s">&quot;_uid&quot;</span><span class="p">].</span><span class="n">string_value</span><span class="p">()</span> <span class="o">:</span> <span class="p">(</span><span class="o">!</span><span class="n">j</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">][</span><span class="s">&quot;id&quot;</span><span class="p">].</span><span class="n">is_null</span><span class="p">()</span> <span class="o">?</span> <span class="n">j</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">][</span><span class="s">&quot;id&quot;</span><span class="p">].</span><span class="n">string_value</span><span class="p">()</span> <span class="o">:</span> <span class="s">&quot;N/A&quot;</span><span class="p">);</span>
        <span class="n">string</span> <span class="nf">boType</span><span class="p">(</span><span class="s">&quot;NYUResearchBO&quot;</span><span class="p">);</span>
        <span class="n">string</span> <span class="nf">reqResearchInfo</span><span class="p">(</span><span class="s">&quot;ReqResearchInfo&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_uid</span> <span class="o">!=</span> <span class="s">&quot;N/A&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="p">).</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;targetSearch&quot;</span><span class="p">,</span> <span class="s">&quot;/bundles/&quot;</span> <span class="o">+</span> <span class="n">boType</span> <span class="o">+</span> <span class="s">&quot;/*[selecticaAgreementNumber=&#39;&quot;</span> <span class="o">+</span> <span class="n">_uid</span> <span class="o">+</span> <span class="s">&quot;&#39;]/&quot;</span> <span class="o">+</span> <span class="n">reqResearchInfo</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28">&#182;</a>
</div>
<p>Also add _uid to the context, will be used to update selectica status later</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;_uid&quot;</span><span class="p">,</span> <span class="n">_uid</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">ctx</span><span class="p">;</span>
      <span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="agreementexist()">
  <h6>
    <a href="#agreementexist()" name="agreementexist()" class="pilcrow">&#182;</a>
    agreementExist()
  </h6>
</div>


<p><strong>agreementExist(ctx, param) => ctx</strong></p>

<p>Test try to get just one attribute
Note: if BO does not exist, it will not have an "PropertyList" attribute (path=> Envelope.Body.GetDataResponse.PropertyList)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">auto</span> <span class="n">agreementExist</span> <span class="o">=</span> <span class="p">[](</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">ctx</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">obj</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="n">string</span> <span class="n">target</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="p">).</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;targetSearch&quot;</span><span class="p">).</span><span class="n">front</span><span class="p">()[</span><span class="s">&quot;targetSearch&quot;</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">target</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="n">ctx</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">string</span> <span class="n">socketType</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="p">).</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;socketType&quot;</span><span class="p">).</span><span class="n">front</span><span class="p">()[</span><span class="s">&quot;socketType&quot;</span><span class="p">];</span>
        <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">resp2</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">socketType</span> <span class="o">==</span> <span class="s">&quot;HTTP&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">auto</span> <span class="n">o</span> <span class="o">=</span> <span class="p">(</span><span class="n">selectica</span><span class="o">::</span><span class="n">client</span><span class="o">&lt;</span><span class="n">SimpleWeb</span><span class="o">::</span><span class="n">HTTP</span><span class="o">&gt;*</span><span class="p">)</span><span class="n">obj</span><span class="p">;</span>
          <span class="n">resp2</span> <span class="o">=</span> <span class="p">((</span><span class="n">selectica</span><span class="o">::</span><span class="n">client</span><span class="o">&lt;</span><span class="n">SimpleWeb</span><span class="o">::</span><span class="n">HTTP</span><span class="o">&gt;*</span><span class="p">)</span><span class="n">obj</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetData</span><span class="p">(</span><span class="n">target</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="n">resp2</span> <span class="o">=</span> <span class="p">((</span><span class="n">selectica</span><span class="o">::</span><span class="n">client</span><span class="o">&lt;</span><span class="n">SimpleWeb</span><span class="o">::</span><span class="n">HTTPS</span><span class="o">&gt;*</span><span class="p">)</span><span class="n">obj</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetData</span><span class="p">(</span><span class="n">target</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">auto</span> <span class="n">t</span> <span class="o">=</span> <span class="n">resp2</span><span class="p">.</span><span class="n">get</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;GetData&quot;</span><span class="p">).</span><span class="n">front</span><span class="p">()[</span><span class="s">&quot;GetData&quot;</span><span class="p">];</span>

        <span class="n">string</span> <span class="n">err</span><span class="p">;</span>
        <span class="k">auto</span> <span class="n">j</span> <span class="o">=</span> <span class="n">json11</span><span class="o">::</span><span class="n">Json</span><span class="o">::</span><span class="n">parse</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">json11</span><span class="o">::</span><span class="n">JsonParse</span><span class="o">::</span><span class="n">STANDARD</span><span class="p">);</span>
        <span class="k">auto</span> <span class="n">top</span> <span class="o">=</span> <span class="n">j</span><span class="p">[</span><span class="s">&quot;Envelope&quot;</span><span class="p">][</span><span class="s">&quot;Body&quot;</span><span class="p">][</span><span class="s">&quot;GetDataResponse&quot;</span><span class="p">][</span><span class="s">&quot;PropertyList&quot;</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">top</span><span class="p">.</span><span class="n">is_array</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">top</span><span class="p">.</span><span class="n">array_items</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s">&quot;Property&quot;</span><span class="p">].</span><span class="n">is_array</span><span class="p">())</span> <span class="p">{</span>
          <span class="k">auto</span> <span class="n">props</span> <span class="o">=</span> <span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&quot;Property&quot;</span><span class="p">].</span><span class="n">array_items</span><span class="p">();</span>
          <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">prop</span> <span class="o">:</span> <span class="n">props</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s">&quot;Name&quot;</span><span class="p">].</span><span class="n">string_value</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;trackingNumber&quot;</span><span class="p">)</span> <span class="p">{</span>
              <span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="p">).</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;trackingNumber&quot;</span><span class="p">,</span> <span class="n">prop</span><span class="p">[</span><span class="s">&quot;Value&quot;</span><span class="p">].</span><span class="n">string_value</span><span class="p">());</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30">&#182;</a>
</div>
<p>Once it is agreement is created, they no longer want updates in Click</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
              <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;agreementExist&quot;</span><span class="p">,</span> <span class="s">&quot;true&quot;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s">&quot;Name&quot;</span><span class="p">].</span><span class="n">string_value</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;contractStatus&quot;</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">auto</span> <span class="n">contractStatus</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s">&quot;Value&quot;</span><span class="p">].</span><span class="n">string_value</span><span class="p">();</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31">&#182;</a>
</div>
<p>Will use this status to update Click</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
              <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;contractStatus&quot;</span><span class="p">,</span> <span class="n">contractStatus</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32">&#182;</a>
</div>
<p>This will be used by constructClickStatusBody()</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
              <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;statusName&quot;</span><span class="p">,</span> <span class="n">contractStatus</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33">&#182;</a>
</div>
<p>Find the Click ID by statusName</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
              <span class="k">auto</span> <span class="n">statusId</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SelecticaToClickStatusMap&quot;</span><span class="p">).</span><span class="n">front</span><span class="p">()[</span><span class="n">contractStatus</span><span class="p">];</span>
              <span class="k">if</span> <span class="p">(</span><span class="n">statusId</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;statusId&quot;</span><span class="p">,</span> <span class="n">statusId</span><span class="p">);</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">ctx</span><span class="p">;</span>
      <span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="findvaluebymongomap()">
  <h6>
    <a href="#findvaluebymongomap()" name="findvaluebymongomap()" class="pilcrow">&#182;</a>
    findValueByMongoMap()
  </h6>
</div>


<p>// <strong>findValueByMongoMap(ctx, param, param2) => ctx</strong></p>

<p>Get all values defined by mapping from the mongo json
f(ctx, param, param)=>ctx</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">auto</span> <span class="n">findValueByMongoMap</span> <span class="o">=</span> <span class="p">[](</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">string</span> <span class="n">resp</span><span class="p">,</span> <span class="n">PlustacheTypes</span><span class="o">::</span><span class="n">CollectionType</span> <span class="n">mapping</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35">&#182;</a>
</div>
<p>durian::createContextFromJson is a useful function, check it out </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="n">durian</span><span class="o">::</span><span class="n">createContextFromJson</span><span class="p">((</span><span class="n">resp</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">mapping</span><span class="p">,</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">ctx</span><span class="p">;</span>
      <span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="patchbugforcreate()">
  <h6>
    <a href="#patchbugforcreate()" name="patchbugforcreate()" class="pilcrow">&#182;</a>
    patchBugForCreate()
  </h6>
</div>


<p><strong>patchBugForCreate(ctx) => ctx</strong>
To accomodate <strong>Selectica bug</strong>, set dummy values</p>


<div class="highlight"><pre><code><span class="nv">agreementCategory</span> <span class="o">=</span>&gt; --select agreement category--

<span class="nv">agreementType</span> <span class="o">=</span>&gt; --select agreement <span class="nb">type</span>--
</code></pre></div>


        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">auto</span> <span class="n">patchBugForCreate</span> <span class="o">=</span> <span class="p">[](</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">ctx</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37">&#182;</a>
</div>
<p>if trackingNumber is in the context, this is just an UpdateBO, not CreateBO</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">auto</span> <span class="n">trackingNumberValue</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;trackingNumber&quot;</span><span class="p">).</span><span class="n">front</span><span class="p">()[</span><span class="s">&quot;trackingNumber&quot;</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">trackingNumberValue</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="n">ctx</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">string</span> <span class="n">agreementCategory</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;category.name&quot;</span><span class="p">).</span><span class="n">front</span><span class="p">()[</span><span class="s">&quot;category.name&quot;</span><span class="p">];</span>
        <span class="n">string</span> <span class="n">agreementType</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;categoryType.name&quot;</span><span class="p">).</span><span class="n">front</span><span class="p">()[</span><span class="s">&quot;categoryType.name&quot;</span><span class="p">];</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38">&#182;</a>
</div>
<p>Update to categoryType dummy value; category is accepted on CreateBO, categoryType will be processed by UpdateBO immediately
ctx->remove("category.name");</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;categoryType.name&quot;</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39">&#182;</a>
</div>
<p>ctx->add("category.name", "--select agreement category--");</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;categoryType.name&quot;</span><span class="p">,</span> <span class="s">&quot;--select agreement type--&quot;</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40">&#182;</a>
</div>
<p>Add for update</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;category.name.update&quot;</span><span class="p">,</span> <span class="n">agreementCategory</span><span class="p">);</span>
        <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;categoryType.name.update&quot;</span><span class="p">,</span> <span class="n">agreementType</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">ctx</span><span class="p">;</span>
      <span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="addfoundvaluetopropertycollection()">
  <h6>
    <a href="#addfoundvaluetopropertycollection()" name="addfoundvaluetopropertycollection()" class="pilcrow">&#182;</a>
    addFoundValueToPropertyCollection()
  </h6>
</div>


<p><strong>addFoundValueToPropertyCollection(ctx, param) => ctx</strong></p>

<p>For each mapped attribute, if value is found, add to the property collection
f(ctx, param)=>ctx</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">auto</span> <span class="n">addFoundValueToPropertyCollection</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">PlustacheTypes</span><span class="o">::</span><span class="n">ObjectType</span><span class="o">&gt;</span> <span class="n">mapping</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;property&quot;</span><span class="p">);</span>
        <span class="n">findMappedProperty</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">mapping</span><span class="p">);</span>
        <span class="n">fixMappedPropertyTypes</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">ctx</span><span class="p">;</span>
      <span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="createbomessage()">
  <h6>
    <a href="#createbomessage()" name="createbomessage()" class="pilcrow">&#182;</a>
    createBOMessage()
  </h6>
</div>


<p><strong>createBOMessage(ctx, param) => ctx</strong></p>

<p>If context has "trackingNumber", it is an UPDATE else CREATE, will be handled by CreateBO
f(ctx)=>ctx</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">auto</span> <span class="n">createBOMessage</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">ctx</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">obj</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43">&#182;</a>
</div>
<p>If trackingNumber is in the context, this is just an UpdateBO, not CreateBO</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">auto</span> <span class="n">trackingNumberValue</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;trackingNumber&quot;</span><span class="p">).</span><span class="n">front</span><span class="p">()[</span><span class="s">&quot;trackingNumber&quot;</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">trackingNumberValue</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="n">ctx</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">string</span> <span class="n">socketType</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="p">).</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;socketType&quot;</span><span class="p">).</span><span class="n">front</span><span class="p">()[</span><span class="s">&quot;socketType&quot;</span><span class="p">];</span>
        <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">resp2</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">socketType</span> <span class="o">==</span> <span class="s">&quot;HTTP&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">resp2</span> <span class="o">=</span> <span class="p">((</span><span class="n">selectica</span><span class="o">::</span><span class="n">client</span><span class="o">&lt;</span><span class="n">SimpleWeb</span><span class="o">::</span><span class="n">HTTP</span><span class="o">&gt;*</span><span class="p">)</span><span class="n">obj</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CreateBO</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="n">resp2</span> <span class="o">=</span> <span class="p">((</span><span class="n">selectica</span><span class="o">::</span><span class="n">client</span><span class="o">&lt;</span><span class="n">SimpleWeb</span><span class="o">::</span><span class="n">HTTPS</span><span class="o">&gt;*</span><span class="p">)</span><span class="n">obj</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CreateBO</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">ctx</span><span class="p">;</span>
      <span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="patchbugforupdate()">
  <h6>
    <a href="#patchbugforupdate()" name="patchbugforupdate()" class="pilcrow">&#182;</a>
    patchBugForUpdate()
  </h6>
</div>


<p><strong>patchBugForUpdate(ctx) => ctx</strong></p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">auto</span> <span class="n">patchBugForUpdate</span> <span class="o">=</span> <span class="p">[](</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">ctx</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">auto</span> <span class="n">agreementType</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;categoryType.name.update&quot;</span><span class="p">).</span><span class="n">front</span><span class="p">()[</span><span class="s">&quot;categoryType.name.update&quot;</span><span class="p">];</span>
        <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;category.name&quot;</span><span class="p">);</span>
        <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;categoryType.name&quot;</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45">&#182;</a>
</div>
<p>Was a CreateBO processed prior to entering this block; if so, CreateBO would exist in the context</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">auto</span> <span class="n">createBOValue</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;CreateBO&quot;</span><span class="p">).</span><span class="n">front</span><span class="p">()[</span><span class="s">&quot;CreateBO&quot;</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">createBOValue</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46">&#182;</a>
</div>
<p>Previously created and stored by patchBugForCreate thunk
Add for update if previous step was a CreateBO ONLY
ctx->add("category.name", agreementCategory);
<strong>Heads up! Adding both category and type fails, just update type</strong></p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;categoryType.name&quot;</span><span class="p">,</span> <span class="n">agreementType</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">ctx</span><span class="p">;</span>
      <span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="updatebomessage()">
  <h6>
    <a href="#updatebomessage()" name="updatebomessage()" class="pilcrow">&#182;</a>
    updateBOMessage()
  </h6>
</div>


<p><strong>updateBOMessage(ctx, param) => ctx</strong></p>

<p>If agreement already exists, they no longer want updates from Click</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">auto</span> <span class="n">updateBOMessage</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">ctx</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">obj</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">auto</span> <span class="n">agreementExist</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;agreementExist&quot;</span><span class="p">).</span><span class="n">front</span><span class="p">()[</span><span class="s">&quot;agreementExist&quot;</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">agreementExist</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;agreementAlreadyExist&quot;</span><span class="p">,</span> <span class="s">&quot;Study =&gt; &quot;</span> <span class="o">+</span> <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;_uid&quot;</span><span class="p">).</span><span class="n">front</span><span class="p">()[</span><span class="s">&quot;_uid&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot; Tracking Number =&gt; &quot;</span> <span class="o">+</span> <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;trackingNumber&quot;</span><span class="p">).</span><span class="n">front</span><span class="p">()[</span><span class="s">&quot;trackingNumber&quot;</span><span class="p">]);</span>
          <span class="n">durian</span><span class="o">::</span><span class="n">addToLog</span><span class="p">(</span><span class="n">MODULE</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="s">&quot;agreementAlreadyExist&quot;</span><span class="p">);</span>
          <span class="k">return</span> <span class="n">ctx</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">string</span> <span class="n">socketType</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="p">).</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;socketType&quot;</span><span class="p">).</span><span class="n">front</span><span class="p">()[</span><span class="s">&quot;socketType&quot;</span><span class="p">];</span>
        <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">resp2</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">socketType</span> <span class="o">==</span> <span class="s">&quot;HTTP&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">resp2</span> <span class="o">=</span> <span class="p">((</span><span class="n">selectica</span><span class="o">::</span><span class="n">client</span><span class="o">&lt;</span><span class="n">SimpleWeb</span><span class="o">::</span><span class="n">HTTP</span><span class="o">&gt;*</span><span class="p">)</span><span class="n">obj</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">UpdateBO</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="n">resp2</span> <span class="o">=</span> <span class="p">((</span><span class="n">selectica</span><span class="o">::</span><span class="n">client</span><span class="o">&lt;</span><span class="n">SimpleWeb</span><span class="o">::</span><span class="n">HTTPS</span><span class="o">&gt;*</span><span class="p">)</span><span class="n">obj</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">UpdateBO</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">ctx</span><span class="p">;</span>
      <span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="constructclickstatusbody()">
  <h6>
    <a href="#constructclickstatusbody()" name="constructclickstatusbody()" class="pilcrow">&#182;</a>
    constructClickStatusBody()
  </h6>
</div>


<p><strong>constructClickStatusBody(ctx, param) => ctx</strong></p>

<div class="dox">
  <div class="summary"><p>compile the SOAP body
selectica client will send this action to the store</p>
  </div>
  <div class="body">
  </div>
</div>

<div class="dox">
  <div class="summary"><p>updateClickStatus
For now, update selectica status from selectica client
Next version, selectica client should send XML to store, (new topic required) selectica client should pick up from store and process accordingly</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">auto</span> <span class="n">constructClickStatusBody</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">ctx</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span> <span class="n">action</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">auto</span> <span class="n">selecticaAgreementId</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;_uid&quot;</span><span class="p">).</span><span class="n">front</span><span class="p">()[</span><span class="s">&quot;_uid&quot;</span><span class="p">];</span>
        <span class="k">auto</span> <span class="n">statusName</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;statusName&quot;</span><span class="p">).</span><span class="n">front</span><span class="p">()[</span><span class="s">&quot;statusName&quot;</span><span class="p">];</span>
        <span class="k">auto</span> <span class="n">statusId</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;statusId&quot;</span><span class="p">).</span><span class="n">front</span><span class="p">()[</span><span class="s">&quot;statusId&quot;</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">statusId</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">statusName</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="n">ctx</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">auto</span> <span class="n">requestXmlString</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="k">auto</span> <span class="n">context</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="n">context</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;selecticaAgreementId&quot;</span><span class="p">,</span> <span class="n">selecticaAgreementId</span><span class="p">);</span>
        <span class="n">context</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;statusName&quot;</span><span class="p">,</span> <span class="n">statusName</span><span class="p">);</span>
        <span class="n">context</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;statusId&quot;</span><span class="p">,</span> <span class="n">statusId</span><span class="p">);</span>

        <span class="n">string</span> <span class="n">tplPath</span> <span class="o">=</span> <span class="s">&quot;tpl/selectica/toClick/&quot;</span> <span class="o">+</span> <span class="n">action</span><span class="p">;</span>
        <span class="n">durian</span><span class="o">::</span><span class="n">generator</span><span class="o">&lt;</span><span class="n">durian</span><span class="o">::</span><span class="n">XmlElement</span><span class="o">::</span><span class="n">Body</span><span class="o">&gt;</span> <span class="n">body</span><span class="p">;</span>
        <span class="n">requestXmlString</span><span class="p">.</span><span class="n">swap</span><span class="p">(</span><span class="n">body</span><span class="p">.</span><span class="n">compile</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">tplPath</span><span class="p">));</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-49" id="section-49">&#182;</a>
</div>
<p>Save to context for next function</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;requestXmlString&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">requestXmlString</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">ctx</span><span class="p">;</span>
      <span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="sendtostore()">
  <h6>
    <a href="#sendtostore()" name="sendtostore()" class="pilcrow">&#182;</a>
    sendToStore()
  </h6>
</div>


<p><strong>sendToStore(ctx, param, param2) => ctx</strong></p>

<div class="dox">
  <div class="summary"><p>Invoke the Selectica client
selectica client should just process this action like a dumb component</p>
  </div>
  <div class="body">
  </div>
</div>

<div class="dox">
  <div class="summary"><p>Should send the generated XML to the store
For now, we will actually process the SOAP request</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">auto</span> <span class="n">sendToStore</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">json11</span><span class="o">::</span><span class="n">Json</span> <span class="n">selecticaRnumber</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span> <span class="n">action</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Plustache</span><span class="o">::</span><span class="n">Context</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="n">string</span> <span class="n">requestXmlString</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;requestXmlString&quot;</span><span class="p">).</span><span class="n">front</span><span class="p">()[</span><span class="s">&quot;requestXmlString&quot;</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">requestXmlString</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="n">ctx</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">string</span><span class="o">&gt;</span> <span class="n">customHeaders1</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span> <span class="s">&quot;Content-Type&quot;</span><span class="p">,</span> <span class="s">&quot;text/xml&quot;</span> <span class="p">},</span> <span class="p">{</span> <span class="s">&quot;SOAPAction&quot;</span><span class="p">,</span> <span class="s">&quot;http://selecticacommerce.com/Extranet/WebServices/Login&quot;</span> <span class="p">}</span> <span class="p">};</span>
        <span class="n">selectica</span><span class="o">::</span><span class="n">client</span><span class="o">&lt;</span><span class="n">SimpleWeb</span><span class="o">::</span><span class="n">HTTP</span><span class="o">&gt;</span> <span class="n">selecticaClient</span><span class="p">(</span><span class="n">selecticaRnumber</span><span class="p">[</span><span class="s">&quot;host&quot;</span><span class="p">].</span><span class="n">string_value</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span>
          <span class="n">selecticaRnumber</span><span class="p">[</span><span class="s">&quot;entityServicePath&quot;</span><span class="p">].</span><span class="n">string_value</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span>
          <span class="n">selecticaRnumber</span><span class="p">[</span><span class="s">&quot;esetServicePath&quot;</span><span class="p">].</span><span class="n">string_value</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span>
          <span class="n">selecticaRnumber</span><span class="p">[</span><span class="s">&quot;dataManagementServicePath&quot;</span><span class="p">].</span><span class="n">string_value</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span>
          <span class="n">selecticaRnumber</span><span class="p">[</span><span class="s">&quot;searchServicePath&quot;</span><span class="p">].</span><span class="n">string_value</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span>
          <span class="n">selecticaRnumber</span><span class="p">[</span><span class="s">&quot;user&quot;</span><span class="p">].</span><span class="n">string_value</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">selecticaRnumber</span><span class="p">[</span><span class="s">&quot;pass&quot;</span><span class="p">].</span><span class="n">string_value</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">customHeaders1</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-51" id="section-51">&#182;</a>
</div>
<p>__Heads up!</p>

<p>__b/c durian only appends "user" to context, we also need to append userName to context</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="n">selecticaClient</span><span class="p">.</span><span class="n">getContext</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;userName&quot;</span><span class="p">,</span> <span class="n">selecticaRnumber</span><span class="p">[</span><span class="s">&quot;user&quot;</span><span class="p">].</span><span class="n">string_value</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span> 
        <span class="n">selecticaClient</span><span class="p">.</span><span class="n">getContext</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;storeName&quot;</span><span class="p">,</span> <span class="s">&quot;ResearchNavigator&quot;</span><span class="p">);</span>

        <span class="n">selecticaClient</span><span class="p">.</span><span class="n">InvokeDataManagement</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">requestXmlString</span><span class="p">);</span>

        <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;sendToStore&quot;</span><span class="p">,</span> <span class="n">requestXmlString</span><span class="p">);</span>
        <span class="n">durian</span><span class="o">::</span><span class="n">addToLog</span><span class="p">(</span><span class="n">MODULE</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="s">&quot;sendToStore&quot;</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">ctx</span><span class="p">;</span>
      <span class="p">};</span>

    <span class="p">}</span> <span class="c1">// le fin selectica::integration::actions namespace</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
